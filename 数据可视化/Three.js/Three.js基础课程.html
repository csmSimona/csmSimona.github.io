<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>Three.js基础课程 | myDocs</title><meta name="description" content="我的学习笔记文档">
    <link rel="preload" href="/assets/style-BJfsv23k.css" as="style"><link rel="stylesheet" href="/assets/style-BJfsv23k.css">
    <link rel="modulepreload" href="/assets/app-5eYbtFQ0.js"><link rel="modulepreload" href="/assets/Three.js基础课程.html-CnRzyKV4.js">
    <link rel="prefetch" href="/assets/index.html-DiZ7CEGd.js" as="script"><link rel="prefetch" href="/assets/JavaScript的优缺点.html-CMUmAWjH.js" as="script"><link rel="prefetch" href="/assets/js异步及处理异步的几种方法.html-DXOFlvsf.js" as="script"><link rel="prefetch" href="/assets/2023年.html-r9ViSBEN.js" as="script"><link rel="prefetch" href="/assets/使用font-spider压缩字体文件.html-mZJOPQzr.js" as="script"><link rel="prefetch" href="/assets/Git小记.html-BLMhUtwu.js" as="script"><link rel="prefetch" href="/assets/Linux基本命令.html-GJfS3lqo.js" as="script"><link rel="prefetch" href="/assets/NodeJs小记.html-BklKr0tQ.js" as="script"><link rel="prefetch" href="/assets/PixiJS实现一镜到底.html-Mh11ppdd.js" as="script"><link rel="prefetch" href="/assets/PixiJS的基本使用.html-DXJqB1vy.js" as="script"><link rel="prefetch" href="/assets/TypeScript小记.html-rIM_dRxX.js" as="script"><link rel="prefetch" href="/assets/正则表达式入门.html---w7PUAR.js" as="script"><link rel="prefetch" href="/assets/CSS小记.html-6q2AwAoC.js" as="script"><link rel="prefetch" href="/assets/HTML小记.html-Dt00EDB7.js" as="script"><link rel="prefetch" href="/assets/JavaScript小记.html-C-Y2Vvpq.js" as="script"><link rel="prefetch" href="/assets/Nodejs面试题.html-RTumCXwL.js" as="script"><link rel="prefetch" href="/assets/React小记.html-UHOs9YN3.js" as="script"><link rel="prefetch" href="/assets/Typescript面试题.html-ls9jplyz.js" as="script"><link rel="prefetch" href="/assets/Vue小记.html-DJXAZmyW.js" as="script"><link rel="prefetch" href="/assets/前端工程化.html-Codln0Mx.js" as="script"><link rel="prefetch" href="/assets/前端性能优化.html-CM7iTVEK.js" as="script"><link rel="prefetch" href="/assets/实际项目开发.html-DlgTBXAn.js" as="script"><link rel="prefetch" href="/assets/小程序.html-B9b-dcs0.js" as="script"><link rel="prefetch" href="/assets/手写js.html-sPH-vdAG.js" as="script"><link rel="prefetch" href="/assets/计算机网络.html-BU5E69nK.js" as="script"><link rel="prefetch" href="/assets/Canvas入门.html-BznjPMgX.js" as="script"><link rel="prefetch" href="/assets/Echarts基本使用.html-1E8azxLB.js" as="script"><link rel="prefetch" href="/assets/SVG入门.html-B7MZgpU8.js" as="script"><link rel="prefetch" href="/assets/排序.html-CMs6WK5-.js" as="script"><link rel="prefetch" href="/assets/算法题.html-BBRSTsT3.js" as="script"><link rel="prefetch" href="/assets/Python编程：从入门到实践.html-Og-O4brk.js" as="script"><link rel="prefetch" href="/assets/中后台管理系统模板记录.html-vu7XQRxq.js" as="script"><link rel="prefetch" href="/assets/低代码数据可视化平台开发记录.html-Cu3H6_1c.js" as="script"><link rel="prefetch" href="/assets/多页签开发记录.html-4edZN7EJ.js" as="script"><link rel="prefetch" href="/assets/antv G6的基础入门及树图的实际应用.html-fAWVS_vQ.js" as="script"><link rel="prefetch" href="/assets/CSS揭秘.html-DYZNr6-x.js" as="script"><link rel="prefetch" href="/assets/浙政钉、浙里办、浙江政务服务网应用上架指南.html-mmCylcyv.js" as="script"><link rel="prefetch" href="/assets/404.html-CPAh1Yij.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><!----><span class="vp-site-name" aria-hidden="true">myDocs</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="首页"><!--[--><!--[--><!--]--><!--]-->首页<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="前端基础汇总"><span class="title">前端基础汇总</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="前端基础汇总"><span class="title">前端基础汇总</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/JavaScript%E5%B0%8F%E8%AE%B0.html" aria-label="JavaScript小记"><!--[--><!--[--><!--]--><!--]-->JavaScript小记<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/HTML%E5%B0%8F%E8%AE%B0.html" aria-label="HTML小记"><!--[--><!--[--><!--]--><!--]-->HTML小记<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/CSS%E5%B0%8F%E8%AE%B0.html" aria-label="CSS小记"><!--[--><!--[--><!--]--><!--]-->CSS小记<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.html" aria-label="计算机网络"><!--[--><!--[--><!--]--><!--]-->计算机网络<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/React%E5%B0%8F%E8%AE%B0.html" aria-label="React小记"><!--[--><!--[--><!--]--><!--]-->React小记<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/Vue%E5%B0%8F%E8%AE%B0.html" aria-label="Vue小记"><!--[--><!--[--><!--]--><!--]-->Vue小记<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/%E6%89%8B%E5%86%99js.html" aria-label="手写js"><!--[--><!--[--><!--]--><!--]-->手写js<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96.html" aria-label="前端工程化"><!--[--><!--[--><!--]--><!--]-->前端工程化<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html" aria-label="前端性能优化"><!--[--><!--[--><!--]--><!--]-->前端性能优化<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/%E5%AE%9E%E9%99%85%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91.html" aria-label="实际项目开发"><!--[--><!--[--><!--]--><!--]-->实际项目开发<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/Typescript%E9%9D%A2%E8%AF%95%E9%A2%98.html" aria-label="Typescript面试题"><!--[--><!--[--><!--]--><!--]-->Typescript面试题<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/Nodejs%E9%9D%A2%E8%AF%95%E9%A2%98.html" aria-label="Nodejs面试题"><!--[--><!--[--><!--]--><!--]-->Nodejs面试题<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/其他/小程序.html" aria-label="小程序"><!--[--><!--[--><!--]--><!--]-->小程序<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="算法"><span class="title">算法</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E7%AE%97%E6%B3%95/%E6%8E%92%E5%BA%8F.html" aria-label="排序"><!--[--><!--[--><!--]--><!--]-->排序<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95%E9%A2%98.html" aria-label="算法题"><!--[--><!--[--><!--]--><!--]-->算法题<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="其他"><span class="title">其他</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="其他"><span class="title">其他</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%85%B6%E4%BB%96/Git%E5%B0%8F%E8%AE%B0.html" aria-label="Git小记"><!--[--><!--[--><!--]--><!--]-->Git小记<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%85%B6%E4%BB%96/NodeJs%E5%B0%8F%E8%AE%B0.html" aria-label="NodeJs小记"><!--[--><!--[--><!--]--><!--]-->NodeJs小记<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%85%B6%E4%BB%96/TypeScript%E5%B0%8F%E8%AE%B0.html" aria-label="TypeScript小记"><!--[--><!--[--><!--]--><!--]-->TypeScript小记<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%85%B6%E4%BB%96/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8.html" aria-label="正则表达式入门"><!--[--><!--[--><!--]--><!--]-->正则表达式入门<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%85%B6%E4%BB%96/Linux%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4.html" aria-label="Linux基本命令"><!--[--><!--[--><!--]--><!--]-->Linux基本命令<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%85%B6%E4%BB%96/PixiJS%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8.html" aria-label="PixiJS的基本使用"><!--[--><!--[--><!--]--><!--]-->PixiJS的基本使用<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%85%B6%E4%BB%96/PixiJS%E5%AE%9E%E7%8E%B0%E4%B8%80%E9%95%9C%E5%88%B0%E5%BA%95.html" aria-label="PixiJS实现一镜到底"><!--[--><!--[--><!--]--><!--]-->PixiJS实现一镜到底<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="数据可视化"><span class="title">数据可视化</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="数据可视化"><span class="title">数据可视化</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/Canvas%E5%85%A5%E9%97%A8.html" aria-label="Canvas入门"><!--[--><!--[--><!--]--><!--]-->Canvas入门<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/SVG%E5%85%A5%E9%97%A8.html" aria-label="SVG入门"><!--[--><!--[--><!--]--><!--]-->SVG入门<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/Echarts%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8.html" aria-label="Echarts基本使用"><!--[--><!--[--><!--]--><!--]-->Echarts基本使用<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/antvG6/antv%20G6%E7%9A%84%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E5%8F%8A%E6%A0%91%E5%9B%BE%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8.html" aria-label="antv G6的基础入门及树图的实际应用"><!--[--><!--[--><!--]--><!--]-->antv G6的基础入门及树图的实际应用<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/Three.js/Three.js%E5%9F%BA%E7%A1%80%E8%AF%BE%E7%A8%8B.html" aria-label="Three.js"><!--[--><!--[--><!--]--><!--]-->Three.js<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="读书笔记"><span class="title">读书笔记</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="读书笔记"><span class="title">读书笔记</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/CSS%E6%8F%AD%E7%A7%98/CSS%E6%8F%AD%E7%A7%98.html" aria-label="《CSS揭秘》"><!--[--><!--[--><!--]--><!--]-->《CSS揭秘》<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/Python%E7%BC%96%E7%A8%8B%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E8%B7%B5.html" aria-label="《Python编程：从入门到实践》"><!--[--><!--[--><!--]--><!--]-->《Python编程：从入门到实践》<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="项目开发"><span class="title">项目开发</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="项目开发"><span class="title">项目开发</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/%E4%BD%8E%E4%BB%A3%E7%A0%81%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B9%B3%E5%8F%B0%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95.html" aria-label="低代码数据可视化平台开发记录"><!--[--><!--[--><!--]--><!--]-->低代码数据可视化平台开发记录<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/%E4%B8%AD%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E6%A8%A1%E6%9D%BF%E8%AE%B0%E5%BD%95.html" aria-label="中后台管理系统模板记录"><!--[--><!--[--><!--]--><!--]-->中后台管理系统模板记录<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/%E5%A4%9A%E9%A1%B5%E7%AD%BE%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95.html" aria-label="多页签开发记录"><!--[--><!--[--><!--]--><!--]-->多页签开发记录<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/项目开发/浙政钉、浙里办、浙江政务服务网应用上架指南.html" aria-label="浙政钉、浙里办、浙江政务服务网应用上架指南"><!--[--><!--[--><!--]--><!--]-->浙政钉、浙里办、浙江政务服务网应用上架指南<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/csmSimona" aria-label="Github" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Github<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="首页"><!--[--><!--[--><!--]--><!--]-->首页<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="前端基础汇总"><span class="title">前端基础汇总</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="前端基础汇总"><span class="title">前端基础汇总</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/JavaScript%E5%B0%8F%E8%AE%B0.html" aria-label="JavaScript小记"><!--[--><!--[--><!--]--><!--]-->JavaScript小记<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/HTML%E5%B0%8F%E8%AE%B0.html" aria-label="HTML小记"><!--[--><!--[--><!--]--><!--]-->HTML小记<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/CSS%E5%B0%8F%E8%AE%B0.html" aria-label="CSS小记"><!--[--><!--[--><!--]--><!--]-->CSS小记<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.html" aria-label="计算机网络"><!--[--><!--[--><!--]--><!--]-->计算机网络<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/React%E5%B0%8F%E8%AE%B0.html" aria-label="React小记"><!--[--><!--[--><!--]--><!--]-->React小记<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/Vue%E5%B0%8F%E8%AE%B0.html" aria-label="Vue小记"><!--[--><!--[--><!--]--><!--]-->Vue小记<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/%E6%89%8B%E5%86%99js.html" aria-label="手写js"><!--[--><!--[--><!--]--><!--]-->手写js<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96.html" aria-label="前端工程化"><!--[--><!--[--><!--]--><!--]-->前端工程化<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html" aria-label="前端性能优化"><!--[--><!--[--><!--]--><!--]-->前端性能优化<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/%E5%AE%9E%E9%99%85%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91.html" aria-label="实际项目开发"><!--[--><!--[--><!--]--><!--]-->实际项目开发<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/Typescript%E9%9D%A2%E8%AF%95%E9%A2%98.html" aria-label="Typescript面试题"><!--[--><!--[--><!--]--><!--]-->Typescript面试题<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/Nodejs%E9%9D%A2%E8%AF%95%E9%A2%98.html" aria-label="Nodejs面试题"><!--[--><!--[--><!--]--><!--]-->Nodejs面试题<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/其他/小程序.html" aria-label="小程序"><!--[--><!--[--><!--]--><!--]-->小程序<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="算法"><span class="title">算法</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E7%AE%97%E6%B3%95/%E6%8E%92%E5%BA%8F.html" aria-label="排序"><!--[--><!--[--><!--]--><!--]-->排序<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95%E9%A2%98.html" aria-label="算法题"><!--[--><!--[--><!--]--><!--]-->算法题<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="其他"><span class="title">其他</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="其他"><span class="title">其他</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%85%B6%E4%BB%96/Git%E5%B0%8F%E8%AE%B0.html" aria-label="Git小记"><!--[--><!--[--><!--]--><!--]-->Git小记<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%85%B6%E4%BB%96/NodeJs%E5%B0%8F%E8%AE%B0.html" aria-label="NodeJs小记"><!--[--><!--[--><!--]--><!--]-->NodeJs小记<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%85%B6%E4%BB%96/TypeScript%E5%B0%8F%E8%AE%B0.html" aria-label="TypeScript小记"><!--[--><!--[--><!--]--><!--]-->TypeScript小记<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%85%B6%E4%BB%96/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8.html" aria-label="正则表达式入门"><!--[--><!--[--><!--]--><!--]-->正则表达式入门<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%85%B6%E4%BB%96/Linux%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4.html" aria-label="Linux基本命令"><!--[--><!--[--><!--]--><!--]-->Linux基本命令<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%85%B6%E4%BB%96/PixiJS%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8.html" aria-label="PixiJS的基本使用"><!--[--><!--[--><!--]--><!--]-->PixiJS的基本使用<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E5%85%B6%E4%BB%96/PixiJS%E5%AE%9E%E7%8E%B0%E4%B8%80%E9%95%9C%E5%88%B0%E5%BA%95.html" aria-label="PixiJS实现一镜到底"><!--[--><!--[--><!--]--><!--]-->PixiJS实现一镜到底<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="数据可视化"><span class="title">数据可视化</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="数据可视化"><span class="title">数据可视化</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/Canvas%E5%85%A5%E9%97%A8.html" aria-label="Canvas入门"><!--[--><!--[--><!--]--><!--]-->Canvas入门<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/SVG%E5%85%A5%E9%97%A8.html" aria-label="SVG入门"><!--[--><!--[--><!--]--><!--]-->SVG入门<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/Echarts%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8.html" aria-label="Echarts基本使用"><!--[--><!--[--><!--]--><!--]-->Echarts基本使用<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/antvG6/antv%20G6%E7%9A%84%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E5%8F%8A%E6%A0%91%E5%9B%BE%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8.html" aria-label="antv G6的基础入门及树图的实际应用"><!--[--><!--[--><!--]--><!--]-->antv G6的基础入门及树图的实际应用<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/Three.js/Three.js%E5%9F%BA%E7%A1%80%E8%AF%BE%E7%A8%8B.html" aria-label="Three.js"><!--[--><!--[--><!--]--><!--]-->Three.js<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="读书笔记"><span class="title">读书笔记</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="读书笔记"><span class="title">读书笔记</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/CSS%E6%8F%AD%E7%A7%98/CSS%E6%8F%AD%E7%A7%98.html" aria-label="《CSS揭秘》"><!--[--><!--[--><!--]--><!--]-->《CSS揭秘》<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/Python%E7%BC%96%E7%A8%8B%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E8%B7%B5.html" aria-label="《Python编程：从入门到实践》"><!--[--><!--[--><!--]--><!--]-->《Python编程：从入门到实践》<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="项目开发"><span class="title">项目开发</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="项目开发"><span class="title">项目开发</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/%E4%BD%8E%E4%BB%A3%E7%A0%81%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B9%B3%E5%8F%B0%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95.html" aria-label="低代码数据可视化平台开发记录"><!--[--><!--[--><!--]--><!--]-->低代码数据可视化平台开发记录<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/%E4%B8%AD%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E6%A8%A1%E6%9D%BF%E8%AE%B0%E5%BD%95.html" aria-label="中后台管理系统模板记录"><!--[--><!--[--><!--]--><!--]-->中后台管理系统模板记录<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/%E5%A4%9A%E9%A1%B5%E7%AD%BE%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95.html" aria-label="多页签开发记录"><!--[--><!--[--><!--]--><!--]-->多页签开发记录<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/项目开发/浙政钉、浙里办、浙江政务服务网应用上架指南.html" aria-label="浙政钉、浙里办、浙江政务服务网应用上架指南"><!--[--><!--[--><!--]--><!--]-->浙政钉、浙里办、浙江政务服务网应用上架指南<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/csmSimona" aria-label="Github" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Github<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Three.js基础课程 <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="three-js基础课程" tabindex="-1"><a class="header-anchor" href="#three-js基础课程"><span>Three.js基础课程</span></a></h1><h2 id="开始" tabindex="-1"><a class="header-anchor" href="#开始"><span>开始</span></a></h2><p><a href="https://threejs.org/docs/index.html#manual/zh/introduction/Installation" title="官网" target="_blank" rel="noopener noreferrer"><strong>官网</strong></a></p><p><a href="http://www.webgl3d.cn/pages/aac9ab/" title="threejs教程电子书" target="_blank" rel="noopener noreferrer"><strong>threejs教程电子书</strong></a></p><p><a href="https://study.163.com/course/introduction.htm?courseId=1212760820&amp;_trace_c_p_k2_=48c4bca8f6884a47830c69fe8852ab56" title="学习视频" target="_blank" rel="noopener noreferrer"><strong>学习视频</strong></a></p><p><a href="https://study.163.com/course/introduction.htm?courseId=1213106822#/courseDetail?tab=1" title="blender教程" target="_blank" rel="noopener noreferrer"><strong>blender教程</strong></a></p><p><strong>3D模型gltf下载网站</strong></p><p><a href="http://www.webgl3d.cn/pages/c3ecc9/" title="http://www.webgl3d.cn/pages/c3ecc9/" target="_blank" rel="noopener noreferrer">http://www.webgl3d.cn/pages/c3ecc9/</a></p><p><a href="https://www.cpengx.cn/" title="https://www.cpengx.cn/" target="_blank" rel="noopener noreferrer">https://www.cpengx.cn/</a></p><p><strong>安装</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 比如安装148版本</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">npm</span><span style="color:#9CDCFE;"> install</span><span style="color:#9CDCFE;"> three</span><span style="color:#D4D4D4;">@</span><span style="color:#B5CEA8;">0.148</span><span style="color:#D4D4D4;">.</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;"> --</span><span style="color:#9CDCFE;">save</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>引入</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 引入three.js</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#569CD6;"> *</span><span style="color:#C586C0;"> as</span><span style="color:#9CDCFE;"> THREE</span><span style="color:#C586C0;"> from</span><span style="color:#CE9178;"> &#39;three&#39;</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>引入three.js其他扩展库</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 引入扩展库OrbitControls.js</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">OrbitControls</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/controls/OrbitControls.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 引入扩展库GLTFLoader.js</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">GLTFLoader</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/loaders/GLTFLoader.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 扩展库引入——旧版本，比如122, 新版本路径addons替换了examples/jsm</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">OrbitControls</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/examples/jsm/controls/OrbitControls.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="一、快速入门" tabindex="-1"><a class="header-anchor" href="#一、快速入门"><span>一、快速入门</span></a></h2><h3 id="创建第一个3d案例" tabindex="-1"><a class="header-anchor" href="#创建第一个3d案例"><span>创建第一个3D案例</span></a></h3><p>基本概念</p><p>场景Scene、相机Camera、渲染器Renderer</p><h4 id="第一步-创建3d场景" tabindex="-1"><a class="header-anchor" href="#第一步-创建3d场景"><span><a href="http://www.webgl3d.cn/pages/2e5d69/" title="第一步：创建3D场景" target="_blank" rel="noopener noreferrer">第一步：创建3D场景</a></span></a></h4><ol><li>创建 三维场景<code>Scene</code></li><li>创建 物体形状：几何体<code>Geometry</code></li><li>创建 物体外观：材质<code>Material</code></li><li>创建 物体：网格模型<code>Mesh</code></li><li>设置 模型位置<code>.position</code></li><li><code>.add()</code>方法 将模型添加到场景中</li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 引入three.js</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#569CD6;"> *</span><span style="color:#C586C0;"> as</span><span style="color:#9CDCFE;"> THREE</span><span style="color:#C586C0;"> from</span><span style="color:#CE9178;"> &#39;three&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">/**</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;"> * 创建3D场景对象Scene</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;"> */</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> scene</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Scene</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">/**</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;"> * 创建网格模型</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;"> */</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//创建一个长方体几何对象Geometry</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BoxGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 材质对象Material</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置为基础网格材质</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshBasicMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0x0000ff</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//设置材质颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">// 网格模型对象Mesh</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置网格模型在三维空间中的位置坐标，默认是坐标原点</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//网格模型添加到场景中 </span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// console.log(&#39;三维场景&#39;,scene);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="第二步-创建透视投影相机" tabindex="-1"><a class="header-anchor" href="#第二步-创建透视投影相机"><span><a href="http://www.webgl3d.cn/pages/c0b143/" title="第二步：创建透视投影相机" target="_blank" rel="noopener noreferrer">第二步：创建透视投影相机</a></span></a></h4><ol><li><p>实例化一个 透视投影相机<code>PerspectiveCamera</code></p></li><li><p>设置 相机位置.position</p></li><li><p>设置 相机观察目标<code>.lookAt()</code></p></li><li><p>定义相机渲染输出的画布尺寸</p></li><li><p>设置参数 透视投影相机<code>PerspectiveCamera</code>：视锥体</p><p>透视投影相机的四个参数<code>fov, aspect, near, far</code>构成一个<strong>四棱台</strong>3D空间，被称为<strong>视锥体</strong>，只有视锥体之内的物体，才会渲染出来，视锥体范围之外的物体不会显示在Canvas画布上。</p></li></ol><table><thead><tr><th>参数</th><th>含义</th><th>默认值</th></tr></thead><tbody><tr><td>fov</td><td>相机视锥体竖直方向视野角度</td><td>50</td></tr><tr><td>aspect</td><td>相机视锥体水平方向和竖直方向长度比，一般设置为Canvas画布宽高比width / height</td><td>1</td></tr><tr><td>near</td><td>相机视锥体近裁截面相对相机距离</td><td>0.1</td></tr><tr><td>far</td><td>相机视锥体远裁截面相对相机距离，far-near构成了视锥体高度方向</td><td>2000</td></tr><tr><td></td><td><img src="/assets/image__4ccPDRuht-CdO8L3kZ.png" alt=""></td><td></td></tr></tbody></table><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// width和height用来设置渲染后，输出的画布宽高度。</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> width</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">800</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//宽度</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> height</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">500</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//高度</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">/**</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;"> * 透视投影相机设置</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;"> */</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 30:视场角度, width / height:Canvas画布宽高比, 1:近裁截面, 3000：远裁截面</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> camera</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">PerspectiveCamera</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">30</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;"> / </span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3000</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">200</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">200</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">200</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//相机在Three.js三维坐标系中的位置</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//相机观察目标指向Threejs 3D空间中某个位置</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lookAt</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//坐标原点</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// camera.lookAt(0, 10, 0);  //y轴上位置10</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// camera.lookAt(mesh.position);//指向mesh对应的位置</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="第三步-创建渲染器" tabindex="-1"><a class="header-anchor" href="#第三步-创建渲染器"><span><a href="http://www.webgl3d.cn/pages/b483f0/" title="第三步：创建渲染器" target="_blank" rel="noopener noreferrer">第三步：创建渲染器</a></span></a></h4><ol><li>创建WebGL渲染器WebGLRenderer</li><li>设置Canvas画布尺寸<code>.setSize()</code></li><li>渲染器渲染方法<code>.render()</code></li><li>将canvas画布插入到web页面中 渲染器Canvas画布属性<code>.domElement</code></li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">/**</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;"> * 创建渲染器对象</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;"> */</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> renderer</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">WebGLRenderer</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setSize</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//设置three.js渲染区域的尺寸(像素px)</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//执行渲染操作，类比相机的拍照动作</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//three.js执行渲染命令会输出一个canvas画布，也就是一个HTML元素，你可以插入到web页面中</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">body</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">appendChild</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="三维坐标系" tabindex="-1"><a class="header-anchor" href="#三维坐标系"><span>三维坐标系</span></a></h3><ul><li>创建辅助观察坐标系</li></ul><p><code>THREE.AxesHelper()</code>的参数表示坐标系坐标轴线段尺寸大小，你可以根据需要改变尺寸。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// AxesHelper：辅助观察的坐标系</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> axesHelper</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">AxesHelper</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">150</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">axesHelper</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>材质半透明设置</li></ul><p>设置材质半透明,这样可以看到坐标系的坐标原点。</p><div class="language-typescript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-typescript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshBasicMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0x0000ff</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//设置材质颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    transparent:</span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//开启透明</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    opacity:</span><span style="color:#B5CEA8;">0.5</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//设置透明度</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>AxesHelper</code>的xyz轴</li></ul><p>three.js坐标轴颜色红<strong>R</strong>、绿<strong>G</strong>、蓝<strong>B</strong>分别对应坐标系的<strong>x</strong>、<strong>y</strong>、<strong>z</strong>轴，对于three.js的3D坐标系默认<strong>y轴朝上</strong>。</p><h3 id="光源" tabindex="-1"><a class="header-anchor" href="#光源"><span><a href="http://www.webgl3d.cn/pages/b9504a/" title="光源" target="_blank" rel="noopener noreferrer">光源</a></span></a></h3><p><img src="/assets/image_9-jNPMBVVE-O9Nm-bTC.png" alt=""></p><p><strong>基础网格材质</strong><a href="https://threejs.org/docs/index.html?q=MeshBasicMaterial#api/zh/materials/MeshBasicMaterial" title="MeshBasicMaterial" target="_blank" rel="noopener noreferrer">MeshBasicMaterial</a>不会受到光照影响。</p><p><strong>漫反射网格材质</strong><a href="https://threejs.org/docs/index.html?q=MeshLambertMaterial#api/zh/materials/MeshLambertMaterial" title="MeshLambertMaterial" target="_blank" rel="noopener noreferrer">MeshLambertMaterial</a>会受到光照影响，该材质也可以称为<strong>Lambert网格材质</strong>，音译为兰伯特网格材质。</p><ol><li>设置物体使用漫反射网格材质</li><li>创建点光源</li><li>设置光源位置</li><li>光源添加到场景</li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 材质对象Material</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 基础网格材质MeshBasicMaterial不受光照影响</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 漫反射网格材质；MeshLambertMaterial</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0x00ffff</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//设置材质颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">/**</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;"> * 光源设置</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;"> */</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//点光源</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> pointLight</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">PointLight</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xffffff</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1.0</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">// 光照颜色、光照强度</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">pointLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">decay</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0.0</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//光源光照强度不随距离改变衰减</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//点光源位置</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// pointLight.position.set(400, 0, 0);//点光源放在x轴上</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">pointLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">400</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">200</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">300</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//偏移光源位置，观察渲染效果变化</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">pointLight</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//点光源添加到场景中</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>点光源辅助观察<code>PointLightHelper</code></li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 光源辅助观察</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> pointLightHelper</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">PointLightHelper</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">pointLight</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">// 要模拟的光源, 辅助对象的尺寸</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">pointLightHelper</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="相机控件orbitcontrols" tabindex="-1"><a class="header-anchor" href="#相机控件orbitcontrols"><span>相机控件OrbitControls</span></a></h3><ul><li>旋转：拖动鼠标左键</li><li>缩放：滚动鼠标中键</li><li>平移：拖动鼠标右键</li></ul><ol><li>引入扩展库OrbitControls.js</li><li>创建OrbitControls实例</li><li>监听控制器，执行渲染操作</li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 引入轨道控制器扩展库OrbitControls.js</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    OrbitControls</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">} </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/controls/OrbitControls.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置相机控件轨道控制器OrbitControls</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> controls</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> OrbitControls</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 如果OrbitControls改变了相机参数，重新调用渲染器渲染三维场景</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">controls</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addEventListener</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;change&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> () {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//执行渲染操作</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 浏览器控制台查看相机位置变化</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;camera.position&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span><span style="color:#6A9955;">//监听鼠标、键盘事件</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="环境光" tabindex="-1"><a class="header-anchor" href="#环境光"><span>环境光</span></a></h3><p>环境光<a href="https://threejs.org/docs/index.html?q=AmbientLight#api/zh/lights/AmbientLight" title="AmbientLight (opens new window)" target="_blank" rel="noopener noreferrer">AmbientLight (opens new window)</a>没有特定方向，只是整体改变场景的光照明暗。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//环境光:没有特定方向，整体改变场景的光照明暗</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> ambient</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">AmbientLight</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xffffff</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0.4</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">// 光照颜色、光照强度</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">ambient</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="平行光" tabindex="-1"><a class="header-anchor" href="#平行光"><span>平行光</span></a></h3><p>平行光<a href="https://threejs.org/docs/index.html?q=DirectionalLight#api/zh/lights/DirectionalLight" title="DirectionalLight (opens new window)" target="_blank" rel="noopener noreferrer">DirectionalLight (opens new window)</a>就是沿着特定方向发射。</p><ol><li>创建平行光</li><li>设置光源的方向position</li><li>设置光源指向对象 target，默认为原点</li><li>光源添加到场景</li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 平行光</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> directionalLight</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">DirectionalLight</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xffffff</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置光源的方向：通过光源position属性和目标指向对象的position属性计算</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 方向光指向对象网格模型mesh，可以不设置，默认的位置是0,0,0</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">target</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>平行光辅助观察DirectionalLightHelper</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// DirectionalLightHelper：可视化平行光</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> dirLightHelper</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">DirectionalLightHelper</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0xff0000</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">// 模拟光源，辅助对象尺寸，模拟光源的颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">dirLightHelper</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="动画渲染循环" tabindex="-1"><a class="header-anchor" href="#动画渲染循环"><span>动画渲染循环</span></a></h3><ul><li>请求动画帧<code>window.requestAnimationFrame</code><ul><li>threejs可以借助HTML5的API请求动画帧<code>window.requestAnimationFrame</code>实现动画渲染。</li><li>requestAnimationFrame实现周期性循环执行</li><li>requestAnimationFrame默认每秒钟执行60次，但不一定能做到，要看代码的性能</li></ul></li><li>创建渲染器对象后执行渲染操作就可以放到渲染循环中做了</li><li>设置了渲染循环，相机控件OrbitControls就不用再通过事件<code>change</code>执行渲染操作了</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">/**</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;"> * 创建渲染器对象</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;"> */</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> renderer</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">WebGLRenderer</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setSize</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//设置three.js渲染区域的尺寸(像素px)</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// renderer.render(scene, camera); //执行渲染操作</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//three.js执行渲染命令会输出一个canvas画布，也就是一个HTML元素，你可以插入到web页面中</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">body</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">appendChild</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 渲染循环</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// requestAnimationFrame实现周期性循环执行</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// requestAnimationFrame默认每秒钟执行60次，但不一定能做到，要看代码的性能</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">function</span><span style="color:#DCDCAA;"> render</span><span style="color:#D4D4D4;">() {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//执行渲染操作</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">rotateY</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0.01</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//每次绕y轴旋转0.01弧度</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">    requestAnimationFrame</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">render</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//请求再次执行渲染函数render，渲染下一帧</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置相机控件轨道控制器OrbitControls</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> controls</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> OrbitControls</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// // 如果OrbitControls改变了相机参数，重新调用渲染器渲染三维场景</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// controls.addEventListener(&#39;change&#39;, function () {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//     renderer.render(scene, camera); //执行渲染操作</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// }); //监听鼠标、键盘事件</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="canvas画布宽高度动态变化" tabindex="-1"><a class="header-anchor" href="#canvas画布宽高度动态变化"><span>canvas画布宽高度动态变化</span></a></h3><p>canvas画布宽高度动态变化,需要更新相机和渲染的参数，否则无法正常渲染。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// onresize 事件会在窗口被调整大小时发生</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">onresize</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> () {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 重置渲染器输出画布canvas尺寸</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setSize</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">innerWidth</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">innerHeight</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 全屏情况下：设置观察范围长宽比aspect为窗口宽高比</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">aspect</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">innerWidth</span><span style="color:#D4D4D4;"> / </span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">innerHeight</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 渲染器执行render方法的时候会读取相机对象的投影矩阵属性projectionMatrix</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 但是不会每渲染一帧，就通过相机的属性计算投影矩阵(节约计算资源)</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 如果相机的一些属性发生了变化，需要执行updateProjectionMatrix ()方法更新相机的投影矩阵</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    camera</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">updateProjectionMatrix</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">};</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="通过stats-js扩展库-查看threejs渲染帧率" tabindex="-1"><a class="header-anchor" href="#通过stats-js扩展库-查看threejs渲染帧率"><span>通过stats.js扩展库 查看threejs渲染帧率</span></a></h3><p>通过stats.js库可以查看three.js当前的渲染性能，具体说就是计算three.js的渲染帧率(FPS)。</p><p>所谓渲染帧率(FPS)，简单说就是three.js每秒钟完成的渲染次数，一般渲染达到每秒钟60次为最佳状态。</p><ol><li>引入Stats</li><li>创建Stats对象</li><li>将 stats.domElement 插入到web页面中</li><li>在渲染函数中调用方法 stats.update()，来刷新时间</li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//引入性能监视器stats.js,显示帧率</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#9CDCFE;"> Stats</span><span style="color:#C586C0;"> from</span><span style="color:#CE9178;"> &#39;three/addons/libs/stats.module.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//创建stats对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> stats</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Stats</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//Stats.domElement:web页面上输出计算结果,一个div元素</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">body</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">appendChild</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">stats</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 渲染循环</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">function</span><span style="color:#DCDCAA;"> render</span><span style="color:#D4D4D4;">() {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    stats</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">update</span><span style="color:#D4D4D4;">();</span><span style="color:#6A9955;">//渲染循环中执行stats.update()来刷新时间</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">); </span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">rotateY</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0.01</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">    requestAnimationFrame</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">render</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>设置显示模式 setMode</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// stats.domElement显示：渲染帧率  刷新频率,一秒渲染次数 </span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">stats</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setMode</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">// 默认模式</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// stats.domElement显示：渲染周期  渲染一帧多长时间(单位：毫秒ms)</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">stats</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setMode</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="threejs常见几何体简介" tabindex="-1"><a class="header-anchor" href="#threejs常见几何体简介"><span>Threejs常见几何体简介</span></a></h3><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//BoxGeometry：长方体</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BoxGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// SphereGeometry：球体</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">SphereGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// CylinderGeometry：圆柱</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">CylinderGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// PlaneGeometry：矩形平面</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">PlaneGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// CircleGeometry：圆形平面</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">CircleGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Three.js的材质<strong>默认正面可见</strong>，反面不可见,对于<strong>矩形</strong>平面<code>PlaneGeometry</code>、<strong>圆形</strong>平面如果你想看到两面，可以设置<code>side: THREE.DoubleSide</code>。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0x00ffff</span><span style="color:#D4D4D4;">, </span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // side: THREE.FrontSide, // 默认只有正面可见</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    side:</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">DoubleSide</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">// 双面可见</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="高光网格材质phong" tabindex="-1"><a class="header-anchor" href="#高光网格材质phong"><span>高光网格材质Phong</span></a></h3><p><img src="/assets/image_9YCJiuW0Wc-is-WMglF.png" alt=""></p><p><code>MeshPhongMaterial</code>可以提供一个镜面反射效果，该材质可以模拟具有镜面高光的光泽表面（例如涂漆木材）。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 模拟镜面反射，产生一个高光效果</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshPhongMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0xff0000</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    shininess:</span><span style="color:#B5CEA8;"> 20</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// 高光部分的亮度，默认30</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    specular:</span><span style="color:#B5CEA8;"> 0x444444</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// 高光部分的颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="webgl渲染器设置" tabindex="-1"><a class="header-anchor" href="#webgl渲染器设置"><span>WebGL渲染器设置</span></a></h3><ul><li>渲染器锯齿属性<code>.antialias</code></li><li>设置设备像素比<code>.setPixelRatio()</code></li><li>设置背景颜色<code>.setClearColor()</code></li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// WebGL渲染器设置</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> renderer</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">WebGLRenderer</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    antialias:</span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//开启优化锯齿</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setSize</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">body</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">appendChild</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 不同硬件设备的屏幕的设备像素比window.devicePixelRatio值可能不同</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;查看当前屏幕设备像素比&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">devicePixelRatio</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 获取你屏幕对应的设备像素比.devicePixelRatio告诉threejs,以免渲染模糊问题</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setPixelRatio</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">devicePixelRatio</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setClearColor</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0x444444</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//设置背景颜色</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="gui-js扩展库-可视化调整三维场景" tabindex="-1"><a class="header-anchor" href="#gui-js扩展库-可视化调整三维场景"><span>gui.js扩展库（可视化调整三维场景）</span></a></h3><ul><li><p>引入gui.js</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 引入dat.gui.js的一个类GUI</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">GUI</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/libs/lil-gui.module.min.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>创建一个GUI对象</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 实例化一个gui对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> gui</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> GUI</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 改变交互界面style属性</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">gui</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">style</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">right</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;0px&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">gui</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">style</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;300px&#39;</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>.add()</code>方法快速创建UI交互界面</p><p>格式：<code>.add(控制对象，对象具体属性，其他参数)</code></p><ul><li><p>拖动条</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 一个网格模型</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BoxGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span><span style="color:#9CDCFE;">color:</span><span style="color:#B5CEA8;"> 0x00ffff</span><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 通过GUI改变mesh.position对象的xyz属性</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">gui</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;x&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">180</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">gui</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;y&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">180</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">gui</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;z&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">180</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>下拉菜单</p><p>参数3是<strong>数组或对象</strong>时，生成的交互界面是下拉菜单</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">gui</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;x&#39;</span><span style="color:#D4D4D4;">, [-</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">gui</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;y&#39;</span><span style="color:#D4D4D4;">, {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  左:</span><span style="color:#D4D4D4;"> -</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// 可以用中文</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  中:</span><span style="color:#B5CEA8;"> 0</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  右:</span><span style="color:#B5CEA8;"> 100</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>单选框</p><p>如果<code>.add()</code>改变属性的对应的数据类型如果是布尔值，那么交互界面就是一个单选框。</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="控制一个对象是否旋转"><span>控制一个对象是否旋转</span></div><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> obj</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    rotate:</span><span style="color:#569CD6;"> false</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">};</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">gui</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;rotate&#39;</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">name</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;是否旋转&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 渲染循环</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">function</span><span style="color:#DCDCAA;"> render</span><span style="color:#D4D4D4;">() {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 当gui界面设置obj.rotate为true，mesh执行旋转动画</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">    if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">rotate</span><span style="color:#D4D4D4;">) </span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">rotateY</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0.01</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">    requestAnimationFrame</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">render</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p><code>.name()</code>方法 改变gui生成交互界面显示的内容</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//光源设置</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> directionalLight</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">DirectionalLight</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xffffff</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> ambient</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">AmbientLight</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xffffff</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0.4</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">ambient</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 通过GUI改变光照强度，范围0-2</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">gui</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">ambient</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;intensity&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2.0</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">name</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;环境光强度&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">gui</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;intensity&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2.0</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">name</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;平行光强度&#39;</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>步长<code>.step()</code>方法 设置交互界面每次改变属性值的间隔</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">gui</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">ambient</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;intensity&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2.0</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">name</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;环境光强度&#39;</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">step</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0.1</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><code>.onChange()</code>方法监听对应交互界面的属性变化</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> obj</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    x:</span><span style="color:#B5CEA8;"> 30</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">};</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 当obj的x属性变化的时候，就把此时obj.x的值value赋值给mesh的x坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">gui</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;x&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">180</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">onChange</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">value</span><span style="color:#D4D4D4;">){</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">  // 你可以写任何你想跟着obj.x同步变化的代码</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">value</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>.addColor()</code>生成颜色值改变的交互界面</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">gui</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addColor</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;color&#39;</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><code>.addFolder()</code>分组</p><p><code>.addFolder()</code>返回的子文件夹对象，同样具有gui对象的<code>.add()</code>、<code>.onChange()</code>、<code>.addColor()</code>等等属性。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> gui</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> GUI</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//创建GUI对象 </span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> obj</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0x00ffff</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">// 材质颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">};</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建材质子菜单</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> matFolder</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">gui</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addFolder</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;材质&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 材质颜色color</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">matFolder</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addColor</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;color&#39;</span><span style="color:#D4D4D4;">)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>关闭<code>.close()</code>和展开<code>.open()</code>交互界面</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// gui.close();//关闭菜单</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">matFolder</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">close</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="二、缓冲类型几何体buffergeometry" tabindex="-1"><a class="header-anchor" href="#二、缓冲类型几何体buffergeometry"><span>二、缓冲类型几何体BufferGeometry</span></a></h2><p>BufferGeometry是一个没有任何形状的空几何体，你可以通过BufferGeometry自定义任何几何形状，具体一点说就是定义<strong>顶点数据</strong>。</p><h3 id="定义一个几何体" tabindex="-1"><a class="header-anchor" href="#定义一个几何体"><span>定义一个几何体</span></a></h3><ol><li>通过缓冲类型几何体<code>BufferGeometry</code>创建空几何体对象</li><li>通过javascript<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Typed_arrays" title="类型化数组" target="_blank" rel="noopener noreferrer">类型化数组</a><code>Float32Array</code>创建一组xyz坐标数据用来表示几何体的顶点坐标</li><li>通过<code>BufferAttribute</code>定义几何体顶点数据</li><li>设置几何体顶点<code>.attributes.position</code></li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferGeometry</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//创建一个空几何体对象</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//类型数组创建顶点数据</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> vertices</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Float32Array</span><span style="color:#D4D4D4;">([</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点1坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点2坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点3坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点4坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点5坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点6坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建属性缓冲区对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> attribue</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">vertices</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//3个为一组，表示一个顶点的xyz坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置几何体attributes属性的位置属性</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">attributes</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">attribue</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建点模型对象" tabindex="-1"><a class="header-anchor" href="#创建点模型对象"><span>创建点模型对象</span></a></h3><ol><li>创建点材质<code>PointsMaterial</code></li><li>使用几何体和点材质 创建点模型对象<code>Points</code></li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 点渲染模式</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">PointsMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0xffff00</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    size:</span><span style="color:#B5CEA8;"> 10.0</span><span style="color:#6A9955;"> //点对象像素尺寸</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}); </span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> points</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Points</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">// 点模型对象</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建线模型对象" tabindex="-1"><a class="header-anchor" href="#创建线模型对象"><span>创建线模型对象</span></a></h3><ol><li>创建线材质<code>LineBasicMaterial</code></li><li>使用几何体和线材质 创建线模型对象 <ul><li><code>Line</code>：一条连续的线</li><li><code>LineLoop</code>：一条头尾相接的连续的线</li><li><code>LineSegments</code>：线段</li></ul></li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 线条渲染模式</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineBasicMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0xffff00</span><span style="color:#6A9955;"> //线条颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}); </span><span style="color:#6A9955;">//材质对象</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建线模型对象   构造函数：Line、LineLoop、LineSegments</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> line</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Line</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//线条模型对象</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建网格模型对象" tabindex="-1"><a class="header-anchor" href="#创建网格模型对象"><span>创建网格模型对象</span></a></h3><p>网格模型Mesh其实就一个一个三角形(面)拼接构成。使用网格模型Mesh渲染几何体geometry，就是几何体所有顶点坐标三个为一组，构成一个三角形，多组顶点构成多个三角形，就可以用来模拟表示物体的表面。</p><p>空间中一个三角形有正反两面，那么Three.js的规则是如何区分正反面的？非常简单，你的眼睛(相机)对着三角形的一个面，<strong>如果三个顶点的顺序是逆时针方向，该面视为正面，如果三个顶点的顺序是顺时针方向，该面视为反面。</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshBasicMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0x00ffff</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//材质颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // side: THREE.FrontSide, //默认只有正面可见</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // side: THREE.BackSide, //设置只有背面可见</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    side:</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">DoubleSide</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//两面可见</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 网格模型本质：一个一个三角形(面)构成</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="构建一个矩形平面几何体" tabindex="-1"><a class="header-anchor" href="#构建一个矩形平面几何体"><span>构建一个矩形平面几何体</span></a></h3><p>一个矩形平面，可以至少通过两个三角形拼接而成。而且两个三角形有两个顶点的坐标是重合的。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//类型数组创建顶点数据</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> vertices</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Float32Array</span><span style="color:#D4D4D4;">([</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点1坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    80</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点2坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    80</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点3坐标</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点4坐标   和顶点1位置相同</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    80</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点5坐标  和顶点3位置相同</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点6坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">]);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="几何体顶点索引数据" tabindex="-1"><a class="header-anchor" href="#几何体顶点索引数据"><span>几何体顶点索引数据</span></a></h3><p>可以借助几何体顶点索引<code>geometry.index</code>来减少顶点坐标数据量</p><p>1、把上一节三角形重复的顶点位置坐标删除</p><p>2、通过Uint16Array类型数组创建顶点索引数据</p><p>3、索引数据赋值给几何体的index属性</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#569CD6;"> *</span><span style="color:#C586C0;"> as</span><span style="color:#9CDCFE;"> THREE</span><span style="color:#C586C0;"> from</span><span style="color:#CE9178;"> &#39;three&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferGeometry</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//创建一个几何体对象</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 类型数组创建顶点数据 把上一节三角形重复的顶点位置坐标删除</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> vertices</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Float32Array</span><span style="color:#D4D4D4;">([</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点1坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    80</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点2坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    80</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点3坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点4坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建属性缓冲区对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> attribue</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">vertices</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//3个为一组，表示一个顶点的xyz坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置几何体attributes属性的位置属性</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">attributes</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">attribue</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// Uint16Array类型数组创建顶点索引数据</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> indexes</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Uint16Array</span><span style="color:#D4D4D4;">([</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">])</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// BufferAttribute表示顶点索引属性的值</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">index</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">indexes</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">// 1个为一组</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 索引数据赋值给几何体的index属性</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshBasicMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0x00ffff</span><span style="color:#D4D4D4;">, </span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // side: THREE.FrontSide, //默认只有正面可见</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // side: THREE.BackSide, //设置只有背面可见</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    side:</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">DoubleSide</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//两面可见</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 网格模型本质：一个一个三角形(面)构成</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">export</span><span style="color:#C586C0;"> default</span><span style="color:#9CDCFE;"> mesh</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="顶点法线数据" tabindex="-1"><a class="header-anchor" href="#顶点法线数据"><span>顶点法线数据</span></a></h3><p>把前面两节课的案例源码中<code>MeshBasicMaterial</code>材质改为<code>MeshLambertMaterial</code>材质，你会发现原来的矩形平面无法正常渲染，这其实很简单，使用受光照影响的材质，几何体BufferGeometry需要定义<strong>顶点法线</strong>数据<code>.attributes.normal</code>。</p><p>Three.js中法线是通过顶点定义，默认情况下，每个顶点都有一个法线数据，就像每一个顶点都有一个位置数据。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 矩形平面，有索引，两个三角形，有2个顶点重合，有4个顶点</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 每个顶点的法线数据和顶点位置数据一一对应</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> normals</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Float32Array</span><span style="color:#D4D4D4;">([</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点1法线( 法向量 )</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点2法线</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点3法线</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点4法线</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置几何体的顶点法线属性.attributes.normal</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">attributes</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">normal</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">normals</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// MeshBasicMaterial不受光照影响</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 使用受光照影响的材质，几何体Geometry需要定义顶点法线数据</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0x0000ff</span><span style="color:#D4D4D4;">, </span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    side:</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">DoubleSide</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//两面可见</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查看threejs自带几何体顶点" tabindex="-1"><a class="header-anchor" href="#查看threejs自带几何体顶点"><span><a href="http://www.webgl3d.cn/pages/d8b07b/" title="查看threejs自带几何体顶点" target="_blank" rel="noopener noreferrer">查看threejs自带几何体顶点</a></span></a></h3><h3 id="旋转、缩放、平移几何体" tabindex="-1"><a class="header-anchor" href="#旋转、缩放、平移几何体"><span><a href="http://www.webgl3d.cn/pages/1b0d6c/" title="旋转、缩放、平移几何体" target="_blank" rel="noopener noreferrer">旋转、缩放、平移几何体</a></span></a></h3><h2 id="三、模型对象、材质" tabindex="-1"><a class="header-anchor" href="#三、模型对象、材质"><span>三、模型对象、材质</span></a></h2><p>点模型<code>Points</code>、线模型<code>Line</code>、网格网格模型<code>Mesh</code>等模型对象的父类都是<a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/core/Object3D" title="Object3D" target="_blank" rel="noopener noreferrer">Object3D</a></p><h3 id="三维向量vector3与模型位置-position" tabindex="-1"><a class="header-anchor" href="#三维向量vector3与模型位置-position"><span>三维向量Vector3与模型位置.position</span></a></h3><p>三维向量<code>Vector3</code>有xyz三个分量，threejs中会用三维向量<code>Vector3</code>表示很多种数据，例如位置<code>.position</code>和缩放<code>.scale</code>属性。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//new THREE.Vector3()实例化一个三维向量对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> v3</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;v3&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">v3</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">v3</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//set方法设置向量的值</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">v3</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//访问x、y或z属性改变某个分量的值</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>改变模型位置</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 或者</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>缩放</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scale</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">2.0</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 或者</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scale</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0.5</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1.5</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>沿着自定义的方向移动</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//向量Vector3对象表示方向</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> axis</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">axis</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">normalize</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//向量归一化</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//沿着axis轴表示方向平移100</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">translateOnAxis</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">axis</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="欧拉euler与角度属性-rotation" tabindex="-1"><a class="header-anchor" href="#欧拉euler与角度属性-rotation"><span>欧拉Euler与角度属性.rotation</span></a></h3><p>模型的角度属性<code>.rotation</code>的属性值是欧拉对象<a href="https://threejs.org/docs/index.html?q=Euler#api/zh/math/Euler" title="Euler" target="_blank" rel="noopener noreferrer">Euler</a></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 创建一个欧拉对象，表示绕着xyz轴分别旋转45度，0度，90度</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> Euler</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Euler</span><span style="color:#D4D4D4;">( </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;">/</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;">/</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 也可以通过属性设置欧拉对象的三个分量值。</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> Euler</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Euler</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">Euler</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;">/</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">Euler</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;">/</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">Euler</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">z</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;">/</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>改变角度</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//绕y轴的角度设置为60度</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">rotation</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;">/</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//绕y轴的角度增加60度</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">rotation</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;"> += </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;">/</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//绕y轴的角度减去60度</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">rotation</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;"> -= </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;">/</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 绕x轴旋转π/4</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">rotateX</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;">/</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>绕某个轴旋转</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> axis</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//向量axis</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">rotateOnAxis</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">axis</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;">/</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//绕y轴旋转60度</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>旋转动画</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 渲染循环</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">function</span><span style="color:#DCDCAA;"> render</span><span style="color:#D4D4D4;">() {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    model</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">rotation</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;">+=</span><span style="color:#B5CEA8;">0.01</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 或 model.rotateY(0.01);</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">    requestAnimationFrame</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">render</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="克隆-clone-和复制-copy" tabindex="-1"><a class="header-anchor" href="#克隆-clone-和复制-copy"><span>克隆.clone()和复制.copy()</span></a></h3><p>克隆<code>.clone()</code>简单说就是复制并实例化一个和原对象一样的新对象</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> v1</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;v1&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">v1</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//v2是一个新的Vector3对象，和v1的.x、.y、.z属性值一样</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> v2</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">v1</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">clone</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;v2&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">v2</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>复制<code>.copy()</code>简单说就是把一个对象属性的属性值赋值给另一个对象</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> v1</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> v3</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//读取v1.x、v1.y、v1.z的赋值给v3.x、v3.y、v3.z</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">v3</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">copy</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">v1</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// Mesh克隆</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh2</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">clone</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh2</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 注意：通过克隆.clone()获得的新模型和原来的模型共享材质和几何体</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 改变材质颜色，或者说改变mesh2颜色，mesh和mesh2颜色都会改变</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// material.color.set(0xffff00);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh2</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">color</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xffff00</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 解决方法：克隆几何体和材质，重新设置mesh2的材质和几何体属性</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh2</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">clone</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh2</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">clone</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 改变mesh2颜色，不会改变mesh的颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh2</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">color</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xff0000</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="四、层级模型" tabindex="-1"><a class="header-anchor" href="#四、层级模型"><span>四、层级模型</span></a></h2><ul><li>创建了两个网格模型mesh1、mesh2</li><li>通过<code>THREE.Group</code>类创建一个组对象group，通过<code>add</code>方法把网格模型mesh1、mesh2作为设置为组对象group的子对象</li><li>通过执行<code>scene.add(group)</code>把组对象group作为场景对象的scene的子对象</li></ul><p>这样就构成了一个三层的层级结构</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//创建两个网格模型mesh1、mesh2</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BoxGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span><span style="color:#9CDCFE;">color:</span><span style="color:#B5CEA8;"> 0x00ffff</span><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> group</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Group</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh1</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh2</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh2</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">translateX</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">25</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//把mesh1型插入到组group中，mesh1作为group的子对象</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">group</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh1</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//把mesh2型插入到组group中，mesh2作为group的子对象</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">group</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh2</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//把group插入到场景中作为场景子对象</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">group</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="遍历模型树结构" tabindex="-1"><a class="header-anchor" href="#遍历模型树结构"><span>遍历模型树结构</span></a></h3><p><img src="/assets/image_itdo74-msC-CGPSaLML.png" alt=""></p><p>通过<code>.traverse()</code>递归遍历一个模型对象包含的所有后代</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 递归遍历model包含所有的模型节点</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">model</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">traverse</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;所有模型节点的名称&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // obj.isMesh：if判断模型对象obj是不是网格模型&#39;Mesh&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">    if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">isMesh</span><span style="color:#D4D4D4;">) {</span><span style="color:#6A9955;">//判断条件也可以是obj.type === &#39;Mesh&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">color</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xffff00</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查询模型节点" tabindex="-1"><a class="header-anchor" href="#查询模型节点"><span>查询模型节点</span></a></h3><p>查找某个具体的模型<code>.getObjectByName()</code></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 返回名.name为&quot;4号楼&quot;对应的对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> nameNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getObjectByName</span><span style="color:#D4D4D4;"> (</span><span style="color:#CE9178;">&quot;4号楼&quot;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">nameNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">color</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xff0000</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="本地坐标和世界坐标" tabindex="-1"><a class="header-anchor" href="#本地坐标和世界坐标"><span>本地坐标和世界坐标</span></a></h3><p>任何一个模型的<strong>本地坐标</strong>(<strong>局部坐标</strong>)就是模型的<code>.position</code>属性。</p><p>一个模型的<strong>世界坐标</strong>，说的是，模型自身<code>.position</code>和所有父对象<code>.position</code>累加的坐标。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// mesh的世界坐标就是mesh.position与group.position的累加</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">); </span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> group</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Group</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">group</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">group</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**<code>.getWorldPosition()</code>**<strong>获取世界坐标</strong></p><p><code>mesh.getWorldPosition(Vector3)</code>读取一个模型的世界坐标，并把读取结果存储到参数<code>Vector3</code>中。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 声明一个三维向量用来表示某个坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> worldPosition</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 获取mesh的世界坐标，你会发现mesh的世界坐标受到父对象group的.position影响</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getWorldPosition</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">worldPosition</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;世界坐标&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">worldPosition</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;本地坐标&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**<code>.add</code>**<strong>给子对象添加一个局部坐标系</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//可视化mesh的局部坐标系</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> meshAxesHelper</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">AxesHelper</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">meshAxesHelper</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>改变模型相对局部坐标原点位置</strong></p><p>通过改变几何体顶点坐标，可以改变模型自身相对坐标原点的位置</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//长方体的几何中心默认与本地坐标原点重合</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BoxGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 平移几何体的顶点坐标,改变几何体自身相对局部坐标原点的位置</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">translate</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">/</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="移除对象-remove" tabindex="-1"><a class="header-anchor" href="#移除对象-remove"><span><a href="http://www.webgl3d.cn/pages/e66ea7/" title="移除对象" target="_blank" rel="noopener noreferrer">移除对象</a><a href="http://www.webgl3d.cn/pages/e66ea7/" title=".remove()" target="_blank" rel="noopener noreferrer">.remove()</a></span></a></h3><h3 id="模型隐藏或显示visible" tabindex="-1"><a class="header-anchor" href="#模型隐藏或显示visible"><span><a href="http://www.webgl3d.cn/pages/eeb05a/" title="模型隐藏或显示" target="_blank" rel="noopener noreferrer">模型隐藏或显示</a><a href="http://www.webgl3d.cn/pages/eeb05a/" title="visible" target="_blank" rel="noopener noreferrer">visible</a></span></a></h3><h2 id="五、顶点uv坐标、纹理贴图" tabindex="-1"><a class="header-anchor" href="#五、顶点uv坐标、纹理贴图"><span>五、顶点UV坐标、纹理贴图</span></a></h2><h3 id="创建纹理贴图" tabindex="-1"><a class="header-anchor" href="#创建纹理贴图"><span>创建纹理贴图</span></a></h3><p>通过纹理贴图加载器<code>TextureLoader</code>的<code>load()</code>方法加载一张图片可以返回一个纹理对象<code>Texture</code>，纹理对象<code>Texture</code>可以作为模型材质颜色贴图<code>.map</code>属性的值。</p><p><strong>注意：最新版本，webgl渲染器默认编码方式已经改变，为了避免色差，纹理对象编码方式要修改为</strong>**<code>THREE.SRGBColorSpace</code>**</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">PlaneGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">200</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">); </span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//纹理贴图加载器TextureLoader</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> texLoader</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">TextureLoader</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// .load()方法加载图像，返回一个纹理对象Texture</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> texture</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">texLoader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;./earth.jpg&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">texture</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">colorSpace</span><span style="color:#D4D4D4;">  = </span><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">SRGBColorSpace</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//设置为SRGB颜色空间</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 设置纹理贴图：Texture对象作为材质map属性的属性值</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    map:</span><span style="color:#9CDCFE;"> texture</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//map表示材质的颜色贴图属性</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="自定义顶点uv坐标" tabindex="-1"><a class="header-anchor" href="#自定义顶点uv坐标"><span>自定义顶点UV坐标</span></a></h3><p><strong>顶点UV坐标</strong>的作用是从纹理贴图上提取像素映射到网格模型Mesh的几何体表面上。</p><p>顶点UV坐标可以在0~1.0之间任意取值，纹理贴图<strong>左下角</strong>对应的UV坐标是<code>(0,0)</code>，<strong>右上角</strong>对应的坐标<code>(1,1)</code>。</p><p>顶点UV坐标<code>geometry.attributes.uv</code>和顶点位置坐标<code>geometry.attributes.position</code>是一一对应的</p><p>自定义顶点UV：</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">/**纹理坐标0~1之间随意定义*/</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> uvs</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Float32Array</span><span style="color:#D4D4D4;">([</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//图片左下角</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//图片右下角</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//图片右上角</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//图片左上角</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置几何体attributes属性的位置normal属性</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">attributes</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">uv</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">uvs</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//2个为一组,表示一个顶点的纹理坐标</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="圆形平面设置纹理贴图" tabindex="-1"><a class="header-anchor" href="#圆形平面设置纹理贴图"><span>圆形平面设置纹理贴图</span></a></h3><p>通过圆形几何体<code>CircleGeometry</code>创建一个网格模型Mesh，把一张图片作为圆形Mesh材质的颜色贴图，这样就可以把一张方形图片剪裁渲染为圆形效果。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//CircleGeometry的顶点UV坐标是按照圆形采样纹理贴图</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">CircleGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//纹理贴图加载器TextureLoader</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> texLoader</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">TextureLoader</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> texture</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">texLoader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;./texture.jpg&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshBasicMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    map:</span><span style="color:#9CDCFE;"> texture</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//map表示材质的颜色贴图属性</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    side:</span><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">DoubleSide</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="纹理对象texture阵列" tabindex="-1"><a class="header-anchor" href="#纹理对象texture阵列"><span>纹理对象Texture阵列</span></a></h3><p>使用threejs纹理对象<code>Texture</code>的阵列功能+矩形平面几何体<code>PlaneGeometry</code>实现一个地面瓷砖效果</p><ol><li><p>矩形平面设置颜色贴图</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">PlaneGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">2000</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2000</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//纹理贴图加载器TextureLoader</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> texLoader</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">TextureLoader</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// .load()方法加载图像，返回一个纹理对象Texture</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> texture</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">texLoader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;./瓷砖.jpg&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 设置纹理贴图：Texture对象作为材质map属性的属性值</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    map:</span><span style="color:#9CDCFE;"> texture</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//map表示材质的颜色贴图属性</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>纹理对象<code>Texture</code>的阵列功能</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// .load()方法加载图像，返回一个纹理对象Texture</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> texture</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">texLoader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;./瓷砖.jpg&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置阵列模式</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">texture</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">wrapS</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">RepeatWrapping</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">texture</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">wrapT</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">RepeatWrapping</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// uv两个方向纹理重复数量</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">texture</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">repeat</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">12</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">12</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//注意选择合适的阵列数量</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>旋转矩形平面</p><p>矩形平面默认是在XOY平面上，如果你想平行于XOZ平面，就需要手动旋转。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 旋转矩形平面</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">rotateX</span><span style="color:#D4D4D4;">(-</span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;">/</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="矩形mesh-背景透明png贴图" tabindex="-1"><a class="header-anchor" href="#矩形mesh-背景透明png贴图"><span>矩形Mesh+背景透明png贴图</span></a></h3><p>整体思路：创建一个矩形平面，设置颜色贴图<code>.map</code>,注意选择背景透明的<code>.png</code>图像作为颜色贴图，同时材质设置<code>transparent: true</code>，这样png图片背景完全透明的部分不显示。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 矩形平面网格模型设置背景透明的png贴图</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">PlaneGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//默认在XOY平面上</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> textureLoader</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">TextureLoader</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshBasicMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    map:</span><span style="color:#9CDCFE;"> textureLoader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;./指南针.png&#39;</span><span style="color:#D4D4D4;">),        </span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    transparent:</span><span style="color:#569CD6;"> true</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//使用背景透明的png贴图，注意开启透明计算</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">rotateX</span><span style="color:#D4D4D4;">(-</span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;"> / </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>网格地面辅助观察<code>GridHelper</code></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 添加一个辅助网格地面</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> gridHelper</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">GridHelper</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">300</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">25</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0x004444</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0x004444</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="uv动画" tabindex="-1"><a class="header-anchor" href="#uv动画"><span>UV动画</span></a></h3><p>通过纹理对象的偏移属性<code>.offset</code>实现一个UV动画效果</p><p>纹理对象Texture的<code>.offset</code>的功能是偏移贴图在Mesh上位置，本质上相当于修改了UV顶点坐标。</p><ol><li>通过阵列纹理贴图设置<code>.map</code></li><li>渲染循环中通过<code>.offset</code>设置了纹理映射偏移</li><li>把<code>.wrapS</code>或<code>.wrapT</code>设置为重复映射模式<code>THREE.RepeatWrapping</code></li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 一个矩形平面几何体用来表示传送带</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">PlaneGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">200</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//纹理贴图加载器TextureLoader</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> texLoader</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">TextureLoader</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// .load()方法加载图像，返回一个纹理对象Texture</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> texture</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">texLoader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;./纹理3.jpg&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    map:</span><span style="color:#9CDCFE;"> texture</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//map表示材质的颜色贴图属性</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">rotateX</span><span style="color:#D4D4D4;">(-</span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;">/</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置阵列</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">texture</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">wrapS</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">RepeatWrapping</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// uv两个方向纹理重复数量</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">texture</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">repeat</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//注意选择合适的阵列数量</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 渲染循环</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">function</span><span style="color:#DCDCAA;"> render</span><span style="color:#D4D4D4;">() {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    texture</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">offset</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;"> +=</span><span style="color:#B5CEA8;">0.001</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//设置纹理动画：偏移量根据纹理和动画需要，设置合适的值</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">    requestAnimationFrame</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">render</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="六、加载外部三维模型-gltf" tabindex="-1"><a class="header-anchor" href="#六、加载外部三维模型-gltf"><span>六、加载外部三维模型(gltf)</span></a></h2><h3 id="加载-gltf文件-模型加载全流程" tabindex="-1"><a class="header-anchor" href="#加载-gltf文件-模型加载全流程"><span>加载.gltf文件(模型加载全流程)</span></a></h3><ol><li><p>gltf模型加载器<code>GLTFLoader.js</code></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 引入gltf模型加载库GLTFLoader.js</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">GLTFLoader</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/loaders/GLTFLoader.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建GLTF加载器对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> loader</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> GLTFLoader</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">loader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">( </span><span style="color:#CE9178;">&#39;gltf模型.gltf&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> ( </span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;"> ) {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;控制台查看加载gltf文件返回的对象结构&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;gltf对象场景属性&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">  // 返回的场景对象gltf.scene插入到threejs场景中</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">( </span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;"> );</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>相机参数根据需要设置</p><p>大部分3D项目，一般都是使用<strong>透视投影相机</strong><code>PerspectiveCamera</code></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 近裁截面near和远裁截面far，要能包含你想渲染的场景，否则超出视锥体模型会被剪裁掉，简单说near足够小，far足够大，主要是far。</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> camera</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">PerspectiveCamera</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">30</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;"> / </span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3000</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// camera.position.set(200, 200, 200);// 第1步：根据场景渲染范围尺寸设置 </span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">292</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">223</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">185</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">// 第2步：通过相机控件OrbitControls的.position属性辅助设置</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lookAt</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">// 通过相机控件OrbitControls的.lookAt属性辅助设置</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 注意相机控件OrbitControls会影响lookAt设置，注意手动设置OrbitControls的目标参数，默认0,0,0</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置相机控件轨道控制器OrbitControls</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> controls</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> OrbitControls</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">controls</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">target</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">controls</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">update</span><span style="color:#D4D4D4;">();</span><span style="color:#6A9955;">//update()函数内会执行camera.lookAt(controls.targe)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>加载gltf的时候，webgl渲染器编码方式设置</p><p>查WebGL渲染器文档，你可以看到<code>.outputColorSpace</code>的默认值就是SRGB颜色空间<code>THREE.SRGBColorSpace</code>，意味着新版本代码中，加载gltf，没有特殊需要，不设置<code>.outputColorSpace</code>也不会引起色差。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 纹理贴图颜色偏差解决</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">outputColorSpace</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">SRGBColorSpace</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//设置为SRGB颜色空间</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="加载gltf不同文件形式" tabindex="-1"><a class="header-anchor" href="#加载gltf不同文件形式"><span>加载gltf不同文件形式</span></a></h3><p>单独.gltf文件</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 单独.gltf文件</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">loader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;../../工厂.gltf&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">) { </span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>单独.glb文件</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 单独.glb文件</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">loader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;../../工厂.glb&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">) { </span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>.gltf + .bin + 贴图文件</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// .gltf + .bin + 贴图文件</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">loader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;../../工厂/工厂.gltf&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">) { </span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="解决多个mesh共享材质的问题" tabindex="-1"><a class="header-anchor" href="#解决多个mesh共享材质的问题"><span>解决多个mesh共享材质的问题</span></a></h3><ol><li>三维建模软件中设置，需要代码改变材质的Mesh不要共享材质，要独享材质。</li><li>代码批量更改：克隆材质对象，重新赋值给mesh的材质属性</li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//用代码方式解决mesh共享材质问题</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getObjectByName</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;小区房子&quot;</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">traverse</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">    if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">isMesh</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // .material.clone()返回一个新材质对象，和原来一样，重新赋值给.material属性</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">clone</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh1</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">color</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xffff00</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh2</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">color</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0x00ff00</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="纹理和渲染器colorspace" tabindex="-1"><a class="header-anchor" href="#纹理和渲染器colorspace"><span>纹理和渲染器colorSpace</span></a></h3><p>如果没有特殊需要，一般为了正常渲染，避免颜色偏差，threejs代码中需要颜色贴图<code>.colorSpace</code>和渲染器<code>.colorSpace</code>属性值保持一致。</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="Color Space"><span>Color Space</span></div><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">NoColorSpace</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&quot;&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">SRGBColorSpace</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&quot;srgb&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">LinearSRGBColorSpace</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&quot;srgb-linear&quot;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//解决加载gltf格式模型颜色偏差问题</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">colorSpace</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">SRGBColorSpace</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">texture</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">colorSpace</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">SRGBColorSpace</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="gltf模型更换纹理-map" tabindex="-1"><a class="header-anchor" href="#gltf模型更换纹理-map"><span>gltf模型更换纹理.map</span></a></h3><p>如果你直接给gltf模型材质设置<code>.map</code>属性更换贴图，可能会出现纹理贴图错位的问题，这主要和纹理对象<code>Texture</code>的翻转属性<code>.flipY</code>有关。</p><p><code>.flipY</code>表示是否翻转纹理贴图在Mesh上的显示位置。</p><p>纹理对象<code>Texture</code>翻转属性<code>.flipY</code>默认值是true。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> texLoader</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">TextureLoader</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> texture</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">texLoader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;./黑色.png&#39;</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">// 加载手机mesh另一个颜色贴图</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">texture</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">colorSpace</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">SRGBColorSpace</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//和渲染器.colorSpace 一样值</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">loader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;../手机模型.glb&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">]; </span><span style="color:#6A9955;">//获取Mesh</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;.flipY&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">map</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">flipY</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 注意把纹理贴图.flipY的值设置给gltf中纹理的值</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 是否翻转纹理贴图</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    texture</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">flipY</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="七、pbr材质与纹理贴图" tabindex="-1"><a class="header-anchor" href="#七、pbr材质与纹理贴图"><span>七、PBR材质与纹理贴图</span></a></h2><p>PBR就是基于物理的渲染(physically-based rendering)。</p><p>Three.js提供了两个PBR材质相关的API<code>标准网格材质(MeshStandardMaterial)</code>和<code>物理网格材质(MeshPhysicalMaterial)</code>。</p><p><code>MeshPhysicalMaterial</code>是<code>MeshStandardMaterial</code>扩展的子类，提供了更多功能属性。</p><p><img src="/assets/image_KNmnCG_03p-B8NWw199.png" alt=""></p><h3 id="pbr材质金属度metalness-和粗糙度roughness" tabindex="-1"><a class="header-anchor" href="#pbr材质金属度metalness-和粗糙度roughness"><span>PBR材质金属度<code>metalness</code> 和粗糙度<code>roughness</code></span></a></h3><p><strong>金属度</strong>**<code>metalness</code>** </p><p>表示材质像<strong>金属</strong>的程度, 非金属材料,如木材或石材,使用0.0,金属使用1.0。</p><p>threejs的PBR材质，<code>.metalness</code>默认是0.5,0.0到1.0之间的值可用于生锈的金属外观。</p><p><strong>粗糙度</strong>**<code>roughness</code>**</p><p>表示模型表面的光滑或者说粗糙程度，越光滑镜面反射能力越强，越粗糙，表面镜面反射能力越弱，更多地表现为漫反射。</p><p>粗糙度<code>roughness</code>,0.0表示平滑的镜面反射,1.0表示完全漫反射,默认0.5。</p><p><strong>示例：重新设置材质的金属度和粗糙度属性</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 引入Three.js</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#569CD6;"> *</span><span style="color:#C586C0;"> as</span><span style="color:#9CDCFE;"> THREE</span><span style="color:#C586C0;"> from</span><span style="color:#CE9178;"> &#39;three&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 引入gltf模型加载库GLTFLoader.js</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">GLTFLoader</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/loaders/GLTFLoader.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> loader</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> GLTFLoader</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//创建一个GLTF加载器</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> model</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Group</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//声明一个组对象，用来添加加载成功的三维场景</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">loader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;../../金属.glb&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">) { </span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 递归遍历所有模型节点批量修改材质</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">traverse</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">        if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">isMesh</span><span style="color:#D4D4D4;">) {</span><span style="color:#6A9955;">//判断是否是网格模型</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // 重新设置材质的金属度和粗糙度属性</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">metalness</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">1.0</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//金属度</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">roughness</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0.5</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//表面粗糙度</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            </span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // obj.material = new THREE.MeshStandardMaterial({</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            //     color: obj.material.color, //读取材质原来的颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            //     // 金属度属性metalness：材质像金属的程度, 非金属材料,如木材或石材,使用0.0,金属使用1.0。</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            //     // metalness默认0.5,0.0到1.0之间的值可用于生锈的金属外观</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            //     metalness: 1.0,</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            //     // metalness: 0.0,//没有金属质感    </span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            //     // 粗糙度属性roughness:模型表面粗糙程度,0.0表示平滑的镜面反射,1.0表示完全漫反射,默认0.5                      </span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            //     roughness: 0.5,</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            //     // roughness: 1.0,//设置到完全漫反射状态，表面金属质感比较弱</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            //     // roughness: 0.0,//完全镜面反射，就像一面镜子一样，注意配合环境贴图观察更明显</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // })</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    });</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    model</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">export</span><span style="color:#C586C0;"> default</span><span style="color:#9CDCFE;"> model</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="环境贴图envmap和场景环境属性-environment" tabindex="-1"><a class="header-anchor" href="#环境贴图envmap和场景环境属性-environment"><span>环境贴图<code>envMap</code><strong>和场景环境属性</strong>**<code>.environment</code>**</span></a></h3><p>立方体纹理加载器<code>CubeTextureLoader</code>的<code>.load()</code>方法是加载6张图片，返回一个立方体纹理对象<code>CubeTexture</code>。</p><p>所谓<strong>环境贴图</strong>，就是一个模型周围的环境的图像，比如一间房子，房子的<strong>上下左右前后</strong>分别拍摄一张照片，就是3D空间中6个角度方向的照片。</p><p><strong>环境贴图</strong>**<code>envMap</code>**<strong>属性</strong></p><p>实际生活中，一个物体表面，往往会反射周围的环境。人的眼睛看到的东西，往往反射有周围景物，所以three.js渲染模型，如果想渲染效果更好看，如果想更符合实际生活情况，也需要想办法让模型反射周围景物。</p><p>MeshStandardMaterial材质的环境贴图属性是<code>.envMap</code>，通过PBR材质的贴图属性可以实现模型表面反射周围景物，这样渲染效果更好。</p><p><strong>环境贴图反射率</strong>**<code>.envMapIntensity</code>**</p><p><code>MeshStandardMaterial</code>的<code>.envMapIntensity</code>属性主要用来设置模型表面反射周围环境贴图的能力，或者说环境贴图对模型表面的影响能力。具体说<code>.envMapIntensity</code>相当于环境贴图的系数，环境贴图像素值乘以该系数后，在用于影响模型表面。</p><p><strong>示例：通过环境贴图设置材质的金属效果</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 加载环境贴图</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 加载周围环境6个方向贴图</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 上下左右前后6张贴图构成一个立方体空间</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// &#39;px.jpg&#39;, &#39;nx.jpg&#39;：x轴正方向、负方向贴图  p:正positive  n:负negative</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// &#39;py.jpg&#39;, &#39;ny.jpg&#39;：y轴贴图</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// &#39;pz.jpg&#39;, &#39;nz.jpg&#39;：z轴贴图</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// CubeTexture表示立方体纹理对象，父类是纹理对象Texture</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> textureCube</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">CubeTextureLoader</span><span style="color:#D4D4D4;">()</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    .</span><span style="color:#DCDCAA;">setPath</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;../../环境贴图/环境贴图0/&#39;</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    .</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">([</span><span style="color:#CE9178;">&#39;px.jpg&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;nx.jpg&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;py.jpg&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;ny.jpg&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;pz.jpg&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;nz.jpg&#39;</span><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">   </span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">loader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;../../金属.glb&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 递归遍历所有模型节点批量修改材质</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">traverse</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">        if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">isMesh</span><span style="color:#D4D4D4;">) { </span><span style="color:#6A9955;">//判断是否是网格模型</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // console.log(&#39;obj.material&#39;,obj.material);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // 重新设置材质的金属度和粗糙度属性</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">metalness</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">1.0</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//金属度</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">roughness</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0.35</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//表面粗糙度</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">envMap</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">textureCube</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//设置环境贴图</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // envMapIntensity：控制环境贴图对mesh表面影响程度</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">envMapIntensity</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">1.0</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//默认值1, 设置为0.0,相当于没有环境贴图</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // obj.material = new THREE.MeshStandardMaterial({</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            //     color: obj.material.color, //读取材质原来的颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            //     metalness: 1.0, //金属度</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            //     roughness: 0.5, //粗糙度</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            //     envMap: textureCube, //设置pbr材质环境贴图</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            //     // envMapIntensity：控制环境贴图对mesh表面影响程度</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            //     envMapIntensity: 0.0, //默认值1, 设置为0.0,相当于没有环境贴图</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // })</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    });</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    model</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>场景环境属性</strong>**<code>.environment</code>**</p><p>如果你希望环境贴图影响场景中scene所有Mesh，可以通过Scene的场景环境属性<code>.environment</code>实现,把环境贴图对应纹理对象设置为<code>.environment</code>的属性值即可。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//场景</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> scene</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Scene</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">model</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//模型对象添加到场景中</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> textureCube</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">CubeTextureLoader</span><span style="color:#D4D4D4;">()</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // .setPath(&#39;../../环境贴图/环境贴图0/&#39;)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    .</span><span style="color:#DCDCAA;">setPath</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;../../环境贴图/环境贴图3/&#39;</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    .</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">([</span><span style="color:#CE9178;">&#39;px.jpg&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;nx.jpg&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;py.jpg&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;ny.jpg&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;pz.jpg&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;nz.jpg&#39;</span><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">texture</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">colorSpace</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">SRGBColorSpace</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">// 和renderer.colorSpace一致</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 环境贴图纹理对象textureCube作为.environment属性值,影响所有模型</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">environment</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">textureCube</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="meshphysicalmaterial清漆层clearcoat" tabindex="-1"><a class="header-anchor" href="#meshphysicalmaterial清漆层clearcoat"><span>MeshPhysicalMaterial清漆层<code>clearcoat</code></span></a></h3><p>MeshPhysicalMaterial是在MeshStandardMaterial基础上扩展出来的子类，除了继承了MeshStandardMaterial的金属度、粗糙度等属性，还新增了清漆<code>.clearcoat</code>、透光率<code>.transmission</code>、反射率<code>.reflectivity</code>、光泽<code>.sheen</code>、折射率<code>.ior</code>等等各种用于模拟生活中不同材质的属性。</p><p><strong>示例：车外壳油漆效果</strong></p><p>车外壳油漆效果，可以通过PBR材质的清漆层属性<code>.clearcoat</code>和清漆层粗糙度<code>.clearcoatRoughness</code>属性模拟。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getObjectByName</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;外壳01&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshPhysicalMaterial</span><span style="color:#D4D4D4;">( {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  clearcoat:</span><span style="color:#B5CEA8;"> 1.0</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//物体表面清漆层或者说透明涂层的厚度</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  clearcoatRoughness:</span><span style="color:#B5CEA8;"> 0.1</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//透明涂层表面的粗糙度</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">} );</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="物理材质透光率transmission" tabindex="-1"><a class="header-anchor" href="#物理材质透光率transmission"><span>物理材质透光率<code>transmission</code></span></a></h3><p>为了更好的模拟玻璃、半透明塑料一类的视觉效果，可以使用物理透明度<code>.transmission</code>属性代替Mesh普通透明度属性<code>.opacity</code>。</p><p>使用<code>.transmission</code>属性设置Mesh透明度,即便完全透射的情况下仍可保持高反射率。</p><p>物理光学透明度<code>.transmission</code>的值范围是从0.0到1.0。默认值为0.0。</p><p><strong>折射率</strong>**<code>.ior</code>**：非金属材料的折射率从1.0到2.333。默认值为1.5。不同材质的折射率，可以上网查询。</p><p><strong>示例：通过设置透光率</strong>**<code>.transmission</code><strong><strong>和折射率</strong></strong><code>.ior</code>**<strong>等实现玻璃效果。</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getObjectByName</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;玻璃01&#39;</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshPhysicalMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    metalness:</span><span style="color:#B5CEA8;"> 0.0</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//玻璃非金属 </span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    roughness:</span><span style="color:#B5CEA8;"> 0.0</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//玻璃表面光滑</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    envMap:</span><span style="color:#9CDCFE;"> textureCube</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//环境贴图</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    envMapIntensity:</span><span style="color:#B5CEA8;"> 1.0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//环境贴图对Mesh表面影响程度</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 设置透光率.transmission和折射率.ior</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    transmission:</span><span style="color:#B5CEA8;"> 1.0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//玻璃材质透光率，transmission替代opacity </span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    ior:</span><span style="color:#B5CEA8;"> 1.5</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//折射率</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>GUI可视化调试PBR材质属性</strong></p><p>gui.js库的使用参考<strong>快速入门</strong>章节介绍</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> obj</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#9CDCFE;"> mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">color</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// 材质颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">};</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 材质颜色color</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">matFolder</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addColor</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;color&#39;</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">onChange</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">value</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">color</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">value</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 范围可以参考文档</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">matFolder</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">,</span><span style="color:#CE9178;">&#39;metalness&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">matFolder</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">,</span><span style="color:#CE9178;">&#39;roughness&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">matFolder</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">,</span><span style="color:#CE9178;">&#39;transmission&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">matFolder</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">,</span><span style="color:#CE9178;">&#39;ior&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">matFolder</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">,</span><span style="color:#CE9178;">&#39;envMapIntensity&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="八、渲染器和前端ui界面" tabindex="-1"><a class="header-anchor" href="#八、渲染器和前端ui界面"><span>八、渲染器和前端UI界面</span></a></h2><h3 id="three-js背景透明度" tabindex="-1"><a class="header-anchor" href="#three-js背景透明度"><span>Three.js背景透明度</span></a></h3><p>通过Three.js渲染一个模型的时候，不希望canvas画布有背景颜色，也就是canvas画布完全透明，可以透过canvas画布看到画布后面叠加的HTML元素图文，呈现出来一种三维模型悬浮在网页上面的效果。</p><p><strong>1、</strong> **​<code>.setClearAlpha()</code>**<strong>方法</strong></p><p>改变背景透明度值</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setClearAlpha</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0.8</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 完全透明</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setClearAlpha</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0.0</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2、背景透明</strong>**<code>alpha: true</code>**</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 在构造函数参数中设置alpha属性的值</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">var</span><span style="color:#9CDCFE;"> renderer</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">WebGLRenderer</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  alpha:</span><span style="color:#569CD6;"> true</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3、</strong> **​<code>.setClearColor()</code>**<strong>方法</strong></p><p><code>.setClearColor()</code>方法的参数2，可以用来设置背景颜色透明度。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setClearColor</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xb9d3ff</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0.4</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//设置背景颜色和透明度</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="three-js渲染结果保存为图片" tabindex="-1"><a class="header-anchor" href="#three-js渲染结果保存为图片"><span>Three.js渲染结果保存为图片</span></a></h3><ol><li>配置webgl渲染器<code>preserveDrawingBuffer:true</code></li><li>按钮绑定鼠标事件</li><li>创建超链接元素a：用于保存下载文件</li><li>Canvas画布通过<code>.toDataURL()</code>方法可以获取画布上的像素信息</li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// WebGL渲染器设置</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> renderer</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">WebGLRenderer</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    //想把canvas画布上内容下载到本地，需要设置为true</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    preserveDrawingBuffer:</span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 鼠标单击id为download的HTML元素，threejs渲染结果以图片形式下载到本地</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getElementById</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;download&#39;</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">addEventListener</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;click&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">(){</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 创建一个超链接元素，用来下载保存数据的文件</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> link</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">createElement</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;a&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 通过超链接herf属性，设置要保存到文件中的数据</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> canvas</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//获取canvas对象</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    link</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">href</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">canvas</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">toDataURL</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;image/png&quot;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    link</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">download</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;threejs.png&#39;</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//下载文件名</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    link</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">click</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//js代码触发超链接元素a的鼠标点击事件，开始下载文件到本地</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以不同的格式获取像素信息</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">canvas</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">toDataURL</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;image/png&quot;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">canvas</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">toDataURL</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;image/jpeg&quot;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">canvas</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">toDataURL</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;image/bmp&quot;</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="深度冲突-模型闪烁" tabindex="-1"><a class="header-anchor" href="#深度冲突-模型闪烁"><span>深度冲突(模型闪烁)</span></a></h3><p>创建两个重合的矩形平面Mesh，通过浏览器预览，当你旋转三维场景的时候，你会发现模型渲染的时候产生闪烁。</p><p>这种现象，主要是两个Mesh重合，电脑GPU分不清谁在前谁在后，这种现象，可以称为深度冲突<code>Z-fighting</code>。</p><p>解决方法：</p><ul><li><p>两个矩形Mesh拉开距离</p><p>适当偏移，解决深度冲突，偏移尺寸相对模型尺寸比较小，视觉上两个平面近似还是重合效果。</p><p>注意：当两个面间隙很小，也可能出现深度冲突。从纯理论的角度，你能分清0和0.0000...0000001的大小，但是实际上，电脑GPU精度是有限的。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">mesh2</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">z</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>webgl渲染器设置对数深度缓冲区</p><p>当一个三维场景中有一些面距离比较近，有深度冲突，你可以尝试设置webgl渲染器设置对数深度缓冲区<code>logarithmicDepthBuffer: true</code>来优化或解决。</p><p><code>logarithmicDepthBuffer: true</code>作用简单来说，就是两个面间距比较小的时候，让threejs更容易区分两个面，谁在前，谁在后。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// WebGL渲染器设置</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> renderer</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">WebGLRenderer</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 设置对数深度缓冲区，优化深度冲突问题</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    logarithmicDepthBuffer:</span><span style="color:#569CD6;"> true</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：当两个面间隙过小，或者重合，你设置webgl渲染器对数深度缓冲区也是无效的</p></li></ul><h3 id="模型加载进度条" tabindex="-1"><a class="header-anchor" href="#模型加载进度条"><span>模型加载进度条</span></a></h3><p><code>loader.load(模型路径,加载完成函数,加载过程函数)</code></p><p>模型本身是有大小的，通过浏览器从服务器加载的时候，本身网络传输是需要时间的。</p><p><code>.load()</code>方法的参数2是一个函数，参数2函数是模型加载完成以后才会被调用执行。</p><p><code>.load()</code>方法的参数3是一个函数，通过函数的参数获取模型加载信息,每当模型加载部分内容，该函数就会被调用，一次加载过程中一般会被调用多次，直到模型加载完成。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> percentDiv</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getElementById</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;per&quot;</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">// 获取进度条元素</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">loader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;../工厂.glb&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    model</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 加载完成，隐藏进度条</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // document.getElementById(&quot;container&quot;).style.visibility =&#39;hidden&#39;;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getElementById</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;container&quot;</span><span style="color:#D4D4D4;">).</span><span style="color:#9CDCFE;">style</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">display</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;none&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">xhr</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 控制台查看加载进度xhr</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 通过加载进度xhr可以控制前端进度条进度   </span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> percent</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">xhr</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">loaded</span><span style="color:#D4D4D4;"> / </span><span style="color:#9CDCFE;">xhr</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">total</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;加载进度&#39;</span><span style="color:#D4D4D4;"> + </span><span style="color:#9CDCFE;">percent</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">     </span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    percentDiv</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">style</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">percent</span><span style="color:#D4D4D4;"> * </span><span style="color:#B5CEA8;">400</span><span style="color:#D4D4D4;"> + </span><span style="color:#CE9178;">&quot;px&quot;</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//进度条元素长度</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    percentDiv</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">style</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">textIndent</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">percent</span><span style="color:#D4D4D4;"> * </span><span style="color:#B5CEA8;">400</span><span style="color:#D4D4D4;"> + </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;"> + </span><span style="color:#CE9178;">&quot;px&quot;</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//缩进元素中的首行文本</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // Math.floor:小数加载进度取整</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    percentDiv</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">innerHTML</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">floor</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">percent</span><span style="color:#D4D4D4;"> * </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">) + </span><span style="color:#CE9178;">&#39;%&#39;</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//进度百分比</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="九、生成曲线、几何体" tabindex="-1"><a class="header-anchor" href="#九、生成曲线、几何体"><span>九、生成曲线、几何体</span></a></h2><h3 id="生成圆弧" tabindex="-1"><a class="header-anchor" href="#生成圆弧"><span>生成圆弧</span></a></h3><p>通过代码算法生成圆弧线上的顶点坐标，并最后绘制一个圆弧效果。</p><p>实现方式参考第二章的“定义一个几何体”</p><ol><li>通过缓冲类型几何体<code>BufferGeometry</code>创建空几何体对象</li><li>批量生成圆弧上的顶点数据</li><li>通过javascript<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Typed_arrays" title="类型化数组" target="_blank" rel="noopener noreferrer">类型化数组</a><code>Float32Array</code>创建顶点数据用来表示几何体的顶点坐标</li><li>通过<code>BufferAttribute</code>定义几何体顶点数据</li><li>设置几何体顶点<code>.attributes.position</code></li><li>创建线材质</li><li>创建线模型对象</li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferGeometry</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//创建一个几何体对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> R</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//圆弧半径</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> N</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//分段数量</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> sp</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;"> / </span><span style="color:#4FC1FF;">N</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//两个相邻点间隔弧度</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 批量生成圆弧上的顶点数据</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> arr</span><span style="color:#D4D4D4;"> = [];</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">let</span><span style="color:#9CDCFE;"> i</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> &lt; </span><span style="color:#4FC1FF;">N</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">++) {</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> angle</span><span style="color:#D4D4D4;"> =  </span><span style="color:#9CDCFE;">sp</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//当前点弧度</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 以坐标原点为中心，在XOY平面上生成圆弧上的顶点数据</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> x</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">R</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">cos</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">angle</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> y</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">R</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">sin</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">angle</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    arr</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">push</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//类型数组创建顶点数据</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> vertices</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Float32Array</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">arr</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建属性缓冲区对象</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//3个为一组，表示一个顶点的xyz坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> attribue</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">vertices</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">); </span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置几何体attributes属性的位置属性</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">attributes</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">attribue</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 线材质</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineBasicMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0xff0000</span><span style="color:#6A9955;"> //线条颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建线模型对象   构造函数：Line、LineLoop、LineSegments</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// const line = new THREE.Line(geometry, material); </span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> line</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineLoop</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//线条模型对象</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：</p><ul><li>使用<code>Line</code>渲染圆弧线会有一个缺口，不完全闭合，使用<code>LineLoop</code>可以封闭最后缺口。</li><li>使用Line渲染，也可以修改for循环条件多增加一个点绘制圆弧。<code>for (let i = 0; i &lt; N + 1; i++)</code></li></ul><p><strong>圆弧设置圆心坐标</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> R</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//圆弧半径</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> N</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//分段数量</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> sp</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;"> / </span><span style="color:#4FC1FF;">N</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//两个相邻点间隔弧度</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置圆心坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> cx</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">200</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> cy</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">let</span><span style="color:#9CDCFE;"> i</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> &lt; </span><span style="color:#4FC1FF;">N</span><span style="color:#D4D4D4;">+</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">++) {</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> angle</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">sp</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//当前点弧度</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> x</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">cx</span><span style="color:#D4D4D4;"> + </span><span style="color:#4FC1FF;">R</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">cos</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">angle</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> y</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">cy</span><span style="color:#D4D4D4;"> + </span><span style="color:#4FC1FF;">R</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">sin</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">angle</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    arr</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">push</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用几何体方法-setfrompoints-设置坐标数据" tabindex="-1"><a class="header-anchor" href="#使用几何体方法-setfrompoints-设置坐标数据"><span>使用几何体方法.setFromPoints()设置坐标数据</span></a></h3><p><code>.setFromPoints()</code>是几何体<code>BufferGeometry</code>的一个方法，通过该方法可以把数组<code>pointsArr</code>中坐标数据提取出来赋值给几何体。</p><p>具体说就是把pointsArr里面坐标数据提取出来，赋值给<code>geometry.attributes.position</code>属性</p><p>以生成矩形为例：</p><ol><li>用三维向量<code>Vector3</code>表示顶点的x、y、z坐标，作为数组元素创建一组顶点坐标</li><li>通过缓冲类型几何体<code>BufferGeometry</code>创建空几何体对象</li><li>使用几何体方法<code>.setFromPoints()</code>把数组<code>pointsArr</code>中坐标数据提取出来赋值给几何体</li><li>创建线材质</li><li>创建线模型对象</li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> pointsArr</span><span style="color:#D4D4D4;"> = [</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 三维向量Vector3表示的坐标值</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">];</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 也可以使用二维向量</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// const pointsArr = [</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//     // 二维向量Vector2表示的坐标值</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//     new THREE.Vector2(0,0),</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//     new THREE.Vector2(100,0),</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//     new THREE.Vector2(100,100),</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//     new THREE.Vector2(0,100),</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// ];</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferGeometry</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 把数组pointsArr里面的坐标数据提取出来，赋值给`geometry.attributes.position`属性</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setFromPoints</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">pointsArr</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 线材质</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineBasicMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0xff0000</span><span style="color:#6A9955;"> //线条颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建线模型对象   构造函数：Line、LineLoop、LineSegments</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// const line = new THREE.Line(geometry, material); </span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> line</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineLoop</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//线条模型对象</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="曲线curve" tabindex="-1"><a class="header-anchor" href="#曲线curve"><span>曲线Curve</span></a></h3><p>生成圆弧除了通过代码算法生成之外，也可以直接通过threejs的api实现</p><p>threejs提供了很多常用的曲线或直线API，这些API曲线都有一个共同的父类<code>Curve</code>。</p><p><img src="/assets/image_gaYRWvs-30-CCMaonw4.png" alt=""></p><p><strong>曲线</strong>**<code>Curve</code><strong><strong>方法</strong></strong><code>.getPoints()</code>**</p><ul><li><p><code>.</code><a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/extras/core/Curve.getPoints" title="getPoints" target="_blank" rel="noopener noreferrer">getPoints</a><code>( divisions :Integer) :Array</code></p><p>divisions -- 要将曲线划分为的分段数。默认是<strong>5</strong>.</p></li><li><p>通过方法<code>.getPoints()</code>可以从曲线上按照一定的细分精度返回沿着曲线分布的顶点坐标。</p></li><li><p>细分数越高返回的顶点数量越多，自然轮廓越接近于曲线形状。</p></li><li><p>方法<code>.getPoints()</code>的返回值是一个由二维向量<code>Vector2</code>或三维向量<code>Vector3</code>构成的数组，<code>Vector2</code>表示位于同一平面内的点，<code>Vector3</code>表示三维空间中一点。</p></li></ul><p><strong>曲线</strong>**<code>Curve</code><strong><strong>方法</strong></strong><code>.getSpacedPoints()</code>**</p><p>通过<code>.getSpacedPoints()</code>和<code>.getPoints()</code>一样也可以从曲线Curve上返回一系列曲线上的顶点坐标。</p><p>通过<code>.getSpacedPoints()</code>是按照曲线长度<strong>等间距</strong>返回顶点数据，<code>.getPoints()</code>获取点的方式并不是按照曲线等间距的方式，而是会考虑曲线斜率变化，<strong>斜率变化快的位置返回的顶点更密集</strong>。</p><h4 id="椭圆弧线ellipsecurve" tabindex="-1"><a class="header-anchor" href="#椭圆弧线ellipsecurve"><span>椭圆弧线<code>EllipseCurve</code></span></a></h4><ol><li>创建一个形状为椭圆的曲线</li><li>通过曲线<code>Curve</code>方法<code>.getPoints()</code>从曲线上获取顶点数据</li><li>通过缓冲类型几何体<code>BufferGeometry</code>创建空几何体对象</li><li>使用几何体方法<code>.setFromPoints()</code>提取曲线坐标数据</li><li>创建线材质</li><li>创建线模型对象</li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 参数1和2表示椭圆中心坐标  参数3和4表示x和y方向半径</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> arc</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">EllipseCurve</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">120</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//getPoints是基类Curve的方法，平面曲线会返回一个vector2对象作为元素组成的数组</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> pointsArr</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">arc</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getPoints</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//分段数50，返回51个顶点</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;曲线上获取坐标&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">pointsArr</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferGeometry</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setFromPoints</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">pointsArr</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 线材质</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineBasicMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0xff0000</span><span style="color:#6A9955;"> //线条颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建线模型对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> line</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Line</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="圆弧线arccurve" tabindex="-1"><a class="header-anchor" href="#圆弧线arccurve"><span>圆弧线<code>ArcCurve</code></span></a></h4><p><code>ArcCurve( aX, aY, aRadius, aStartAngle, aEndAngle, aClockwise )</code></p><p>语法和椭圆弧线<code>EllipseCurve</code>相似，区别是参数3和参数4不同，椭圆需要定义xRadius和yRadius两个半径，圆只需要通过参数3定义半径aRadius即可</p><p>aClockwise：是否顺时针绘制，默认值为false</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 逆时针绘制四分之一圆弧，参数5默认false，就是逆时针</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> arc</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">ArcCurve</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;">/</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 顺时针绘制圆弧 这时候绘制出来是四分之三圆弧</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// const arc = new THREE.ArcCurve(0, 0, 100, 0, Math.PI/2,true);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//getPoints是基类Curve的方法，平面曲线会返回一个vector2对象作为元素组成的数组</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> pointsArr</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">arc</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getPoints</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//分段数50，返回51个顶点</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;曲线上获取坐标&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">pointsArr</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferGeometry</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setFromPoints</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">pointsArr</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 线材质</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineBasicMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0xff0000</span><span style="color:#6A9955;"> //线条颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建线模型对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> line</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Line</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="样条曲线" tabindex="-1"><a class="header-anchor" href="#样条曲线"><span>样条曲线</span></a></h4><p>用于绘制不规则曲线</p><p><img src="/assets/image_ryrs0iOcxe-Chu9zLaH.png" alt=""></p><p><strong>生成三维样条曲线</strong>**<code>CatmullRomCurve3</code>**</p><ul><li>在三维空间中随意设置几个顶点坐标，然后作为三维样条曲线<code>CatmullRomCurve3</code>的参数，你就可以生成一条穿过这几个点的光滑曲线。</li><li><code>CatmullRomCurve3</code>的参数是三维向量对象<code>Vector3</code>构成的数组。</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 三维向量Vector3创建一组顶点坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> arr</span><span style="color:#D4D4D4;"> = [</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">90</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">40</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">40</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">, -</span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">70</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 三维样条曲线</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> curve</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">CatmullRomCurve3</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">arr</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//曲线上获取点</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> pointsArr</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">curve</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getPoints</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">); </span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferGeometry</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//读取坐标数据赋值给几何体顶点</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setFromPoints</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">pointsArr</span><span style="color:#D4D4D4;">); </span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 线材质</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineBasicMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0x00fffff</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 线模型</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> line</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Line</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>生成二维样条曲线</strong>**<code>SplineCurve</code>**</p><ul><li>二维样条曲线<code>SplineCurve</code>默认情况下就是在XOY平面生成一个平面的样条曲线。</li><li><code>SplineCurve</code>的参数是二维向量对象<code>Vector2</code>构成的数组。</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 二维向量Vector2创建一组顶点坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> arr</span><span style="color:#D4D4D4;"> = [</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">30</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">];</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 二维样条曲线</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> curve</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">SplineCurve</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">arr</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="贝塞尔曲线" tabindex="-1"><a class="header-anchor" href="#贝塞尔曲线"><span>贝塞尔曲线</span></a></h4><p>和样条曲线一样，也用于绘制不规则曲线</p><p><img src="/assets/image_ITgmmyNN0Z.png.mark-BSU2JPoq.png" alt=""></p><p><strong>二维二次贝塞尔曲线</strong>**<code>QuadraticBezierCurve</code>**</p><p>创建一条平滑的二维<a href="http://en.wikipedia.org/wiki/B%C3%A9zier_curve#mediaviewer/File:B%C3%A9zier_2_big.gif" title="二次贝塞尔曲线" target="_blank" rel="noopener noreferrer">二次贝塞尔曲线</a>， 由起点、终点和一个控制点所定义</p><p>观察贝塞尔曲线规则：贝塞尔曲线经过p1、p3两个点，但是不经过p2点，贝塞尔曲线与直线p12和p23相切。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// p1、p2、p3表示三个点坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// p1、p3是曲线起始点，p2是曲线的控制点</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> p1</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> p2</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> p3</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 二维二次贝赛尔曲线</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> curve</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">QuadraticBezierCurve</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">p1</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">p2</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">p3</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> pointsArr</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">curve</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getPoints</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//曲线上获取点</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferGeometry</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setFromPoints</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">pointsArr</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//读取坐标数据赋值给几何体顶点</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineBasicMaterial</span><span style="color:#D4D4D4;">({</span><span style="color:#9CDCFE;">color:</span><span style="color:#B5CEA8;"> 0x00fffff</span><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> line</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Line</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>三维二次贝赛尔曲线</strong>**<code>QuadraticBezierCurve3</code>**</p><p>三维二次贝赛尔曲线<code>QuadraticBezierCurve3</code>与二维二次贝赛尔曲线<code>QuadraticBezierCurve</code>区别就是多了一个维度，参数是三维向量对象Vector3。</p><p><strong>二维三次贝塞尔曲线CubicBezierCurve</strong></p><p>二维三次贝塞尔曲线<code>CubicBezierCurve</code>与二维二次贝赛尔曲线<code>QuadraticBezierCurve</code>区别就是多了一个控制点。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// p1、p2、p3、p4表示4个点坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// p1、p4是曲线起始点，p2、p3是曲线的控制点</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> p1</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> p2</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">40</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> p3</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> p4</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 二维三次贝赛尔曲线</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> curve</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">CubicBezierCurve</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">p1</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">p2</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">p3</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">p4</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>三维三次贝赛尔曲线</strong>**<code>CubicBezierCurve3</code>**</p><p>三维三次贝赛尔曲线<code>CubicBezierCurve3</code>与二维三次贝塞尔曲线<code>CubicBezierCurve</code>区别就是多了一个维度，参数是三维向量对象Vector3。</p><h4 id="样条、贝塞尔曲线应用-实现飞线轨迹" tabindex="-1"><a class="header-anchor" href="#样条、贝塞尔曲线应用-实现飞线轨迹"><span>样条、贝塞尔曲线应用：实现飞线轨迹</span></a></h4><p>已知平面上两个点坐标<code>(-100,-100)</code>、<code>(100,100)</code>，需要生成一条飞线轨迹线，要求轨迹线把这两个点作为起始点,曲线有一定的高度。</p><p><strong>三维样条曲线CatmullRomCurve3实现飞线轨迹</strong></p><p>下面曲线的起始点设置在XOZ平面上，y方向为曲线高度方向。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// p1、p3轨迹线起始点坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> p1</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, -</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> p3</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 计算p1和p3的中点坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> x2</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">p1</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;"> + </span><span style="color:#9CDCFE;">p3</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;">)/</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> z2</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">p1</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">z</span><span style="color:#D4D4D4;"> + </span><span style="color:#9CDCFE;">p3</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">z</span><span style="color:#D4D4D4;">)/</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> h</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> p2</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">x2</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">h</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">z2</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> arr</span><span style="color:#D4D4D4;"> = [</span><span style="color:#9CDCFE;">p1</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">p2</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">p3</span><span style="color:#D4D4D4;">];</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 三维样条曲线</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> curve</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">CatmullRomCurve3</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">arr</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>三维二次贝赛尔曲线</strong>**<code>QuadraticBezierCurve3</code>**<strong>实现飞线轨迹</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// p1、p3轨迹线起始点坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> p1</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, -</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> p3</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 计算p1和p3的中点坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> x2</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">p1</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;"> + </span><span style="color:#9CDCFE;">p3</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;">)/</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> z2</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">p1</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">z</span><span style="color:#D4D4D4;"> + </span><span style="color:#9CDCFE;">p3</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">z</span><span style="color:#D4D4D4;">)/</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> h</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> p2</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">x2</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">h</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">z2</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 三维二次贝赛尔曲线</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> curve</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">QuadraticBezierCurve3</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">p1</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">p2</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">p3</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="组合曲线curvepath拼接曲线" tabindex="-1"><a class="header-anchor" href="#组合曲线curvepath拼接曲线"><span>组合曲线<code>CurvePath</code>拼接曲线</span></a></h3><p>通过threejs组合曲线<code>CurvePath</code>对象，你可以把直线、圆弧、贝塞尔等线条拼接为一条曲线。</p><p><img src="/assets/image_HmSdQXrFVJ-QVg4wxll.png" alt=""></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> R</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//圆弧半径</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> H</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">200</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//直线部分高度</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 直线1</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> line1</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineCurve</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(</span><span style="color:#4FC1FF;">R</span><span style="color:#D4D4D4;">, </span><span style="color:#4FC1FF;">H</span><span style="color:#D4D4D4;">), </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(</span><span style="color:#4FC1FF;">R</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">));</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 圆弧</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> arc</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">ArcCurve</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#4FC1FF;">R</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 直线2</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> line2</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineCurve</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(-</span><span style="color:#4FC1FF;">R</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">), </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(-</span><span style="color:#4FC1FF;">R</span><span style="color:#D4D4D4;">, </span><span style="color:#4FC1FF;">H</span><span style="color:#D4D4D4;">));</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// CurvePath创建一个组合曲线对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> CurvePath</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">CurvePath</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//line1, arc, line2拼接出来一个U型轮廓曲线，注意顺序</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">CurvePath</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">curves</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">push</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">line1</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">arc</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">line2</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 执行.getPoints()，直线部分不会像曲线返回中间多余点，只需要起始点即可。</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> pointsArr</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">CurvePath</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getPoints</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">16</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//曲线上获取点</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 执行.getSpacedPoints()，会发现直线部分会按照等间距方式返回顶点数据</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// .getSpacedPoints()的精度参数提升，圆弧部分才会更加圆滑</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// const pointsArr = CurvePath.getSpacedPoints(16); //圆弧不够光滑</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferGeometry</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setFromPoints</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">pointsArr</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//读取坐标数据赋值给几何体顶点</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineBasicMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0x00fffff</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 线模型</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> line</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Line</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="通过曲线路径生成管道tubegeometry" tabindex="-1"><a class="header-anchor" href="#通过曲线路径生成管道tubegeometry"><span>通过曲线路径生成管道<code>TubeGeometry</code></span></a></h3><p>管道<code>TubeGeometry</code>几何体的功能就是基于一个3D曲线路径，生成一个管道几何体。</p><p><code>TubeGeometry(path, tubularSegments, radius, radiusSegments, closed)</code></p><table><thead><tr><th>参数</th><th>值</th></tr></thead><tbody><tr><td>path</td><td>扫描路径，路径要用三维曲线</td></tr><tr><td>tubularSegments</td><td>路径方向细分数，默认64</td></tr><tr><td>radius</td><td>管道半径，默认1</td></tr><tr><td>radiusSegments</td><td>管道圆弧细分数，默认8</td></tr><tr><td>closed</td><td>Boolean值，管道是否闭合</td></tr></tbody></table><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 三维样条曲线</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> path</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">CatmullRomCurve3</span><span style="color:#D4D4D4;">([</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">90</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">40</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">40</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">, -</span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">70</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// path:路径   40：沿着轨迹细分数  2：管道半径   25：管道截面圆细分数</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">TubeGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">path</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">40</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">25</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0x00ffff</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    side:</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">DoubleSide</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//双面显示看到管道内壁</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // wireframe: true,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="旋转成型lathegeometry" tabindex="-1"><a class="header-anchor" href="#旋转成型lathegeometry"><span><a href="http://www.webgl3d.cn/pages/4f1012/" title="旋转成型" target="_blank" rel="noopener noreferrer">旋转成型</a><a href="http://www.webgl3d.cn/pages/4f1012/" title="LatheGeometry" target="_blank" rel="noopener noreferrer">LatheGeometry</a></span></a></h3><h3 id="轮廓填充shapegeometry" tabindex="-1"><a class="header-anchor" href="#轮廓填充shapegeometry"><span>轮廓填充<code>ShapeGeometry</code></span></a></h3><p>已知一个多边形的外轮廓坐标，可以通过这些外轮廓坐标生成一个多边形几何体平面</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 一组二维向量表示一个多边形轮廓坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> pointsArr</span><span style="color:#D4D4D4;"> = [</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, -</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, -</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">]</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// Shape表示一个平面多边形轮廓,参数是二维向量构成的数组pointsArr</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> shape</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Shape</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">pointsArr</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 多边形shape轮廓作为ShapeGeometry参数，生成一个多边形平面几何体</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">ShapeGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">shape</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0x00ffff</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    side:</span><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">DoubleSide</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="拉伸extrudegeometry" tabindex="-1"><a class="header-anchor" href="#拉伸extrudegeometry"><span><a href="http://www.webgl3d.cn/pages/4ac668/" title="拉伸" target="_blank" rel="noopener noreferrer">拉伸</a><a href="http://www.webgl3d.cn/pages/4ac668/" title="ExtrudeGeometry" target="_blank" rel="noopener noreferrer">ExtrudeGeometry</a></span></a></h3><h3 id="扫描extrudegeometry" tabindex="-1"><a class="header-anchor" href="#扫描extrudegeometry"><span><a href="http://www.webgl3d.cn/pages/a06aed/" title="扫描" target="_blank" rel="noopener noreferrer">扫描</a><a href="http://www.webgl3d.cn/pages/a06aed/" title="ExtrudeGeometry" target="_blank" rel="noopener noreferrer">ExtrudeGeometry</a></span></a></h3><h3 id="多边形轮廓shape" tabindex="-1"><a class="header-anchor" href="#多边形轮廓shape"><span>多边形轮廓<code>Shape</code></span></a></h3><p>多边形轮廓<code>Shape</code>,是直接通过一组二维向量<code>Vector2</code>表示的xy点坐标创建。</p><p><code>Shape</code>的父类是<code>Path</code>,<code>Path</code>提供了直线、圆弧、贝塞尔、样条等绘制方法，<code>Shape</code>也会从父类是<code>Path</code>继承这些图形绘制方法。</p><h4 id="通过绘制直线-lineto-方法创建轮廓" tabindex="-1"><a class="header-anchor" href="#通过绘制直线-lineto-方法创建轮廓"><span>通过绘制直线<code>.lineTo()</code>方法创建轮廓</span></a></h4><p><code>Shape</code>的父类是<code>Path</code>,<code>Path</code>提供了直线、圆弧、贝塞尔、样条等绘制方法，<code>Shape</code>也会从父类是<code>Path</code>继承这些图形绘制方法。</p><p><img src="/assets/image_tRSpiE6-P1-BjJ2yOAZ.png" alt=""></p><ul><li><code>.currentPoint</code>属性字面意思是当前点，默认值<code>Vector2(0,0)</code>。</li><li>执行和<code>.moveTo()</code>、<code>.lineTo()</code>方法后，<code>currentPoint</code>会发生变化</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> shape</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Shape</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">shape</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">moveTo</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//.currentPoint变为(10,0)</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 绘制直线线段，起点(10,0)，结束点(100,0)</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">shape</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lineTo</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//.currentPoint变为(100, 0)</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">shape</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lineTo</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//.currentPoint变为(100, 100)</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">shape</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lineTo</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//.currentPoint变为(10, 100)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// ShapeGeometry填充Shape获得一个平面几何体</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// const geometry = new THREE.ShapeGeometry(shape);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// ExtrudeGeometry拉伸Shape获得一个长方体几何体</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">ExtrudeGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">shape</span><span style="color:#D4D4D4;">, {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    depth:</span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//拉伸长度</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    bevelEnabled:</span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//禁止倒角</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="圆弧-arc-absarc" tabindex="-1"><a class="header-anchor" href="#圆弧-arc-absarc"><span>圆弧<code>.arc().absarc()</code></span></a></h4><p>圆弧方法<code>.arc()</code>使用方式和原来学习过的圆弧曲线<code>ArcCurve</code>整体相似，区别在于圆心定位方式有差异。</p><p>圆弧<code>.arc()</code>参数的圆心坐标是相对当前<code>.currentPoint</code>而言,而不是坐标原点。</p><p><code>.</code><a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/extras/core/Path.arc" title="arc" target="_blank" rel="noopener noreferrer">arc</a><code>( x :Float, y :Float, radius :Float, startAngle :Float, endAngle :Float, clockwise :Boolean) :this</code></p><ul><li>x, y -- 弧线的中心来自上次调用后的偏移量。</li><li>radius -- 弧线的半径。</li><li>startAngle -- 起始角，以弧度来表示。</li><li>endAngle -- 终止角，以弧度来表示。</li><li>clockwise -- 以顺时针方向创建（扫过）弧线。默认值为<strong>false</strong>。</li></ul><p>如下面示例代码中，圆心位置在100,0 ，而当前位置在150,0，画圆弧时需要将相对坐标设置为-50,0</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 下面代码绘制了一个矩形+扇形的轮廓，圆心在(100, 0),半径50。</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> shape</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Shape</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">shape</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lineTo</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">+</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//.currentPoint变为(100+50,0)</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 圆弧.arc参数的圆心0,0坐标是相对当前.currentPoint而言，而不是坐标原点</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">shape</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">arc</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;">/</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//.currentPoint变为圆弧线结束点坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 绘制直线，直线起点：圆弧绘制结束的点  直线结束点：(0, 0)</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">shape</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lineTo</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>.absarc()</code>圆心坐标不受到<code>.currentPoint</code>影响，以坐标原点作为参考</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> shape</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Shape</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">shape</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lineTo</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//.currentPoint变为(100,0)</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// absarc圆心坐标不受到.currentPoint影响，以坐标原点作为参考</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">shape</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">absarc</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;">/</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//.currentPoint变为圆弧线结束点坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">shape</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lineTo</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="内孔-holes" tabindex="-1"><a class="header-anchor" href="#内孔-holes"><span>内孔<code>.holes</code></span></a></h4><p>借助多边形<code>Shape</code>的内孔<code>.holes</code>属性和<code>Path</code>对象可以实现多边形内部孔洞效果</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// Shape外轮廓：矩形</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> shape</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Shape</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 绘制直线线段，线段起点：.currentPoint，线段结束点：(100,0)</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">shape</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lineTo</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//.currentPoint变为(100, 0)</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">shape</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lineTo</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//.currentPoint变为(100, 100)</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">shape</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lineTo</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//.currentPoint变为(0, 100)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//Shape内孔轮廓</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> path1</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Path</span><span style="color:#D4D4D4;">();</span><span style="color:#6A9955;">// 圆孔1</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">path1</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">absarc</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> path2</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Path</span><span style="color:#D4D4D4;">();</span><span style="color:#6A9955;">// 圆孔2</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">path2</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">absarc</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> path3</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Path</span><span style="color:#D4D4D4;">();</span><span style="color:#6A9955;">// 方形孔</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">path3</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">moveTo</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">path3</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lineTo</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">path3</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lineTo</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">path3</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lineTo</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//三个内孔轮廓分别插入到holes属性中</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">shape</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">holes</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">push</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">path1</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">path2</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">path3</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">ShapeGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">shape</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="模型边界线edgesgeometry" tabindex="-1"><a class="header-anchor" href="#模型边界线edgesgeometry"><span>模型边界线<code>EdgesGeometry</code></span></a></h3><p>借助<code>EdgesGeometry</code>可以给模型设置一个模型边界线</p><p><strong>长方体边线</strong></p><p>先用<code>EdgesGeometry</code>重新计算长方体几何体，返回一个新的几何体，然后用线模型<code>LineSegments</code>模型渲染新的几何体即可。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BoxGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0x004444</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    transparent:</span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    opacity:</span><span style="color:#B5CEA8;">0.5</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 长方体作为EdgesGeometry参数创建一个新的几何体</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> edges</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">EdgesGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> edgesMaterial</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineBasicMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  color:</span><span style="color:#B5CEA8;"> 0x00ffff</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> line</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineSegments</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">edges</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">edgesMaterial</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">line</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="http://www.webgl3d.cn/pages/5fe984/#%E5%9C%86%E6%9F%B1%E8%BE%B9%E7%BA%BF" title="圆柱边线" target="_blank" rel="noopener noreferrer"><strong>圆柱边线</strong></a></p><p><code>EdgesGeometry</code>的第二个参数是thresholdAngle，仅当相邻面的法线之间的角度（单位为角度）超过这个值时，才会渲染边缘。默认值为1。</p><p><strong>外部gltf模型设置材质和边线</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">loader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;../建筑模型.gltf&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 递归遍历设置每个模型的材质，同时设置每个模型的边线</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">traverse</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">        if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">isMesh</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // 模型材质重新设置</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                color:</span><span style="color:#B5CEA8;"> 0x004444</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                transparent:</span><span style="color:#569CD6;"> true</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                opacity:</span><span style="color:#B5CEA8;"> 0.5</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            });</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // 模型边线设置</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">            const</span><span style="color:#4FC1FF;"> edges</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">EdgesGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">            const</span><span style="color:#4FC1FF;"> edgesMaterial</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineBasicMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                color:</span><span style="color:#B5CEA8;"> 0x00ffff</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            })</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">            const</span><span style="color:#4FC1FF;"> line</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineSegments</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">edges</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">edgesMaterial</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            obj</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">line</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    });</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    model</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>实例：通过边线绘制五角星的轮廓</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 定义五角星的形状</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> starShape</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Shape</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> innerRadius</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> outerRadius</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> x</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> y</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> points</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">let</span><span style="color:#9CDCFE;"> i</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> &lt; </span><span style="color:#9CDCFE;">points</span><span style="color:#D4D4D4;"> * </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">++) {</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> angle</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;"> / </span><span style="color:#9CDCFE;">points</span><span style="color:#D4D4D4;">) * </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> radius</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> % </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;"> === </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">) ? </span><span style="color:#9CDCFE;">outerRadius</span><span style="color:#D4D4D4;"> : </span><span style="color:#9CDCFE;">innerRadius</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> px</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;"> + </span><span style="color:#9CDCFE;">radius</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">cos</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">angle</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> py</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;"> + </span><span style="color:#9CDCFE;">radius</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">sin</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">angle</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">    if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> === </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        starShape</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">moveTo</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">px</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">py</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        starShape</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lineTo</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">px</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">py</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建几何体</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">ShapeGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">starShape</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 五角星轮廓填充</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// const material = new THREE.MeshBasicMaterial({ color: 0xffff00 });</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// const mesh = new THREE.Mesh(geometry, material);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 五角星边框轮廓</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> edges</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">EdgesGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建材质</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineBasicMaterial</span><span style="color:#D4D4D4;">({ </span><span style="color:#9CDCFE;">color:</span><span style="color:#B5CEA8;"> 0xffff00</span><span style="color:#D4D4D4;"> });</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建线条</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineSegments</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">edges</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="几何体顶点颜色数据" tabindex="-1"><a class="header-anchor" href="#几何体顶点颜色数据"><span>几何体顶点颜色数据</span></a></h3><p><strong>设置几何体顶点颜色</strong><code>.attributes.color</code></p><ul><li>每个点对应一个位置数据，同时对应一个颜色数据。</li><li>通过点、线、网格模型渲染几何体<code>Geometry</code>，如果希望顶点颜色<code>.attributes.color</code>起作用，需要设置材质属性**<code>vertexColors:true</code>**</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferGeometry</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//创建一个几何体对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> vertices</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Float32Array</span><span style="color:#D4D4D4;">([</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点1坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点2坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">25</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点3坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 顶点位置</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">attributes</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">vertices</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> colors</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Float32Array</span><span style="color:#D4D4D4;">([</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点1颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点2颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点3颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置几何体attributes属性的颜色color属性</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//3个为一组,表示一个顶点的颜色数据RGB</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">attributes</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">color</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">colors</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">); </span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 点渲染模式</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">PointsMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // color: 0x333333,//使用顶点颜色数据，color属性可以不用设置</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    vertexColors:</span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//默认false，设置为true表示使用顶点颜色渲染</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    size:</span><span style="color:#B5CEA8;"> 20.0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//点对象像素尺寸</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> points</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Points</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//点模型对象</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>渐变直线</strong></p><p>自定几何体顶点颜色数据，然后用线模型Line渲染，就能得到渐变的直线效果</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> colors</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Float32Array</span><span style="color:#D4D4D4;">([</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点1颜色 </span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点2颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#B5CEA8;">    0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//顶点3颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">attributes</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">color</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">colors</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">); </span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineBasicMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    vertexColors:</span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//使用顶点颜色渲染</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> line</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Line</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>网格模型颜色渐变</strong></p><p>和渐变直线类似，用网格模型Mesh渲染</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshBasicMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // color: 0x333333,//使用顶点颜色数据，color属性可以不用设置</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    vertexColors:</span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//默认false，设置为true表示使用顶点颜色渲染</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    side:</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">DoubleSide</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="一段曲线颜色渐变" tabindex="-1"><a class="header-anchor" href="#一段曲线颜色渐变"><span>一段曲线颜色渐变</span></a></h3><ol><li>通过样条曲线<code>CatmullRomCurve3</code>生成一段曲线</li><li>获取曲线的顶点数量</li><li>通过顶点数量遍历，按照点在曲线上索引值顺序来计算每个点对应的颜色数据</li><li>设置几何体顶点颜色</li><li>线模型渲染渐变曲线</li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferGeometry</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//创建一个几何体对象</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 三维样条曲线</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> curve</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">CatmullRomCurve3</span><span style="color:#D4D4D4;">([</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">90</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">40</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">40</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">, -</span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">70</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> pointsArr</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">curve</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getSpacedPoints</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//曲线取点      </span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setFromPoints</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">pointsArr</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//pointsArr赋值给顶点位置属性     </span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> pos</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">attributes</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> count</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">pos</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">count</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//顶点数量</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 计算每个顶点的颜色值</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> colorsArr</span><span style="color:#D4D4D4;"> = [];</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">let</span><span style="color:#9CDCFE;"> i</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> &lt; </span><span style="color:#9CDCFE;">count</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">++) {</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> percent</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> / </span><span style="color:#9CDCFE;">count</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//点索引值相对所有点数量的百分比</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    //根据顶点位置顺序大小设置颜色渐变</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 红色分量从0到1变化，蓝色分量从1到0变化</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    colorsArr</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">push</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">percent</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;"> - </span><span style="color:#9CDCFE;">percent</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//蓝色到红色渐变色</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//类型数组创建顶点颜色color数据</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> colors</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Float32Array</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">colorsArr</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置几何体attributes属性的颜色color属性</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">attributes</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">color</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">colors</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">LineBasicMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    vertexColors:</span><span style="color:#569CD6;"> true</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//使用顶点颜色渲染</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> line</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Line</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="color颜色渐变插值方法-lerpcolors-和-lerp" tabindex="-1"><a class="header-anchor" href="#color颜色渐变插值方法-lerpcolors-和-lerp"><span>Color颜色渐变插值方法<code>.lerpColors()</code>和<code>.lerp()</code></span></a></h3><p>通过方法<code>.lerpColors()</code>和<code>.lerp()</code>可以进行颜色混合</p><p><strong><code>lerpColors</code></strong></p><p>执行<code>.lerpColors(Color1,Color2, percent)</code>通过一个百分比参数<code>percent</code>，可以控制Color1和Color2两种颜色混合的百分比，Color1对应<code>1-percent</code>，Color2对应<code>percent</code>。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> c1</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Color</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xff0000</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//红色</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> c2</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Color</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0x0000ff</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//蓝色</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> c</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Color</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 颜色插值结果rgb(0.5,0,0.5)，c1和c2各取50%：</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">c</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lerpColors</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">c1</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">c2</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0.5</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;颜色插值结果&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">c</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong><code>lerp</code></strong></p><p><code>.lerp()</code>和<code>.lerpColors()</code>功能一样，只是具体语法细节不同。</p><p>c1与c2颜色混合，混合后的rgb值，赋值给c1的<code>.r</code>、<code>.g</code>、<code>.b</code>属性</p><p>通过颜色对象克隆方法<code>.clone()</code>可以返回一个新的颜色对象。</p><p>执行<code>c1.clone().lerp()</code>，c1和c2颜色混合后，不会改变c1的颜色值，改变的是<code>c1.clone()</code>返回的新颜色对象。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> c1</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Color</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xff0000</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//红色</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> c2</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Color</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0x0000ff</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//蓝色</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> c</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">c1</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">clone</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">lerp</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">c2</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">percent</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//颜色插值计算</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查看或设置gltf几何体顶点" tabindex="-1"><a class="header-anchor" href="#查看或设置gltf几何体顶点"><span><a href="http://www.webgl3d.cn/pages/fde9a0/" title="查看或设置gltf几何体顶点" target="_blank" rel="noopener noreferrer">查看或设置gltf几何体顶点</a></span></a></h3><h3 id="山脉地形高度可视化-渐变色应用" tabindex="-1"><a class="header-anchor" href="#山脉地形高度可视化-渐变色应用"><span>山脉地形高度可视化（渐变色应用）</span></a></h3><ol><li>山脉几何体y坐标范围</li><li>根据山脉顶点高度设置渐变颜色</li><li>Mesh渲染山脉顶点颜色</li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> loader</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> GLTFLoader</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//创建一个GLTF加载器</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> model</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Group</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//声明一个组对象，用来添加加载成功的三维场景</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">loader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;../地形.glb&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">) { </span><span style="color:#6A9955;">//gltf加载成功后返回一个对象</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    model</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//三维场景添加到model组对象中</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    //mesh表示地形网格模型</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">];</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 1. 山脉顶点数据</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> pos</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">attributes</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> count</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">pos</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">count</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//几何体顶点数量</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 2. 计算模型y坐标高度差</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> yArr</span><span style="color:#D4D4D4;"> = [];</span><span style="color:#6A9955;">//顶点所有y坐标，也就是地形高度</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">    for</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">let</span><span style="color:#9CDCFE;"> i</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> &lt; </span><span style="color:#9CDCFE;">count</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">++) {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        yArr</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">push</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">pos</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getY</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">));</span><span style="color:#6A9955;">//获取顶点y坐标，也就是地形高度</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    yArr</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">sort</span><span style="color:#D4D4D4;">();</span><span style="color:#6A9955;">//y坐标排序，以便于计算地形高度差</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> miny</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">yArr</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">];</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> maxy</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">yArr</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">yArr</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">];</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> height</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">maxy</span><span style="color:#D4D4D4;"> - </span><span style="color:#9CDCFE;">miny</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//山脉整体高度  </span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 3. 计算每个顶点的颜色值</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> colorsArr</span><span style="color:#D4D4D4;"> = [];</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> c1</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Color</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0x0000ff</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//山谷颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> c2</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Color</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xff0000</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//山顶颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">    for</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">let</span><span style="color:#9CDCFE;"> i</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> &lt; </span><span style="color:#9CDCFE;">count</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">++) {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        //当前高度和整体高度比值</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">        const</span><span style="color:#4FC1FF;"> percent</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">pos</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getY</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">) - </span><span style="color:#9CDCFE;">miny</span><span style="color:#D4D4D4;">) / </span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">        const</span><span style="color:#4FC1FF;"> c</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">c1</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">clone</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">lerp</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">c2</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">percent</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//颜色插值计算</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        colorsArr</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">push</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">c</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">r</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">c</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">g</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">c</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">b</span><span style="color:#D4D4D4;">); </span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> colors</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Float32Array</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">colorsArr</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 设置几何体attributes属性的颜色color属性</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">attributes</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">color</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BufferAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">colors</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 4. 设置材质，使用顶点颜色渲染</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        vertexColors:</span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    });</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="十、相机基础" tabindex="-1"><a class="header-anchor" href="#十、相机基础"><span>十、相机基础</span></a></h2><h3 id="正投影相机" tabindex="-1"><a class="header-anchor" href="#正投影相机"><span>正投影相机</span></a></h3><ul><li>正投影相机的<strong>长方体可视化空间</strong>和透视投影<code>PerspectiveCamera</code><strong>视锥体</strong>相似，只是形状不同。</li><li>正投影相机<code>OrthographicCamera</code>和透视投影相机<code>PerspectiveCamera</code>的区别就是，透视投影可以模拟人眼观察世界的视觉效果（没有了近大远小的效果），正投影相机不会。</li><li>一些不需要透视的场景你可以选择使用正投影相机，比如整体预览一个中国地图的效果，或者一个2D可视化的效果。</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 构造函数格式</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">OrthographicCamera</span><span style="color:#D4D4D4;">( </span><span style="color:#9CDCFE;">left</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">right</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">top</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">bottom</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">near</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">far</span><span style="color:#D4D4D4;"> )</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>参数(属性)</th><th>含义</th></tr></thead><tbody><tr><td>left</td><td>渲染空间的左边界</td></tr><tr><td>right</td><td>渲染空间的右边界</td></tr><tr><td>top</td><td>渲染空间的上边界</td></tr><tr><td>bottom</td><td>渲染空间的下边界</td></tr><tr><td>near</td><td>near属性表示的是从距离相机多远的位置开始渲染，一般情况会设置一个很小的值。 默认值0.1</td></tr><tr><td>far</td><td>far属性表示的是距离相机多远的位置截止渲染，如果设置的值偏小小，会有部分场景看不到。 默认值2000</td></tr><tr><td></td><td><img src="/assets/image_BNa27S99NX-Bm82tYK5.png" alt=""></td></tr></tbody></table><p><strong>创建正投影相机</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 正投影相机</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> width</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">innerWidth</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//canvas画布宽度</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> height</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">innerHeight</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//canvas画布高度</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> k</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;"> / </span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//canvas画布宽高比</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> s</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">600</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//控制left, right, top, bottom范围大小</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 按canvas画布宽高比设置相机参数</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> camera</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">OrthographicCamera</span><span style="color:#D4D4D4;">(-</span><span style="color:#9CDCFE;">s</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">k</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">s</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">k</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">s</span><span style="color:#D4D4D4;">, -</span><span style="color:#9CDCFE;">s</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">8000</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2000</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//相机放在了y轴上</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lookAt</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//指向坐标原点</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意<code>.position</code>位置和<code>far</code>参数的设置，确保你想看到的物体能够包含在far之内，超出far的不会渲染。</p><h3 id="canvas画布跟随窗口变化" tabindex="-1"><a class="header-anchor" href="#canvas画布跟随窗口变化"><span>Canvas画布跟随窗口变化</span></a></h3><p>正投影相机<code>OrthographicCamera</code>的<code>left</code>、<code>right</code>属性受到canvas画布宽高比影响，所以需要随着canvas画布更新。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// Canvas画布跟随窗口变化</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">onresize</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> () {</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> width</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">innerWidth</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//canvas画布宽度</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> height</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">innerHeight</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//canvas画布高度</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 1. WebGL渲染器渲染的Cnavas画布尺寸更新</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setSize</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 2.1.更新相机参数</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> k</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;"> / </span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//canvas画布宽高比</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">left</span><span style="color:#D4D4D4;"> = -</span><span style="color:#9CDCFE;">s</span><span style="color:#D4D4D4;">*</span><span style="color:#9CDCFE;">k</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">right</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">s</span><span style="color:#D4D4D4;">*</span><span style="color:#9CDCFE;">k</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 2.2.相机的left, right, top, bottom属性变化了，通知threejs系统</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    camera</span><span style="color:#D4D4D4;">. </span><span style="color:#9CDCFE;">updateP</span><span style="color:#DCDCAA;"> rojectionMatrix</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">};</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="包围盒box3" tabindex="-1"><a class="header-anchor" href="#包围盒box3"><span>包围盒Box3</span></a></h3><p>所谓包围盒<code>Box3</code>，就是一个长方体空间，把模型的所有顶点数据包围在一个最小的长方体空间中，这个最小长方体空间就是该模型的包围盒<code>Box3</code>。</p><p>包围盒Box3表示三维长方体包围区域，使用min和max两个属性来描述该包围区域，Box3的min和max属性值都是三维向量对象Vector3。</p><ul><li><p>描述包围盒区域<code>.min</code>和<code>.max</code></p><ul><li>描述一个长方体包围盒需要通过xyz坐标来表示，X范围[Xmin,Xmax],Y范围[Ymin,Ymax],Z范围[Zmin,Zmax]</li><li><code>.min</code>属性值是<code>Vector3(Xmin, Ymin, Zmin)</code>,<code>.max</code>属性值是<code>Vector3(Xmax, Ymax, Zmax)</code>.</li></ul></li><li><p>计算模型最小包围盒<code>.expandByObject()</code></p><ul><li>模型对象，比如mesh或group，作为<code>.expandByObject()</code>的参数，可以计算该模型的包围盒。</li><li>可以通过<code>.min</code>和<code>.max</code>属性查看模型的包围盒信息。</li></ul></li><li><p>包围盒尺寸<code>.getSize()</code></p><p>返回包围盒具体的长宽高尺寸</p></li><li><p>包围盒几何中心<code>.getCenter()</code></p></li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BoxGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0x00ffff</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 包围盒计算模型对象的大小和位置</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> box3</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Box3</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">box3</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">expandByObject</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">// 计算模型包围盒</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;查看包围盒&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">box3</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> size</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">box3</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getSize</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">size</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">// 计算包围盒尺寸</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;模型包围盒尺寸&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">size</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> center</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">box3</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getCenter</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">center</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">// 计算包围盒中心坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;模型中心坐标&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">center</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="通过包围盒和正投影相机实现2d地图效果" tabindex="-1"><a class="header-anchor" href="#通过包围盒和正投影相机实现2d地图效果"><span>通过包围盒和正投影相机实现2D地图效果</span></a></h3><ol><li><p>获取河南边界轮廓边界经纬度坐标</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#9CDCFE;"> data</span><span style="color:#C586C0;"> from</span><span style="color:#CE9178;"> &#39;./data.js&#39;</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">// 河南省边界轮廓数据</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> pointsArr</span><span style="color:#D4D4D4;"> = [];</span><span style="color:#6A9955;">// 一组二维向量表示一个多边形轮廓坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">forEach</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">){</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // data坐标数据转化为Vector2构成的顶点数组</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> v2</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">],</span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">])</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    pointsArr</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">push</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">v2</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>通过<code>ShapeGeometry</code>渲染河南省地图轮廓</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// Shape表示一个平面多边形轮廓,参数是二维向量构成的数组pointsArr</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> shape</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Shape</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">pointsArr</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 多边形shape轮廓作为ShapeGeometry参数，生成一个多边形平面几何体</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">ShapeGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">shape</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0x00ffff</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    side:</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">DoubleSide</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>使用正投影相机<code>OrthographicCamera</code></p><p>默认情况下，你运行案例源码，可以看到河南地图并没有居中显示，在canvas画布上显示的效果也比较小。</p><p>如果你想地图全屏最大化居中显示，可以通过包围盒来辅助设置计算参数。</p></li><li><p>包围盒<code>Box3</code>计算模型的中心位置和尺寸</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 包围盒计算模型对象的大小和位置</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> box3</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Box3</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">box3</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">expandByObject</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">// 计算模型包围盒</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> size</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">box3</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getSize</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">size</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">// 计算包围盒尺寸</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;模型包围盒尺寸&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">size</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> center</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">box3</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getCenter</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">center</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">// 计算包围盒中心坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;模型中心坐标&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">center</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>通过包围盒计算数据重新调整相机参数，使地图以适合的大小居中显示</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 1.通过包围盒获得模型中心坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> x</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">113.51</span><span style="color:#D4D4D4;">,</span><span style="color:#4FC1FF;">y</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">33.88</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 正投影相机</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> width</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">innerWidth</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//canvas画布宽度</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> height</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">innerHeight</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//canvas画布高度</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> k</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;"> / </span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//canvas画布宽高比</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// const s = 50; //控制left, right, top, bottom范围大小</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 2.根据包围盒大小调整s，包围盒y方向尺寸的一半左右</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> s</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">2.5</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> camera</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">OrthographicCamera</span><span style="color:#D4D4D4;">(-</span><span style="color:#9CDCFE;">s</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">k</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">s</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">k</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">s</span><span style="color:#D4D4D4;">, -</span><span style="color:#9CDCFE;">s</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">8000</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 3.地图平行于canvas画布</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">300</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//与观察点x、y一样，地图平行与canvas画布</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 4.地图居中显示</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lookAt</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>如果使用了<code>OrbitControls</code>，需要设置<code>.target</code>和<code>.lookAt()</code>参数是相同坐标。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> controls</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> OrbitControls</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">controls</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">target</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//与lookAt参数保持一致</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">controls</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">update</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//update()函数内会执行camera.lookAt(controls.target)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>如果使用了辅助观察的坐标系，需要修改<code>position</code></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//辅助观察的坐标系</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> axesHelper</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">AxesHelper</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1000</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">axesHelper</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">axesHelper</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="相机动画" tabindex="-1"><a class="header-anchor" href="#相机动画"><span>相机动画</span></a></h3><p><strong>直线运动</strong></p><p>如果连续改变相机的位置<code>.position</code>，就可以获得一个动画效果。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 渲染循环</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">function</span><span style="color:#DCDCAA;"> render</span><span style="color:#D4D4D4;">() {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">z</span><span style="color:#D4D4D4;"> -= </span><span style="color:#B5CEA8;">0.3</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//相机直线运动动画</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">    requestAnimationFrame</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">render</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>圆周运动</strong></p><p>改变<code>.position</code>属性后，如果不执行<code>.lookAt()</code>方法，相机的观察方向默认不变。</p><p>如果你希望相机圆周运动的同时，改变相机视线方向，保持相机镜头始终指向坐标原点或其它位置，需要每次改变<code>.position</code>属性后，重新执行一遍<code>.lookAt()</code>方法</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 渲染循环</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">let</span><span style="color:#9CDCFE;"> angle</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//用于圆周运动计算的角度值</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> R</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//相机圆周运动的半径</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">function</span><span style="color:#DCDCAA;"> render</span><span style="color:#D4D4D4;">() {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    angle</span><span style="color:#D4D4D4;"> += </span><span style="color:#B5CEA8;">0.01</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 相机y坐标不变，在XOZ平面上做圆周运动</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">R</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">cos</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">angle</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">z</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">R</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">sin</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">angle</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // .position改变，重新执行lookAt(0,0,0)计算相机视线方向</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    camera</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lookAt</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">    requestAnimationFrame</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">render</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="旋转渲染结果-up相机上方向" tabindex="-1"><a class="header-anchor" href="#旋转渲染结果-up相机上方向"><span><a href="http://www.webgl3d.cn/pages/3bcff1/" title="旋转渲染结果(.up相机上方向)" target="_blank" rel="noopener noreferrer">旋转渲染结果(.up相机上方向)</a></span></a></h3><h3 id="管道漫游案例" tabindex="-1"><a class="header-anchor" href="#管道漫游案例"><span>管道漫游案例</span></a></h3><ol><li><p>通过曲线路径生成管道<code>TubeGeometry</code></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 三维样条曲线</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> path</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">CatmullRomCurve3</span><span style="color:#D4D4D4;">([</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">90</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">40</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">40</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">, -</span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">90</span><span style="color:#D4D4D4;">, -</span><span style="color:#B5CEA8;">40</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">120</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">30</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">30</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 样条曲线path作为TubeGeometry参数生成管道</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">TubeGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">path</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">200</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">30</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>通过纹理对象Texture阵列给管道贴图</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> texLoader</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">TextureLoader</span><span style="color:#D4D4D4;">(); </span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> texture</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">texLoader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;./diffuse.jpg&#39;</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//纹理贴图</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">texture</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">wrapS</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">RepeatWrapping</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//UV坐标U方向阵列模式</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">texture</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">repeat</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//纹理沿着管道方向阵列(UV坐标U方向)</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    map:</span><span style="color:#9CDCFE;"> texture</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    side:</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">DoubleSide</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//双面显示看到管道内壁</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>获得运动轨迹上的顶点</p><p>通过曲线的<code>.getSpacedPoints()</code>方法可以从轨迹线上均匀的获得一系列顶点坐标数据，然后你可以用这些轨迹线上顶点坐标设置相机位置。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 从曲线轨迹线上等间距获取一定数量点坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> pointsArr</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">path</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getSpacedPoints</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">500</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>根据获取的顶点数据循环设置相机位置</p></li><li><p>设置相机视线</p><p><code>.lookAt()</code>设置相机观察点为当前点<code>pointsArr[i]</code>的下一个点<code>pointsArr[i + 1]</code>，使相机视线和曲线上当前点切线重合。</p></li><li><p>改变视场角度fov调节渲染效果</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// fov:90度</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> camera</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">PerspectiveCamera</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">90</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;"> / </span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3000</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>相机动画：</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 渲染循环</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">let</span><span style="color:#9CDCFE;"> i</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//在渲染循环中累加变化</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">function</span><span style="color:#DCDCAA;"> render</span><span style="color:#D4D4D4;">() {</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">    if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> &lt; </span><span style="color:#9CDCFE;">pointsArr</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 相机位置设置在当前点位置</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">copy</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">pointsArr</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 曲线上当前点pointsArr[i]和下一个点pointsArr[i+1]近似模拟当前点曲线切线</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 设置相机观察点为当前点的下一个点，相机视线和当前点曲线切线重合</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        camera</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lookAt</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">pointsArr</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> + </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        i</span><span style="color:#D4D4D4;"> += </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//调节速度</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        i</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">    requestAnimationFrame</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">render</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="orbitcontrols旋转缩放限制" tabindex="-1"><a class="header-anchor" href="#orbitcontrols旋转缩放限制"><span><a href="http://www.webgl3d.cn/pages/17b6dc/" title="OrbitControls旋转缩放限制" target="_blank" rel="noopener noreferrer">OrbitControls旋转缩放限制</a></span></a></h3><h3 id="相机控件mapcontrols" tabindex="-1"><a class="header-anchor" href="#相机控件mapcontrols"><span>相机控件<code>MapControls</code></span></a></h3><table><thead><tr><th>相机控件类型</th><th>旋转</th><th>缩放</th><th>平移</th><th>适用场景</th></tr></thead><tbody><tr><td>OrbitControls</td><td>拖动鼠标左键</td><td>滚动鼠标中键</td><td>拖动鼠标右键</td><td>3D 场景</td></tr><tr><td>MapControls</td><td>拖动鼠标右键</td><td>滚动鼠标中键</td><td>拖动鼠标左键</td><td>2D 地图或平面图</td></tr></tbody></table><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    MapControls</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">} </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/controls/OrbitControls.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> controls</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> MapControls</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">controls</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addEventListener</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;change&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> () {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 鼠标右键旋转时候，查看.position变化</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 鼠标左键拖动的时候，查看.position、.target的位置会变化</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;camera.position&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;controls.target&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">controls</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">target</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="十一、光源和阴影" tabindex="-1"><a class="header-anchor" href="#十一、光源和阴影"><span>十一、光源和阴影</span></a></h2><h3 id="聚光源spotlight" tabindex="-1"><a class="header-anchor" href="#聚光源spotlight"><span>聚光源SpotLight</span></a></h3><p>聚光源可以认为是一个沿着特定方会逐渐发散的光源，照射范围在三维空间中构成一个圆锥体。</p><ol><li><p>创建聚光源</p></li><li><p>设置聚光光源发散角度</p></li><li><p>设置光线衰弱<code>.decay</code></p><p>生活中聚光源，比如台灯、手电筒之类，随机距离的改变，光线会衰减，越来越弱，<code>.decay</code>默认值是2.0，如果你不希望衰减可以设置为<code>0.0</code>。</p></li><li><p>设置聚光源的位置position</p></li><li><p>设置光源目标对象 target，默认为原点</p></li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 聚光源</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 0xffffff:光源颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 1.0：光照强度intensity</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> spotLight</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">SpotLight</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xffffff</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">1.0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">spotLight</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//光源添加到场景中</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置聚光光源发散角度</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">spotLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">angle</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;"> / </span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//光锥角度的二分之一</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">spotLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">decay</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0.0</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//设置光源不随距离衰减</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置聚光光源位置</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">spotLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// spotLight.target是一个模型对象Object3D，默认在坐标原点</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">spotLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">target</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//spotLight.target添加到场景中.target.position才会起作用</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">spotLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">target</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>聚光源辅助对象<code>SpotLightHelper</code></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 聚光源辅助对象，可视化聚光源</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> spotLightHelper</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">SpotLightHelper</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">spotLight</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0xffffff</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">spotLightHelper</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="平行光阴影对象directionallightshadow" tabindex="-1"><a class="header-anchor" href="#平行光阴影对象directionallightshadow"><span><strong>平行光阴影对象</strong><code>DirectionalLightShadow</code></span></a></h3><h4 id="阴影相机属性-shadow-camera" tabindex="-1"><a class="header-anchor" href="#阴影相机属性-shadow-camera"><span><strong>阴影</strong>相机属性<code>.shadow.camera</code></span></a></h4><ul><li>平行光<code>DirectionalLight</code>的<code>.shadow</code>属性是<strong>平行光阴影对象</strong><code>DirectionalLightShadow</code></li><li>平行光阴影对象<code>DirectionalLightShadow</code>有一个相机属性<code>.camera</code></li><li><code>.shadow.camera</code>属性值(正投影相机<code>OrthographicCamera</code>)</li></ul><p><strong><code>CameraHelper</code><strong><strong>可视化</strong></strong><code>.shadow.camera</code></strong></p><p>为了方便观察阴影渲染的范围，可以把平行光对应的阴影相机<code>.shadow.camera</code>可视化显示</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 可视化平行光阴影对应的正投影相机对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> cameraHelper</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">CameraHelper</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">shadow</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">cameraHelper</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>设置相机</strong>**<code>.shadow.camera</code>**<strong>长方体范围</strong></p><p>同正投影相机，可以通过<code>.left</code>、<code>.right</code>、<code>.top</code>、<code>.bottom</code>、<code>.near</code>、<code>.far</code>属性调整平行光阴影相机的参数（即设置可视化阴影相机的长方体空间）</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 设置三维场景计算阴影的范围</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">shadow</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">left</span><span style="color:#D4D4D4;"> = -</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">shadow</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">right</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">shadow</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">top</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">200</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">shadow</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">bottom</span><span style="color:#D4D4D4;"> = -</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">shadow</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">near</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0.5</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">shadow</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">far</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">600</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="阴影贴图尺寸属性-mapsize" tabindex="-1"><a class="header-anchor" href="#阴影贴图尺寸属性-mapsize"><span>阴影贴图尺寸属性<code>.mapSize</code></span></a></h4><p>用于提升边缘渲染效果</p><p>mapSize属性默认512x512</p><p>如果你的阴影边缘不够清晰，有模糊感、锯齿感，可以适当提升<code>.mapSize</code>属性值。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// directionalLight.shadow.mapSize.set(128,128);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 如果阴影边缘锯齿感的时候，可以适当提升像素(尺寸一般2的n次方)</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// directionalLight.shadow.mapSize.set(1024,1024);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">shadow</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">mapSize</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">2048</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">2048</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="阴影半径属性-radius" tabindex="-1"><a class="header-anchor" href="#阴影半径属性-radius"><span>阴影半径属性<code>.radius</code></span></a></h4><p>用于弱化模糊阴影边缘</p><p>适当提升<code>.shadow.radius</code>,你可以感到阴影边缘与非阴影区域是渐变过渡，或者说阴影边缘逐渐弱化或模糊化，没有很明显的边界感。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">shadow</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">radius</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="阴影条纹问题解决-shadowmap-type" tabindex="-1"><a class="header-anchor" href="#阴影条纹问题解决-shadowmap-type"><span>阴影条纹问题解决<code>.shadowMap.type</code></span></a></h4><p>模型表面产生条纹影响渲染效果，可以改变<code>.shadowMap.type</code>默认值优化</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 模型表面产生条纹影响渲染效果，可以改变.shadowMap.type默认值优化</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">shadowMap</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">type</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">VSMShadowMap</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="平行光阴影计算" tabindex="-1"><a class="header-anchor" href="#平行光阴影计算"><span>平行光阴影计算</span></a></h3><ol><li><p><code>.castShadow</code>设置<strong>产生阴影</strong>的模型对象</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 长方体网格模型</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BoxGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0x00ffff</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置产生投影的网格模型</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">castShadow</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>.castShadow</code>设置<strong>产生阴影</strong>的光源对象</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> directionalLight</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">DirectionalLight</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xffffff</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//平行光</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置产生阴影的光源对象,开启光源阴影的计算功能</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">castShadow</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>.receiveShadow</code>设置<strong>接收阴影</strong>效果的模型</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 矩形平面网格模型</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> planeMesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">planeGeometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">planeMaterial</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">planeMesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">rotateX</span><span style="color:#D4D4D4;">(-</span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;">/</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置接收阴影的投影面</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">planeMesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">receiveShadow</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>.shadowMap.enabled</code>允许WebGL渲染器渲染阴影</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// WebGL渲染器设置</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> renderer</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">WebGLRenderer</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    antialias:</span><span style="color:#569CD6;"> true</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//开启优化锯齿</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setPixelRatio</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">devicePixelRatio</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//防止输出模糊</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setSize</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">body</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">appendChild</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置渲染器，允许光源阴影渲染</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">shadowMap</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">enabled</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>.shadow.camera</code>设置光源阴影渲染范围</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 设置三维场景计算阴影的范围</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">shadow</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">left</span><span style="color:#D4D4D4;"> = -</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">shadow</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">right</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">shadow</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">top</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">200</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">shadow</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">bottom</span><span style="color:#D4D4D4;"> = -</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">shadow</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">near</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0.5</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">shadow</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">far</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">400</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>.position</code>调整光源位置（按需调整）</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">directionalLight</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><h2 id="十二、精灵模型sprite" tabindex="-1"><a class="header-anchor" href="#十二、精灵模型sprite"><span>十二、精灵模型Sprite</span></a></h2><h4 id="精灵模型sprite" tabindex="-1"><a class="header-anchor" href="#精灵模型sprite"><span>精灵模型Sprite</span></a></h4><p>Three.js的精灵模型<code>Sprite</code>和Threejs的网格模型<code>Mesh</code>一样都是模型对象，父类都是<code>Object3D</code></p><p>**<code>Sprite</code><strong><strong>与矩形平面</strong></strong><code>Mesh</code>**<strong>的区别</strong>：<code>Sprite</code>矩形平面会始终平行于Canvas画布或者说屏幕，而矩形平面<code>Mesh</code>的姿态角度会跟着旋转，不一定平行于canvas画布。</p><ol><li><p>创建精灵模型材质<code>SpriteMaterial</code></p><p>精灵材质对象<code>SpriteMaterial</code>和普通的网格材质一样可以设置颜色<code>.color</code>、颜色贴图<code>.map</code>、开启透明<code>.transparent</code>、透明度<code>.opacity</code>等属性，精灵材质对象<code>SpriteMaterial</code>的父类是材质<code>Material</code>。</p></li><li><p>创建精灵模型<code>Sprite</code></p><ul><li>创建精灵模型对象<code>Sprite</code>和创建网格模型对象一样需要创建一个材质对象，不同的地方在于创建精灵模型对象不需要创建几何体对象<code>Geometry</code>。</li><li>精灵模型<code>Sprite</code>默认是一个矩形形状，默认长宽都是1，默认在坐标原点位置。</li></ul></li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 创建精灵材质对象SpriteMaterial</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> spriteMaterial</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">SpriteMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  color:</span><span style="color:#B5CEA8;">0x00ffff</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//设置颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建精灵模型对象，不需要几何体geometry参数</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> sprite</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Sprite</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">spriteMaterial</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置精灵模型在三维空间中的位置坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">sprite</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 控制精灵大小</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">sprite</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scale</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">25</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//只需要设置x、y两个分量就可以</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="精灵模型标注场景-贴图" tabindex="-1"><a class="header-anchor" href="#精灵模型标注场景-贴图"><span>精灵模型标注场景（贴图）</span></a></h3><ol><li><p>引入纹理图</p></li><li><p><code>.map</code>设置贴图</p></li><li><p><code>.transparent</code>是否透明</p><p>如果贴图是背景透明的png贴图，需要把<code>.transparent</code>设置为true</p></li><li><p><code>.color</code>与<code>.map</code>混合</p><p>如果<code>.map</code>是纯白色贴图，你可以通过设置<code>.color</code>,把精灵模型设置为其他任意颜色。</p></li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> texture</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">TextureLoader</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;./光点.png&quot;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> spriteMaterial</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">SpriteMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  color:</span><span style="color:#B5CEA8;"> 0x00ffff</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//设置颜色</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  map:</span><span style="color:#9CDCFE;"> texture</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//设置精灵纹理贴图</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  transparent:</span><span style="color:#569CD6;"> true</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//SpriteMaterial默认是true</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> sprite</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Sprite</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">spriteMaterial</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 控制精灵大小</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">sprite</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scale</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="sprite模拟下雨、下雪" tabindex="-1"><a class="header-anchor" href="#sprite模拟下雨、下雪"><span><a href="http://www.webgl3d.cn/pages/477843/" title="Sprite模拟下雨、下雪" target="_blank" rel="noopener noreferrer">Sprite模拟下雨、下雪</a></span></a></h3><ol><li><p>Sprite模拟雨滴</p></li><li><p>雨滴在3D空间随机分布</p></li><li><p>周期性改变雨滴Sprite位置</p></li><li><p>根据时间计算Sprite位置</p><p><code>clock.getDelta()</code>获得前后两次执行该方法的时间间隔</p></li><li><p>相机镜头附近的雨滴偏大，可以把相机的near参数调大一些</p></li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> texture</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">TextureLoader</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;雨滴.png&quot;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> spriteMaterial</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">SpriteMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    map:</span><span style="color:#9CDCFE;"> texture</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 批量创建多个精灵模型，在一个长方体空间上随机分布</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> group</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Group</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">model</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">group</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">let</span><span style="color:#9CDCFE;"> i</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> &lt; </span><span style="color:#B5CEA8;">16000</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">++) {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 精灵模型共享材质</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> sprite</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Sprite</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">spriteMaterial</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    group</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">sprite</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    sprite</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scale</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 设置精灵模型位置，在长方体空间上上随机分布</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> x</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">1000</span><span style="color:#D4D4D4;"> * (</span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">random</span><span style="color:#D4D4D4;">() - </span><span style="color:#B5CEA8;">0.5</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> y</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">600</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">random</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> z</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">1000</span><span style="color:#D4D4D4;"> * (</span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">random</span><span style="color:#D4D4D4;">() - </span><span style="color:#B5CEA8;">0.5</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    sprite</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">z</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> clock</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Clock</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">function</span><span style="color:#DCDCAA;"> loop</span><span style="color:#D4D4D4;">() {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // loop()两次执行时间间隔</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> t</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">clock</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getDelta</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // loop()每次执行都会更新雨滴的位置，进而产生动画效果</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    group</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">forEach</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">sprite</span><span style="color:#569CD6;"> =&gt;</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 雨滴的y坐标每次减t*60</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        sprite</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;"> -= </span><span style="color:#9CDCFE;">t</span><span style="color:#D4D4D4;">*</span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">        if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">sprite</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;"> &lt; </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // 如果雨滴落到地面，重置y，从新下落</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            sprite</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">600</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    });</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">    requestAnimationFrame</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">loop</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">loop</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="十三、后处理effectcomposer" tabindex="-1"><a class="header-anchor" href="#十三、后处理effectcomposer"><span>十三、后处理EffectComposer</span></a></h2><h3 id="发光描边outlinepass" tabindex="-1"><a class="header-anchor" href="#发光描边outlinepass"><span>发光描边OutlinePass</span></a></h3><ol><li>引入后处理扩展库<code>EffectComposer.js</code>，创建后处理对象EffectComposer，WebGL渲染器作为参数</li><li>引入渲染器通道<code>RenderPass</code>，创建一个渲染器通道RenderPass，场景和相机作为参数，添加到composer中</li><li>引入<code>OutlinePass</code>通道，创建OutlinePass通道</li><li>使用OutlinePass属性<code>.selectedObjects</code>设置需要高亮发光描边的模型对象（是一个数组）</li><li>把创建好的OutlinePass通道添加到后处理composer中</li><li>渲染循环中后处理EffectComposer执行<code>.render()</code></li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 引入后处理扩展库EffectComposer.js</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">EffectComposer</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/postprocessing/EffectComposer.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 引入渲染器通道RenderPass</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">RenderPass</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/postprocessing/RenderPass.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 引入OutlinePass通道</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">OutlinePass</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/postprocessing/OutlinePass.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// ...创建scene、camera、render</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建后处理对象EffectComposer，WebGL渲染器作为参数</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> composer</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> EffectComposer</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建一个渲染器通道，场景和相机作为参数</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> renderPass</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> RenderPass</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置renderPass通道</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">composer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addPass</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">renderPass</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建OutlinePass通道,显示模型外轮廓边框</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> v2</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">innerWidth</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">innerWidth</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// outlinePass第一个参数v2的尺寸和canvas画布保持一致</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> outlinePass</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> OutlinePass</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">v2</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//设置需要高亮发光描边的模型对象</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">outlinePass</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">selectedObjects</span><span style="color:#D4D4D4;"> = [</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">];</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置OutlinePass通道</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">composer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addPass</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">outlinePass</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 渲染循环</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">function</span><span style="color:#DCDCAA;"> render</span><span style="color:#D4D4D4;">() {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 使用后处理模块EffectComposer，可通过该对象的render方法调用渲染器的render方法</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // renderer.render(scene, camera)不用再执行</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    composer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // renderer.render(scene, camera);</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">    requestAnimationFrame</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">render</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="outlinepass描边样式" tabindex="-1"><a class="header-anchor" href="#outlinepass描边样式"><span><a href="http://www.webgl3d.cn/pages/73bfc8/" title="OutlinePass描边样式" target="_blank" rel="noopener noreferrer">OutlinePass描边样式</a></span></a></h3><h3 id="bloom发光通道" tabindex="-1"><a class="header-anchor" href="#bloom发光通道"><span>Bloom发光通道</span></a></h3><p>和发光描边OutlinePass类型，把第三步换成引入UnrealBloomPass通道</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 引入UnrealBloomPass通道</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">UnrealBloomPass</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/postprocessing/UnrealBloomPass.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// UnrealBloomPass第一个参数是一个二维向量，xy分量和canvas画布宽高度保持一致</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> bloomPass</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> UnrealBloomPass</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">innerWidth</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">innerHeight</span><span style="color:#D4D4D4;">));</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">bloomPass</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">strength</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">2.0</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//bloom发光强度</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置bloomPass通道</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">composer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addPass</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">bloomPass</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="glitchpass通道" tabindex="-1"><a class="header-anchor" href="#glitchpass通道"><span>GlitchPass通道</span></a></h3><p><code>GlitchPass</code>通道会产生闪屏效果。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 引入GlitchPass通道</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">GlitchPass</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/postprocessing/GlitchPass.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> glitchPass</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> GlitchPass</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置glitchPass通道</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">composer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addPass</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">glitchPass</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="gltf后处理颜色异常-伽马校正" tabindex="-1"><a class="header-anchor" href="#gltf后处理颜色异常-伽马校正"><span>gltf后处理颜色异常(伽马校正)</span></a></h3><p>使用threejs后处理功能EffectComposer，<code>renderer.outputColorSpace</code> 会无效，颜色会出现偏差，可以通过创建伽马校正后处理通道</p><ol><li>引入伽马校正后处理<code>Shader</code>GammaCorrectionShader.js</li><li>引入ShaderPass.js处理后处理通道</li><li>创建伽马校正通道</li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 伽马校正后处理Shader</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> {</span><span style="color:#9CDCFE;">GammaCorrectionShader</span><span style="color:#D4D4D4;">} </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/shaders/GammaCorrectionShader.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// ShaderPass功能：使用后处理Shader创建后处理通道</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> {</span><span style="color:#9CDCFE;">ShaderPass</span><span style="color:#D4D4D4;">} </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/postprocessing/ShaderPass.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建伽马校正通道</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> gammaPass</span><span style="color:#D4D4D4;">= </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> ShaderPass</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">GammaCorrectionShader</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">composer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addPass</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">gammaPass</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="抗锯齿后处理" tabindex="-1"><a class="header-anchor" href="#抗锯齿后处理"><span>抗锯齿后处理</span></a></h3><h4 id="fxaa抗锯齿通道" tabindex="-1"><a class="header-anchor" href="#fxaa抗锯齿通道"><span>FXAA抗锯齿通道</span></a></h4><p>FXAA减弱了锯齿，但是并不完美。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// FXAA抗锯齿Shader</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">FXAAShader</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/shaders/FXAAShader.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// ShaderPass功能：使用后处理Shader创建后处理通道</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> {</span><span style="color:#9CDCFE;">ShaderPass</span><span style="color:#D4D4D4;">} </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/postprocessing/ShaderPass.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置设备像素比，避免canvas画布输出模糊</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setPixelRatio</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">devicePixelRatio</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> FXAAPass</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> ShaderPass</span><span style="color:#D4D4D4;">( </span><span style="color:#9CDCFE;">FXAAShader</span><span style="color:#D4D4D4;"> );</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// `.getPixelRatio()`获取`renderer.setPixelRatio()`设置的值</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> pixelRatio</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getPixelRatio</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//获取设备像素比 </span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// width、height是canva画布的宽高度</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">FXAAPass</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">uniforms</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">resolution</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">value</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;"> /(</span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;">*</span><span style="color:#9CDCFE;">pixelRatio</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">FXAAPass</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">uniforms</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">resolution</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">value</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;"> /(</span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">*</span><span style="color:#9CDCFE;">pixelRatio</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">composer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addPass</span><span style="color:#D4D4D4;">( </span><span style="color:#9CDCFE;">FXAAPass</span><span style="color:#D4D4D4;"> );</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="smaa抗锯齿通道" tabindex="-1"><a class="header-anchor" href="#smaa抗锯齿通道"><span>SMAA抗锯齿通道</span></a></h4><p>SMAA相比较FXAA抗锯齿效果更好一些。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// SMAA抗锯齿通道</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> {</span><span style="color:#9CDCFE;">SMAAPass</span><span style="color:#D4D4D4;">} </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/postprocessing/SMAAPass.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//获取.setPixelRatio()设置的设备像素比</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> pixelRatio</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getPixelRatio</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// width、height是canva画布的宽高度</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> smaaPass</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> SMAAPass</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">pixelRatio</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">pixelRatio</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">composer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addPass</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">smaaPass</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="十四、射线拾取模型" tabindex="-1"><a class="header-anchor" href="#十四、射线拾取模型"><span>十四、射线拾取模型</span></a></h2><h3 id="射线ray" tabindex="-1"><a class="header-anchor" href="#射线ray"><span>射线Ray</span></a></h3><p>类比数学几何中提到的射线，在三维空间中，一条线把一个点作为<strong>起点</strong>，然后沿着某个<strong>方向</strong>无限延伸。</p><p><strong>1、创建射线</strong><code>Ray</code></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 创建射线对象Ray</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> ray</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Ray</span><span style="color:#D4D4D4;">()</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2、设置射线起点</strong><code>.origin</code></p><p>可以用一个三维向量<code>Vector3</code>的x、y、z分量表示，也可以用<code>.set()</code>方法设置</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 方式一</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">ray</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">origin</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 方式二</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">ray</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">origin</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3、设置射线方向</strong><code>.direction</code></p><p>用一个三维向量<code>Vector3</code>表示,向量长度保证为1，也就是单位向量。</p><p>注意：<code>.direction</code>的值需要是单位向量，不是的话可以执行.normalize()归一化或者说标准化。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 表示射线沿着x轴正方向</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">ray</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">direction</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 表示射线沿着x轴负方向</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">ray</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">direction</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 向量长度不是1，需要归一化</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">ray</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">direction</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">normalize</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 表示射线沿着xy坐标轴的中间线</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">ray</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">direction</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">normalize</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**<code>.intersectTriangle()</code>**<strong>方法计算一个射线和一个三角形在3D空间中是否交叉</strong></p><p>执行<code>.intersectTriangle()</code>方法，如果相交返回交点坐标，不相交返回空值<code>null</code>。</p><p><code>.</code><a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/math/Ray.intersectTriangle" title="intersectTriangle" target="_blank" rel="noopener noreferrer">intersectTriangle</a><code>( a :</code><a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/math/Vector3" title="Vector3" target="_blank" rel="noopener noreferrer">Vector3</a><code>, b :</code><a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/math/Vector3" title="Vector3" target="_blank" rel="noopener noreferrer">Vector3</a><code>, c :</code><a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/math/Vector3" title="Vector3" target="_blank" rel="noopener noreferrer">Vector3</a><code>, backfaceCulling :Boolean, target :</code><a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/math/Vector3" title="Vector3" target="_blank" rel="noopener noreferrer">Vector3</a><code>) :</code><a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/math/Vector3" title="Vector3" target="_blank" rel="noopener noreferrer">Vector3</a></p><ul><li><a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/math/Vector3" title="a" target="_blank" rel="noopener noreferrer">a</a>,<a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/math/Vector3" title="b" target="_blank" rel="noopener noreferrer">b</a>,<a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/math/Vector3" title="c" target="_blank" rel="noopener noreferrer">c</a>- 组成三角形的三个<a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/math/Vector3" title="Vector3" target="_blank" rel="noopener noreferrer">Vector3</a>。</li><li>backfaceCulling- 是否使用背面剔除。</li><li><a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/math/Vector3" title="target" target="_blank" rel="noopener noreferrer">target</a>— 结果将会被复制到这一Vector3中。</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 三角形三个点坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> p1</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">25</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> p2</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, -</span><span style="color:#B5CEA8;">25</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">25</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> p3</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, -</span><span style="color:#B5CEA8;">25</span><span style="color:#D4D4D4;">, -</span><span style="color:#B5CEA8;">25</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> point</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">();</span><span style="color:#6A9955;">//用来记录射线和三角形的交叉点</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// `.intersectTriangle()`计算射线和三角形是否相交叉，相交返回交点，不相交返回null</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> result</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">ray</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">intersectTriangle</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">p1</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">p2</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">p3</span><span style="color:#D4D4D4;">,</span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">point</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;交叉点坐标&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">point</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;查看是否相交&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">result</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="raycaster射线投射器" tabindex="-1"><a class="header-anchor" href="#raycaster射线投射器"><span>Raycaster射线投射器</span></a></h3><p>射线投射器<code>Raycaster</code>具有一个射线属性<code>.ray</code>，该属性的值就是射线对象<code>Ray</code></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 方式一</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> raycaster</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Raycaster</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),</span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">));</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 方式二</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置射线起点</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">raycaster</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">ray</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">origin</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(-</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置射线方向射线方向沿着x轴</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">raycaster</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">ray</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">direction</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="射线交叉计算-intersectobjects-方法" tabindex="-1"><a class="header-anchor" href="#射线交叉计算-intersectobjects-方法"><span>射线交叉计算(<code>.intersectObjects()</code>方法)</span></a></h3><p>射线投射器<code>Raycaster</code>通过<code>.intersectObjects()</code>方法可以计算出来与自身射线<code>.ray</code>相交的网格模型。</p><p><code>.intersectObjects([mesh1, mesh2, mesh3])</code>对参数中的网格模型对象进行射线交叉计算,未选中对象返回空数组[],选中一个对象，数组1个元素，选中多个对象，数组多个元素，如果选中多个对象，对象在数组中按照先后排序。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//.intersectObjects([mesh1, mesh2, mesh3])对参数中的网格模型对象进行射线交叉计算</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 未选中对象返回空数组[],选中一个对象，数组1个元素，选中多个对象，数组多个元素</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> intersects</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">raycaster</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">intersectObjects</span><span style="color:#D4D4D4;">([</span><span style="color:#9CDCFE;">mesh1</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">mesh2</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">mesh3</span><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;射线器返回的对象&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">intersects</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// intersects.length大于0说明，说明选中了模型</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 如果选中多个模型，就会按照先后顺序排序</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">intersects</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> &gt; </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // console.log(&quot;交叉点&quot;, intersects[0].point);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // console.log(&quot;交叉对象&quot;,intersects[0].object);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // console.log(&quot;射线原点和交叉点距离&quot;,intersects[0].distance);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 选中模型的第一个模型，设置为红色</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    intersects</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">].</span><span style="color:#9CDCFE;">object</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">color</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xff0000</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：射线拾取的时候，mesh1, mesh2, mesh3位置要确保更新的情况下，执行射线计算</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//注意更新下模型的世界矩阵，你设置的position生效，再进行射线拾取计算</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">model</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">updateMatrixWorld</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="屏幕坐标转标准设备坐标" tabindex="-1"><a class="header-anchor" href="#屏幕坐标转标准设备坐标"><span>屏幕坐标转标准设备坐标</span></a></h3><h4 id="获取鼠标事件坐标" tabindex="-1"><a class="header-anchor" href="#获取鼠标事件坐标"><span>获取鼠标事件坐标</span></a></h4><p><code>.offsetX</code>、<code>.offsetY</code>表示鼠标单击位置的坐标，单位是像素px，以点击的HTML元素左上角为坐标原点，水平向右方向为x轴，竖直向下方向为y轴。</p><p><code>.clientX</code>、<code>.clientY</code>和<code>.offsetX</code>、<code>.offsetY</code>含义区别在于坐标原点不同，是以浏览器窗口页面的左上角作为坐标原点，其他一样。</p><h4 id="标准设备坐标系" tabindex="-1"><a class="header-anchor" href="#标准设备坐标系"><span><strong>标准设备坐标系</strong></span></a></h4><p>Three.js Canvas画布具有一个标准设备坐标系，该坐标系的坐标原点在canvas画布的中间位置，x轴水平向右，y轴竖直向上。</p><p>标准设备坐标系的坐标值不是绝对值，是相对值，范围是[-1,1]区间，也是说canvas画布上任何一个位置的坐标，如果用标准设备坐标系去衡量，那么坐标的所有值都在-1到1之间。</p><h4 id="屏幕坐标转标准设备坐标-1" tabindex="-1"><a class="header-anchor" href="#屏幕坐标转标准设备坐标-1"><span>屏幕坐标转标准设备坐标</span></a></h4><p>把<code>.offsetX</code>和<code>.offsetY</code>坐标转化为标准设备坐标：</p><blockquote><p>canvas画布的宽度是width，<code>.offsetX</code>的范围是0~width,<code>.offsetX</code>除以canvas画布宽度width，就可以从绝对值变成相对值，范围是0~1，相对值乘以2，范围0~2，再减去1，范围是-1~1，刚好和canvas画布标准设备坐标的范围-1~1能够对应起来。</p></blockquote><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 坐标转化公式</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">addEventListener</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;click&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">event</span><span style="color:#D4D4D4;">){</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> px</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">event</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">offsetX</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> py</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">event</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">offsetY</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    //屏幕坐标px、py转标准设备坐标x、y</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    //width、height表示canvas画布宽高度</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> x</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">px</span><span style="color:#D4D4D4;"> / </span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;">) * </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;"> - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> y</span><span style="color:#D4D4D4;"> = -(</span><span style="color:#9CDCFE;">py</span><span style="color:#D4D4D4;"> / </span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">) * </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;"> + </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>把<code>.clientX</code>和<code>.clientY</code>坐标转化为标准设备坐标：</p><blockquote><p>注意：把<code>.clientX</code>、<code>.clientY</code>转化为以canvas画布左上角为原点的坐标</p></blockquote><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 屏幕坐标转标准设备坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">addEventListener</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;click&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">event</span><span style="color:#D4D4D4;">){</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // left、top表示canvas画布布局，距离顶部和左侧的距离(px)</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> px</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">event</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">clientX</span><span style="color:#D4D4D4;">-</span><span style="color:#9CDCFE;">left</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> py</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">event</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">clientY</span><span style="color:#D4D4D4;">-</span><span style="color:#9CDCFE;">top</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    //屏幕坐标px、py转标准设备坐标x、y</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    //width、height表示canvas画布宽高度</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> x</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">px</span><span style="color:#D4D4D4;"> / </span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;">) * </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;"> - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> y</span><span style="color:#D4D4D4;"> = -(</span><span style="color:#9CDCFE;">py</span><span style="color:#D4D4D4;"> / </span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">) * </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;"> + </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="通过raycaster实现鼠标点击选中模型" tabindex="-1"><a class="header-anchor" href="#通过raycaster实现鼠标点击选中模型"><span>通过<code>Raycaster</code>实现鼠标点击选中模型</span></a></h3><ol><li>坐标转化(鼠标单击的屏幕坐标转标准设备坐标)</li><li>使用<code>.setFromCamera()</code>方法进行射线计算(通过鼠标单击位置+相机参数计算射线值)</li><li>使用<code>.intersectObjects()</code>射线交叉计算</li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addEventListener</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;click&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">event</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // .offsetY、.offsetX以canvas画布左上角为坐标原点,单位px</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> px</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">event</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">offsetX</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> py</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">event</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">offsetY</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    //屏幕坐标px、py转WebGL标准设备坐标x、y</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    //width、height表示canvas画布宽高度</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> x</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">px</span><span style="color:#D4D4D4;"> / </span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;">) * </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;"> - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> y</span><span style="color:#D4D4D4;"> = -(</span><span style="color:#9CDCFE;">py</span><span style="color:#D4D4D4;"> / </span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">) * </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;"> + </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    </span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    //创建一个射线投射器`Raycaster`</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> raycaster</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Raycaster</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    //.setFromCamera()计算射线投射器`Raycaster`的射线属性.ray</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 形象点说就是在点击位置创建一条射线，用来选中拾取模型对象</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    raycaster</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setFromCamera</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector2</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;">), </span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    </span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    //.intersectObjects([mesh1, mesh2, mesh3])对参数中的网格模型对象进行射线交叉计算</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 未选中对象返回空数组[],选中一个对象，数组1个元素，选中多个对象，数组多个元素</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> intersects</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">raycaster</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">intersectObjects</span><span style="color:#D4D4D4;">([</span><span style="color:#9CDCFE;">mesh1</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">mesh2</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">mesh3</span><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;射线器返回的对象&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">intersects</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // intersects.length大于0说明，说明选中了模型</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">    if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">intersects</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> &gt; </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // console.log(&quot;交叉点&quot;, intersects[0].point);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // console.log(&quot;交叉对象&quot;,intersects[0].object)</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 选中模型的第一个模型，设置为红色</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        intersects</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">].</span><span style="color:#9CDCFE;">object</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">color</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xff0000</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="射线拾取层级模型-模型描边" tabindex="-1"><a class="header-anchor" href="#射线拾取层级模型-模型描边"><span><a href="http://www.webgl3d.cn/pages/dd2774/" title="射线拾取层级模型(模型描边)" target="_blank" rel="noopener noreferrer">射线拾取层级模型(模型描边)</a></span></a></h3><p>后处理描边样式OutlinePass和射线投射器Raycaster鼠标点击选中模型结合</p><h3 id="射线拾取sprite控制场景" tabindex="-1"><a class="header-anchor" href="#射线拾取sprite控制场景"><span>射线拾取Sprite控制场景</span></a></h3><p>射线投射器<code>Raycaster</code>通过<code>.intersectObjects()</code>方法可以拾取网格模型<code>Mesh</code>，一样也可以拾取精灵模型<code>Sprite</code>。</p><p><strong>1、给精灵模型绑定一个函数</strong>**<code>.change()</code>**</p><p>三维场景中提供了两个精灵模型对象，可以分别自定义一个方法<code>.change()</code>。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">sprite</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">change</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">(){</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">color</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xffffff</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">sprite2</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">change</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">(){</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">color</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0xffff00</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2、射线选中</strong>**<code>Sprite</code><strong><strong>,</strong></strong><code>sprite.change()</code>**<strong>函数执行</strong></p><p>鼠标单击，如果选中某个精灵模型，就调用该精灵模型绑定的函数<code>.change()</code>。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#DCDCAA;">addEventListener</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;click&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">event</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ...</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ...</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 射线交叉计算拾取精灵模型</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> intersects</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">raycaster</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">intersectObjects</span><span style="color:#D4D4D4;">([</span><span style="color:#9CDCFE;">sprite</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">sprite2</span><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">    if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">intersects</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> &gt; </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        intersects</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">].</span><span style="color:#9CDCFE;">object</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">change</span><span style="color:#D4D4D4;">();</span><span style="color:#6A9955;">//执行选中sprite绑定的change函数</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="十五、场景标注标签信息" tabindex="-1"><a class="header-anchor" href="#十五、场景标注标签信息"><span>十五、场景标注标签信息</span></a></h2><h3 id="css2drenderer-html标签" tabindex="-1"><a class="header-anchor" href="#css2drenderer-html标签"><span>CSS2DRenderer(HTML标签)</span></a></h3><p>通过<code>CSS2DRenderer.js</code>扩展库可以把HTML元素作为标签标注三维场景。</p><ol><li><p>HTML元素创建标签</p></li><li><p>通过CSS2模型对象<code>CSS2DObject</code>，把一个HTML元素转化为一个类似threejs网格模型的对象</p></li><li><p>引入CSS2渲染器<code>CSS2DRenderer</code></p><ol><li>通过<code>CSS2Renderer.render()</code>渲染HTML标签</li><li><code>CSS2Renderer.setSize()</code></li><li>渲染结果<code>CSS2Renderer.domElement</code></li></ol></li><li><p>CSS2Renderer.domElement重新定位</p><p>threejs执行<code>css2Renderer.render()</code>之后，打开浏览器控制台<strong>元素</strong>选项，可以发现<code>&lt;div id=&quot;tag&quot;&gt;&lt;/div&gt;</code>外面多了一层div父元素,<code>CSS2Renderer.domElement</code>对应的就是<code>&lt;div id=&quot;tag&quot;&gt;&lt;/div&gt;</code>外面的父元素。</p><p><code>CSS2Renderer.domElement</code>重新定位，叠加到canvas画布上，与canvas画布重合即可</p></li><li><p>解决HTML标签遮挡Canvas画布事件</p><p>HTML元素标签<code>&lt;div id=&quot;tag&quot;&gt;&lt;/div&gt;</code>外面div父元素遮挡了Canvas画布鼠标事件，会造成相机控件<code>OrbitControls</code>的旋转、缩放等操作无效</p><p>1、设置<code>.style.pointerEvents = none</code></p><p>2、设置z-index顺序</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">style</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">zIndex</span><span style="color:#D4D4D4;"> = -</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">css2Renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">style</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">zIndex</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>设置CSS2模型对象CSS2DObject代码</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 引入CSS2模型对象CSS2DObject</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">CSS2DObject</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/renderers/CSS2DRenderer.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> div</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getElementById</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;tag&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// HTML元素转化为threejs的CSS2模型对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> tag</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> CSS2DObject</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">div</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置标签位置</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">tag</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">tag</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>设置CSS2渲染器CSS2DRenderer代码</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 引入CSS2渲染器CSS2DRenderer</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">CSS2DRenderer</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/renderers/CSS2DRenderer.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建一个CSS2渲染器CSS2DRenderer</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> css2Renderer</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> CSS2DRenderer</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">css2Renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setSize</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">body</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">appendChild</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">css2Renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// HTML标签&lt;div id=&quot;tag&quot;&gt;&lt;/div&gt;外面父元素叠加到canvas画布上且重合</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 注意canvas网布布局方式不同，CSS相关代码写法也可能不同，不过你只要能让标签父元素叠加到canvas画布上上面且重合就行</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">css2Renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">style</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;absolute&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">css2Renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">style</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">top</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;0px&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//设置.pointerEvents=none，解决HTML元素标签对threejs canvas画布鼠标事件的遮挡</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">css2Renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">style</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">pointerEvents</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;none&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 渲染循环</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">function</span><span style="color:#DCDCAA;"> render</span><span style="color:#D4D4D4;">() {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    css2Renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">    requestAnimationFrame</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">render</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**<code>css2Renderer.render()</code>**<strong>渲染本质</strong>：css2Renderer.render()渲染HTML元素对应的CSS2模型对象，本质上就是根据CSS2模型对象的xyz世界坐标，计算HTML标签元素在canvas画布上的屏幕像素坐标位置。</p><h3 id="标签位置的不同设置方式" tabindex="-1"><a class="header-anchor" href="#标签位置的不同设置方式"><span>标签位置的不同设置方式</span></a></h3><p>如果需要的mesh有多个父对象，且都有自己的位置属性<code>.position</code>，设置mesh标签对象位置<code>CSS2DObject.position</code>的时候，就需要考虑mesh父对象的位置对mesh的影响。</p><h4 id="getworldposition-方法计算世界坐标" tabindex="-1"><a class="header-anchor" href="#getworldposition-方法计算世界坐标"><span><code>.getWorldPosition()</code>方法计算世界坐标</span></a></h4><p>通过<code>.getWorldPosition()</code>方法可以获取一个模型的世界坐标。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// mesh设置一个父对象meshGroup</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> meshGroup</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Group</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">meshGroup</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// mesh位置受到父对象局部坐标.positionn影响</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">meshGroup</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;"> = -</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> tag</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> CSS2DObject</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">div</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> worldPosition</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 获取mesh的世界坐标(meshGroup.position和mesh.position累加结果)</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getWorldPosition</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">worldPosition</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// mesh世界坐标复制给tag</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">tag</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">copy</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">worldPosition</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> group</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Group</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 最后meshGroup和tag放在同一个父对象中即可</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">group</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">meshGroup</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">tag</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="css2模型对象作为mesh子对象" tabindex="-1"><a class="header-anchor" href="#css2模型对象作为mesh子对象"><span>CSS2模型对象作为Mesh子对象</span></a></h4><p>无论mesh有多少个父对象，CSS2模型对象作为Mesh子对象,可以直接继承mesh的世界坐标，相比通过<code>.getWorldPosition()</code>方法获取世界坐标，再设置标签模型位置<code>CSS2DObject.position</code>更方便。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// HTML元素转化为threejs的CSS2模型对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> tag</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> CSS2DObject</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">div</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//标签tag作为mesh子对象，默认受到父对象位置影响</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">tag</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="标注模型几何体的某个顶点" tabindex="-1"><a class="header-anchor" href="#标注模型几何体的某个顶点"><span>标注模型几何体的某个顶点</span></a></h4><p>标签模型对象作为需要标注mesh的子对象，然后获取mesh几何体某个顶点的坐标，作为标签模型对象局部坐标<code>.position</code>。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// HTML元素转化为threejs的CSS2模型对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> tag</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> CSS2DObject</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">div</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//标签tag作为mesh子对象，默认受到父对象位置影响</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">tag</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> pos</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">attributes</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 获取几何体顶点1的xyz坐标，设置标签局部坐标.position属性</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">tag</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">pos</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getX</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),</span><span style="color:#9CDCFE;">pos</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getY</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),</span><span style="color:#9CDCFE;">pos</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getZ</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">));</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="标签位置-标注工厂模型" tabindex="-1"><a class="header-anchor" href="#标签位置-标注工厂模型"><span>标签位置（标注工厂模型）</span></a></h3><p><strong>CSS2模型对象标注工厂设备</strong></p><p>标签tag作为obj子对象，默认标注在工厂设备obj的局部坐标系坐标原点</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">loader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;../工厂.glb&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> tag</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> CSS2DObject</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">div</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // const obj = gltf.scene.getObjectByName(&#39;设备A&#39;);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> obj</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getObjectByName</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;设备B&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    //标签tag作为obj子对象，默认标注在工厂设备obj的局部坐标系坐标原点</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    obj</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">tag</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>建模软件创建空对象(控制标签位置)</strong></p><p>除了上面调整局部坐标系方式，还有一种更灵活，更方便的标注方式，就是在你的三维建模软件中，任何你想标注的位置，创建一个<strong>空对象</strong>(空的模型对象，没有任何模型顶点数据，只是一个空对象)。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">loader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;../工厂.glb&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> tag</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> CSS2DObject</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">div</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // obj是建模软件中创建的一个空对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> obj</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getObjectByName</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;设备B标注&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // const obj = gltf.scene.getObjectByName(&#39;停车场标注&#39;);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    //tag会标注在空对象obj对应的位置</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    obj</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">tag</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>HTML标签渲染前隐藏</strong></p><p>在CSS2渲染器渲染HTML标签，重新定位标签之前，threejs执行代码和加载gltf模型也是需要时间的，这时候标签对应的HTML、CSS代码会显示在web页上面。</p><p>可以先把标签隐藏<code>display: none;</code>，等gltf模型加载完成，HTML元素转化CSS2模型对象以后，再取消HTML隐藏状态，<strong>CSS2渲染器默认会把标签设置为</strong>**<code>display: block;</code>，这样就不用自己代码恢复HTML标签元素的隐藏状态了 **。</p><div class="language-html line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-html;"><code><span class="line"><span class="line"><span style="color:#6A9955;">&lt;!-- CSS2渲染器渲染器之前，隐藏标签 --&gt;</span></span></span>
<span class="line"><span class="line"><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">div</span><span style="color:#9CDCFE;"> id</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;tag&quot;</span><span style="color:#9CDCFE;"> style</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;display: none;&quot;</span><span style="color:#808080;">&gt;</span><span style="color:#F44747;">&lt;</span><span style="color:#D4D4D4;">&gt;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="css3drenderer渲染html标签" tabindex="-1"><a class="header-anchor" href="#css3drenderer渲染html标签"><span><a href="http://www.webgl3d.cn/pages/b23f11/" title="CSS3DRenderer渲染HTML标签" target="_blank" rel="noopener noreferrer">CSS3DRenderer渲染HTML标签</a></span></a></h3><p>CSS3渲染器<code>CSS3DRenderer</code>和CSS2渲染器<code>CSS2DRenderer</code>整体使用流程基本相同，只是在HTML标签渲染效果方面不同，比如CSS3渲染的标签会跟着场景相机同步缩放，而CSS2渲染的标签默认保持自身像素值。</p><p>CSS2DRenderer渲染HTML元素标签，默认情况下，HTML元素会保持本身尺寸的像素值，除非你通过代码缩放。</p><p><strong>设置CSS3渲染器代码</strong></p><p>和CSS2渲染器代码一样设置，只需要把CSS2换成CSS3即可。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 引入CSS3渲染器CSS3DRenderer</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> {</span><span style="color:#9CDCFE;">CSS3DRenderer</span><span style="color:#D4D4D4;">} </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/renderers/CSS3DRenderer.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建一个CSS3渲染器CSS3DRenderer</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> css3Renderer</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> CSS3DRenderer</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">css3Renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setSize</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// HTML标签&lt;div id=&quot;tag&quot;&gt;&lt;/div&gt;外面父元素叠加到canvas画布上且重合</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">css3Renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">style</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;absolute&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">css3Renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">style</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">top</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;0px&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//设置.pointerEvents=none，解决HTML元素标签对threejs canvas画布鼠标事件的遮挡</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">css3Renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">style</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">pointerEvents</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;none&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">body</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">appendChild</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">css3Renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">domElement</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 渲染循环</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">function</span><span style="color:#DCDCAA;"> render</span><span style="color:#D4D4D4;">() {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    css3Renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // ...</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">    requestAnimationFrame</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">render</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">onresize</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> () {</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ...</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // HTML标签css3Renderer.domElement尺寸重新设置</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    css3Renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setSize</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">width</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">height</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">};</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>设置CSS3对象模型CSS3DObject代码</strong></p><p>也和CSS2对象模型一样</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 引入CSS3模型对象CSS3DObject</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">CSS3DObject</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/renderers/CSS3DRenderer.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> div</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getElementById</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;tag&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// HTML元素转化为threejs的CSS3模型对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> tag</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> CSS3DObject</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">div</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//标签tag作为mesh子对象，默认标注在模型局部坐标系坐标原点</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">tag</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 相对父对象局部坐标原点偏移80,刚好标注在圆锥</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">tag</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;"> += </span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>禁止</strong>**<code>CSS3DObject</code>**<strong>标签对应HTMl元素背面显示</strong></p><div class="language-html line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-html;"><code><span class="line"><span class="line"><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">div</span><span style="color:#9CDCFE;"> id</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;tag&quot;</span><span style="color:#9CDCFE;"> style</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;backface-visibility: hidden;&quot;</span><span style="color:#808080;">&gt;</span><span style="color:#D4D4D4;">标签内容</span><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">div</span><span style="color:#808080;">&gt;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="css3精灵模型css3dsprite" tabindex="-1"><a class="header-anchor" href="#css3精灵模型css3dsprite"><span>CSS3精灵模型<code>CSS3DSprite</code></span></a></h3><p>CSS3精灵模型<code>CSS3DSprite</code>对应的HTML标签，可以跟着场景缩放，位置可以跟着场景旋转，但是自身的姿态角度始终平行于canvas画布，不受旋转影响，就像精灵模型一样<code>Sprite</code></p><p>CSS3精灵模型<code>CSS3DSprite</code>尺寸、位置、缩放等渲染规律和CSS3对象模型<code>CSS3DObject</code>基本一致。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 引入CSS3精灵模型对象CSS3DSprite</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">CSS3DSprite</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/renderers/CSS3DRenderer.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> div</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getElementById</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;tag&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// HTML元素转化为threejs的CSS3精灵模型`CSS3DSprite`</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> tag</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> CSS3DSprite</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">div</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//标签tag作为mesh子对象，默认标注在模型局部坐标系坐标原点</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">tag</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 相对父对象局部坐标原点偏移80,刚好标注在圆锥</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">tag</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;"> += </span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>标签局部遮挡鼠标事件</strong></p><p>标签<code>&lt;div id=&quot;tag&quot;&gt;&lt;/div&gt;</code>在CSS3渲染器渲染的时候，默认会被设置为<code>pointer-events: auto;</code>，这时候虽然<code>css3Renderer.domElement</code>不遮挡canvas画布的鼠标事件，但是<code>&lt;div id=&quot;tag&quot;&gt;&lt;/div&gt;</code>遮挡canvas画布的鼠标事件。</p><p>这时候你可以通过代码强制改变CSS3渲染器给标签设置的<code>.style.pointerEvents = &#39;auto&#39;</code>,设置为<code>.style.pointerEvents = &#39;none&#39;</code>,这时候注意一点，修改<code>.style.pointerEvents</code>，要在实例化<code>new CSS3DObject(div)</code>之后，因为执行<code>new CSS3DObject(div)</code>的时候，会把HTML标签设置为<code>.style.pointerEvents = &#39;auto&#39;</code>。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> div</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getElementById</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;tag&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// HTML元素转化为threejs的CSS3模型对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> tag</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> CSS3DObject</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">div</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// new CSS3DObject(div);之后设置style.pointerEvents </span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">div</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">style</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">pointerEvents</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;none&#39;</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="精灵模型sprite作为标签" tabindex="-1"><a class="header-anchor" href="#精灵模型sprite作为标签"><span>精灵模型Sprite作为标签</span></a></h3><p><strong>纹理贴图精灵模型</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 引入gltf模型加载库GLTFLoader.js</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    GLTFLoader</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">} </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/loaders/GLTFLoader.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> loader</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> GLTFLoader</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//创建一个GLTF加载器</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> model</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Group</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">loader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;../工厂.glb&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    model</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> texLoader</span><span style="color:#D4D4D4;">= </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">TextureLoader</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> texture</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">texLoader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;./警告.png&quot;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> spriteMaterial</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">SpriteMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">      map:</span><span style="color:#9CDCFE;"> texture</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    });</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> sprite</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Sprite</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">spriteMaterial</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 控制精灵大小</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    sprite</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scale</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    sprite</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;"> / </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//标签底部箭头和空对象标注点重合  </span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> obj</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getObjectByName</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;设备A标注&#39;</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">// obj是建模软件中创建的一个空对象</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    obj</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">sprite</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//tag会标注在空对象obj对应的位置</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="http://www.webgl3d.cn/pages/c15dd2/" title="canvas贴图精灵模型" target="_blank" rel="noopener noreferrer"><strong>canvas贴图精灵模型</strong></a></p><p><code>canvas</code>画布作为<code>CanvasTexture</code>的参数创建一个纹理对象，本质上你可以理解为<code>CanvasTexture</code>把canvas画布当做图片，读取参数canvas画布上的像素值，创建纹理贴图<code>Texture</code>。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">loader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;../工厂.glb&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  model</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">  const</span><span style="color:#4FC1FF;"> canvas</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">createCanvas</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;设备A&#39;</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//创建一个canvas画布</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">  // canvas画布作为CanvasTexture的参数创建一个纹理对象</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">  // 本质上你可以理解为CanvasTexture读取参数canvas画布上的像素值</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">  const</span><span style="color:#4FC1FF;"> texture</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">CanvasTexture</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">canvas</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">  const</span><span style="color:#4FC1FF;"> spriteMaterial</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">SpriteMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    map:</span><span style="color:#9CDCFE;"> texture</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  });</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">  const</span><span style="color:#4FC1FF;"> sprite</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Sprite</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">spriteMaterial</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>精灵模型</strong>**<code>Sprite</code><strong><strong>和CSS3精灵模型</strong></strong><code>CSS3DSprite</code>**<strong>标签差异</strong></p><p>精灵模型渲染<code>Sprite</code>的标签，默认可以被其他网格模型<strong>遮挡</strong>，但是CSS3渲染器渲染的HTML元素标签是叠加在canvas画布上，不会被其它网格模型遮挡。</p><h2 id="十六、关键帧动画" tabindex="-1"><a class="header-anchor" href="#十六、关键帧动画"><span>十六、关键帧动画</span></a></h2><h3 id="关键帧动画" tabindex="-1"><a class="header-anchor" href="#关键帧动画"><span>关键帧动画</span></a></h3><p>1. 创建关键帧动画<code>AnimationClip</code></p><ul><li>1.1 给需要设置关键帧动画的模型命名</li><li>1.2 设置关键帧数据<code>KeyframeTrack</code></li><li>1.3 基于关键帧数据<code>KeyframeTrack</code>，创建关键帧动画<code>AnimationClip</code></li></ul><p>2.播放关键帧动画AnimationClip</p><ul><li>2.1<code>AnimationMixer</code>播放关键帧动画<code>AnimationClip</code></li><li>2.2<code>mixer.update()</code>更新播放器<code>AnimationMixer</code>时间</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BoxGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">15</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">15</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">15</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0xff0000</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 1. 第1步创建一个关键动画AnimationClip</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 1.1 给需要设置关键帧动画的模型命名</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&quot;Box&quot;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 1.2 给名为Box的模型对象的设置关键帧数据KeyframeTrack</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> times</span><span style="color:#D4D4D4;"> = [</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;">]; </span><span style="color:#6A9955;">//时间轴上，设置三个时刻0、3、6秒</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// times中三个不同时间点，物体分别对应values中的三个xyz坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> values</span><span style="color:#D4D4D4;"> = [</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">];</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建关键帧，把模型位置和时间对应起来</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 0~3秒，物体从(0,0,0)逐渐移动到(100,0,0),3~6秒逐渐从(100,0,0)移动到(0,0,100)</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> posKF</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">KeyframeTrack</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;Box.position&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">times</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">values</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 时间轴上选择两个时刻2秒、5秒，分别对应物体两个颜色值(1, 0, 0)、(0, 0, 1)</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 从2秒到5秒，物体从红色逐渐变化为蓝色</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> colorKF</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">KeyframeTrack</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;Box.material.color&#39;</span><span style="color:#D4D4D4;">, [</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">], [</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 上面是在时间轴上，随机编辑了两个关键帧posKF、colorKF，你可以根据需要随意改变场景中物体位置、颜色、角度等属性</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 1.3 AnimationClip表示一个关键帧动画，可以基于关键帧数据产生动画效果</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建一个clip关键帧动画对象，命名&quot;test&quot;，动画持续时间6s</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// AnimationClip包含的所有关键帧数据都放到参数3数组中即可</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> clip</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">AnimationClip</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;test&quot;</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;">,[</span><span style="color:#9CDCFE;">posKF</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">colorKF</span><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 2. 第2步播放关键帧动画AnimationClip</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//2.1 动画播放器AnimationMixer播放关键帧动画AnimationClip</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//包含关键帧动画的模型对象作为AnimationMixer的参数创建一个播放器mixer</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mixer</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">AnimationMixer</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//AnimationMixer的`.clipAction()`返回一个AnimationAction对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> clipAction</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">mixer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">clipAction</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">clip</span><span style="color:#D4D4D4;">); </span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//.play()控制动画播放，默认循环播放</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">play</span><span style="color:#D4D4D4;">(); </span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 2.2 如果想播放动画开始变化,需要周期性执行`mixer.update()`更新AnimationMixer时间数据</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 你可以通过requestAnimationFrame提供一个周期性执行的函数</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> clock</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Clock</span><span style="color:#D4D4D4;">();</span><span style="color:#6A9955;">//辅助获取时间数据</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">function</span><span style="color:#DCDCAA;"> loop</span><span style="color:#D4D4D4;">() {</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">    requestAnimationFrame</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">loop</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    //clock.getDelta()方法获得loop()两次执行时间间隔</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> frameT</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">clock</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getDelta</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 更新播放器相关的时间</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    mixer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">update</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">frameT</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">loop</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="动画播放-暂停、倍速、循环" tabindex="-1"><a class="header-anchor" href="#动画播放-暂停、倍速、循环"><span>动画播放(暂停、倍速、循环)</span></a></h3><h4 id="循环-loop" tabindex="-1"><a class="header-anchor" href="#循环-loop"><span><strong>循环</strong><code>.loop</code></span></a></h4><p>通过<code>AnimationAction</code>的循环属性<code>.loop</code>可以控制动画是否循环播放。</p><ul><li><a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/constants/Animation" title="THREE.LoopOnce" target="_blank" rel="noopener noreferrer">THREE.LoopOnce</a>- 只执行一次</li><li><a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/constants/Animation" title="THREE.LoopRepeat" target="_blank" rel="noopener noreferrer">THREE.LoopRepeat</a>- 重复次数为<strong>repetitions</strong>的值, 且每次循环结束时候将回到起始动作开始下一次循环。</li><li><a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/constants/Animation" title="THREE.LoopPingPong" target="_blank" rel="noopener noreferrer">THREE.LoopPingPong</a>- 重复次数为<strong>repetitions</strong>的值, 且像乒乓球一样在起始点与结束点之间来回循环。</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> clipAction</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">mixer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">clipAction</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">clip</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//.play()控制动画播放，默认循环播放</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">play</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//不循环播放</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">loop</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">LoopOnce</span><span style="color:#D4D4D4;">; </span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 物体状态停留在动画结束的时候</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">clampWhenFinished</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你通过<code>clipAction.loop = THREE.LoopOnce</code>设置播放模式为非循环模式的时候，你会发现关键帧动画执行完成一个后，模型回到了关键帧动画开头状态，如果你希望模型停留在关键帧动画结束的状态，可以设置<code>.clampWhenFinished</code>属性实现，<code>.clampWhenFinished</code>属性默认是<code>false</code>，设置为<code>true</code>即可</p><h4 id="停止-stop" tabindex="-1"><a class="header-anchor" href="#停止-stop"><span>停止<code>.stop()</code></span></a></h4><p>执行AnimationAction的<code>.stop()</code>方法，动画会停止，并结束，模型回到动画开始状态,注意不是暂停，是动画彻底终止，回到初始状态。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//动画停止结束，回到开始状态</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">stop</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="暂停播放-paused" tabindex="-1"><a class="header-anchor" href="#暂停播放-paused"><span>暂停播放<code>.paused</code></span></a></h4><p><code>.paused</code>默认值false，动画正常执行，如果你想暂停正在执行的动画可以把<code>.paused</code>设置为true，对于暂停执行的动画，你把<code>.paused</code>设置为false，动画会接着暂停的位置继续执行。</p><div class="language-html line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-html;"><code><span class="line"><span class="line"><span style="color:#808080;">&lt;</span><span style="color:#F44747;">divid=&quot;bu&quot;class=&quot;bu&quot;</span><span style="color:#808080;">&gt;</span><span style="color:#D4D4D4;">暂停</span><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">div</span><span style="color:#808080;">&gt;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> bu</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getElementById</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;bu&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">bu</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addEventListener</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;click&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">(){</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // AnimationAction.paused默认值false，设置为true，可以临时暂停动画</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">    if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">paused</span><span style="color:#D4D4D4;">) {</span><span style="color:#6A9955;">//暂停状态</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">paused</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//切换为播放状态</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        bu</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">innerHTML</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;暂停&#39;</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">// 如果改变为播放状态，按钮文字设置为“暂停”</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">      } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span><span style="color:#6A9955;">//播放状态</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">paused</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//切换为暂停状态</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        bu</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">innerHTML</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;继续&#39;</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">// 如果改变为暂停状态，按钮文字设置为“继续”</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="倍速播放-timescale" tabindex="-1"><a class="header-anchor" href="#倍速播放-timescale"><span>倍速播放<code>.timeScale</code></span></a></h4><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">timeScale</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//默认</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">timeScale</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//2倍速</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="拖动条调整播放速度" tabindex="-1"><a class="header-anchor" href="#拖动条调整播放速度"><span>拖动条调整播放速度</span></a></h4><p>gui辅助快速创建一个可交互拖动条，实际开发，可以用vue或react创建的拖动条。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> gui</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> GUI</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//创建GUI对象</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 0~6倍速之间调节</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">gui</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;timeScale&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="动画播放-拖动任意时间状态" tabindex="-1"><a class="header-anchor" href="#动画播放-拖动任意时间状态"><span>动画播放（拖动任意时间状态）</span></a></h3><h4 id="控制动画播放特定时间段" tabindex="-1"><a class="header-anchor" href="#控制动画播放特定时间段"><span>控制动画播放特定时间段</span></a></h4><p>从时间轴上选择时间段播放动画，开始时刻<code>AnimationAction.time</code>，结束时刻<code>AnimationClip.duration</code>。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 给名为Box的模型对象设置关键帧动画AnimationClip</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&quot;Box&quot;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> times</span><span style="color:#D4D4D4;"> = [</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;">];</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> values</span><span style="color:#D4D4D4;"> = [</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">];</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> posKF</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">KeyframeTrack</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;Box.position&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">times</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">values</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> colorKF</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">KeyframeTrack</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;Box.material.color&#39;</span><span style="color:#D4D4D4;">, [</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">], [</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> clip</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">AnimationClip</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;test&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;">, [</span><span style="color:#9CDCFE;">posKF</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">colorKF</span><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// console.log(&#39;clip.duration&#39;,clip.duration);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 播放器AnimationMixer播放动画AnimationClip</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mixer</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">AnimationMixer</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//AnimationMixer的`.clipAction()`返回一个AnimationAction对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> clipAction</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">mixer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">clipAction</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">clip</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//.play()控制动画播放，默认循环播放</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">play</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// AnimationAction对象用来控制播放规则</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">loop</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">LoopOnce</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//不循环播放</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 物体状态停留在动画结束的时候</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">clampWhenFinished</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 从时间轴上选择时间段播放动画，开始时刻`clipAction.time`，结束时刻`clip.duration`。</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">time</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//AnimationAction设置开始播放时间：从1秒时刻对应动画开始播放</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">clip</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">duration</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//AnimationClip设置播放结束时间：到5秒时刻对应的动画状态停止</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意<code>.loop</code>和<code>.clampWhenFinished</code>对播放效果的影响,如果需要上面代码完全起作用，要设置非循环模式，同时动画播放完，物体停留在结束状态，而不是回到开始状态。</p><h4 id="查看时间轴上任意时间动画状态" tabindex="-1"><a class="header-anchor" href="#查看时间轴上任意时间动画状态"><span>查看时间轴上任意时间动画状态</span></a></h4><p>把动画设置为暂停状态，然后你可以通过<code>AnimationAction.time</code>把动画定格在时间轴上任何位置。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//在暂停情况下，设置.time属性,把动画定位在任意时刻</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">paused</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">time</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//物体状态为动画1秒对应状态</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">time</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//物体状态为动画3秒对应状态</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="拖动条拖动显示动画任意时刻模型状态" tabindex="-1"><a class="header-anchor" href="#拖动条拖动显示动画任意时刻模型状态"><span>拖动条拖动显示动画任意时刻模型状态</span></a></h4><p>默认是播放的，可以预先暂停，再通过拖动条控制。</p><div class="language-typescript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-typescript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//在暂停情况下，设置.time属性,把动画定位在任意时刻</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">paused</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>gui辅助快速创建一个可交互拖动条，调整模型停留在任何选定时间点状态。实际开发时候，你可以通过vue或react的UI组件库实现拖动条。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> {</span><span style="color:#9CDCFE;">GUI</span><span style="color:#D4D4D4;">} </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/libs/lil-gui.module.min.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> gui</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> GUI</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//创建GUI对象</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">gui</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;time&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">step</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0.1</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="解析外部模型关键帧动画" tabindex="-1"><a class="header-anchor" href="#解析外部模型关键帧动画"><span>解析外部模型关键帧动画</span></a></h3><p>加载gltf模型，如果存在帧动画数据的话，可以通过加载返回gltf对象的动画属性.animations获取。</p><p><code>gltf.animations</code>是一个数组，如果没有帧动画数据，就是一个空数组，有帧动画数据的情况下，里面可能1个或多个Clip动画对象<code>AnimationClip</code>。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">let</span><span style="color:#9CDCFE;"> mixer</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//声明一个播放器变量</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">loader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;../工厂.glb&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">) { </span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    model</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">     //包含帧动画的模型作为参数创建一个播放器</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">     mixer</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">AnimationMixer</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    //  获取gltf.animations[0]的第一个clip动画对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">     const</span><span style="color:#4FC1FF;"> clipAction</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">mixer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">clipAction</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">gltf</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">animations</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">]);</span><span style="color:#6A9955;">//创建动画clipAction对象</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">     clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">play</span><span style="color:#D4D4D4;">();</span><span style="color:#6A9955;">//播放动画</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;"> // 创建一个时钟对象Clock</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;"> const</span><span style="color:#4FC1FF;"> clock</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Clock</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;"> function</span><span style="color:#DCDCAA;"> render</span><span style="color:#D4D4D4;">() {</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">     requestAnimationFrame</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">render</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">     if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">mixer</span><span style="color:#D4D4D4;"> !== </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">         //clock.getDelta()方法获得两帧的时间间隔</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">         // 更新播放器相关的时间</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">         mixer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">update</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">clock</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getDelta</span><span style="color:#D4D4D4;">());</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">     }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;"> }</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;"> render</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="变形动画" tabindex="-1"><a class="header-anchor" href="#变形动画"><span>变形动画</span></a></h3><ol><li><p>为geometry提供变形目标的顶点数据</p></li><li><p><code>.morphAttributes</code>设置几何体变形目标顶点数据</p><p>注意：给一个几何体geometry设置顶点变形数据<code>.morphAttributes</code>时候要注意，在执行代码<code>new THREE.Mesh()</code>之前设置，否则报错。</p></li><li><p><code>.morphTargetInfluences</code>权重系数控制变形程度 设置为关键帧</p><ul><li>设置变形目标影响权重，范围一般0~1。</li><li>mesh在geometry原始形状和变形目标1顶点对应形状之间变化。</li><li>一个网格模型的几何体geometry可以有多个变形目标，只要对应权重不为0，每个变形目标的形状都会影响模型的形状。</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//权重0：物体形状对应geometry.attributes.position表示形状</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">morphTargetInfluences</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">] = </span><span style="color:#B5CEA8;">0.0</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//权重1：物体形状对应target1表示形状</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">morphTargetInfluences</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">] = </span><span style="color:#B5CEA8;">1.0</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//权重0.5：物体形状对应geometry和target1变形中间状态</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">morphTargetInfluences</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">] = </span><span style="color:#B5CEA8;">0.5</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>生成变形动画</p></li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//几何体两组顶点一一对应，位置不同，然后通过权重系数，可以控制模型形状在两组顶点之间变化</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> geometry</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BoxGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 为geometry提供变形目标的顶点数据(注意和原始geometry顶点数量一致)</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> target1</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BoxGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">200</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">).</span><span style="color:#9CDCFE;">attributes</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//变高</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> target2</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">BoxGeometry</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">).</span><span style="color:#9CDCFE;">attributes</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//变细</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 几何体顶点变形目标数据，可以设置1组或多组</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">morphAttributes</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;"> = [</span><span style="color:#9CDCFE;">target1</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">target2</span><span style="color:#D4D4D4;">];</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> material</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MeshLambertMaterial</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    color:</span><span style="color:#B5CEA8;"> 0x00ffff</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">});</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mesh</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Mesh</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">geometry</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建变形动画权重系数的关键帧数据</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&quot;Box&quot;</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//关键帧动画控制的模型对象命名</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置变形目标1对应权重随着时间的变化</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> KF1</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">KeyframeTrack</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;Box.morphTargetInfluences[0]&#39;</span><span style="color:#D4D4D4;">, [</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">], [</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置变形目标2对应权重随着时间的变化</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> KF2</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">KeyframeTrack</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;Box.morphTargetInfluences[1]&#39;</span><span style="color:#D4D4D4;">, [</span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">], [</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 创建一个剪辑clip对象</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> clip</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">AnimationClip</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;t&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, [</span><span style="color:#4FC1FF;">KF1</span><span style="color:#D4D4D4;">, </span><span style="color:#4FC1FF;">KF2</span><span style="color:#D4D4D4;">]);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 播放变形动画</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> mixer</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">AnimationMixer</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> clipAction</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">mixer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">clipAction</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">clip</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">play</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">loop</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">LoopOnce</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//不循环播放</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">clipAction</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">clampWhenFinished</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">true</span><span style="color:#6A9955;"> // 物体状态停留在动画结束的时候</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> clock</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Clock</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">function</span><span style="color:#DCDCAA;"> loop</span><span style="color:#D4D4D4;">() {</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">    requestAnimationFrame</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">loop</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> frameT</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">clock</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getDelta</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 更新播放器时间</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    mixer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">update</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">frameT</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">loop</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="骨骼关节bone" tabindex="-1"><a class="header-anchor" href="#骨骼关节bone"><span>骨骼关节Bone</span></a></h3><p>骨骼关节<code>Bone</code>是threejs的一个类，父类是Object3D，你可以类似人或动物的骨骼关节，来理解骨骼关节<code>Bone</code>对象。</p><p>骨骼关节<code>Bone</code>的作用就是模拟人或动物的关节运动，控制身体表面变形，来生成骨骼动画(可以查看下节课的案例)。</p><p><strong>骨骼关节Bone树结构</strong></p><p>人或动物实际的骨骼关节结构往往是比较复杂的，一般可以用一个层级树结构表达。</p><p>你可以把骨骼关节当做一个模型对象Object3D，构建一个简单的层级模型。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> Bone1</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Bone</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//关节1，用来作为根关节</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> Bone2</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Bone</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//关节2</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> Bone3</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Bone</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">//关节3</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 设置关节父子关系   多个骨头关节构成一个树结构</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">Bone1</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">Bone2</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">Bone2</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">Bone3</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>设置关节模型的位置和姿态角度</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//根关节Bone1默认位置是(0,0,0)</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">Bone2</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//Bone2相对父对象Bone1位置</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">Bone3</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">30</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//Bone3相对父对象Bone2位置</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//平移Bone1，Bone2、Bone3跟着平移</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">Bone1</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 骨骼关节旋转</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">Bone1</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">rotateX</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;"> / </span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">Bone2</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">rotateX</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;"> / </span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**<code>SkeletonHelper</code>**<strong>可视化骨骼关节</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 骨骼关节可以和普通网格模型一样作为其他模型子对象，添加到场景中</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> group</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Group</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">group</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">Bone1</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// SkeletonHelper会可视化参数模型对象所包含的所有骨骼关节</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> skeletonHelper</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">SkeletonHelper</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">group</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">group</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">skeletonHelper</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意SkeletonHelper的可视化效果，SkeletonHelper几个线段并不表示Bone，每个Bone你可以理解为一个虚拟关节点，SkeletonHelper几个线段是每个虚拟Bone关节点连线。</p><p><strong>拖动条控制骨骼关节旋转</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> {</span><span style="color:#9CDCFE;">GUI</span><span style="color:#D4D4D4;">} </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &#39;three/addons/libs/lil-gui.module.min.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> gui</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> GUI</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">gui</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">Bone1</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">rotation</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;x&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;"> / </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">name</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;关节1&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">gui</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">Bone2</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">rotation</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;x&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;"> / </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">name</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;关节2&#39;</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查看外部模型骨骼动画" tabindex="-1"><a class="header-anchor" href="#查看外部模型骨骼动画"><span><a href="http://www.webgl3d.cn/pages/56644a/" title="查看外部模型骨骼动画" target="_blank" rel="noopener noreferrer"><strong>查看外部模型骨骼动画</strong></a></span></a></h3><h3 id="骨骼动画不同动作切换" tabindex="-1"><a class="header-anchor" href="#骨骼动画不同动作切换"><span><a href="http://www.webgl3d.cn/pages/f5175e/" title="骨骼动画不同动作切换" target="_blank" rel="noopener noreferrer">骨骼动画不同动作切换</a></span></a></h3><h2 id="十七、动画库tween-js" tabindex="-1"><a class="header-anchor" href="#十七、动画库tween-js"><span>十七、动画库tween.js</span></a></h2><h3 id="tweenjs创建threejs动画" tabindex="-1"><a class="header-anchor" href="#tweenjs创建threejs动画"><span>tweenjs创建threejs动画</span></a></h3><p>TweenJS是一个由JavaScript语言编写的补间动画库，如果需要tweenjs辅助你生成动画，对于任何前端web项目，你都可以选择tweenjs库。</p><p><strong>安装与引用</strong></p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-bash;"><code><span class="line"><span class="line"><span style="color:#DCDCAA;">npm</span><span style="color:#CE9178;"> i</span><span style="color:#CE9178;"> @tweenjs/tween.js@^18</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#9CDCFE;"> TWEEN</span><span style="color:#C586C0;"> from</span><span style="color:#CE9178;"> &#39;@tweenjs/tween.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>tweenjs改变threejs模型对象位置</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//创建一段mesh平移的动画</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 写法一：</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> tween</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> TWEEN</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Tween</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//经过2000毫秒，pos对象的x和y属性分别从零变化为100、50</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">tween</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">to</span><span style="color:#D4D4D4;">({</span><span style="color:#9CDCFE;">x:</span><span style="color:#B5CEA8;"> 100</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">y:</span><span style="color:#B5CEA8;"> 50</span><span style="color:#D4D4D4;">}, </span><span style="color:#B5CEA8;">2000</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">//tween动画开始执行</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">tween</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">start</span><span style="color:#D4D4D4;">(); </span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 写法二：</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> tween</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> TWEEN</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Tween</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">mesh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">to</span><span style="color:#D4D4D4;">({</span><span style="color:#9CDCFE;">x:</span><span style="color:#B5CEA8;"> 100</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">y:</span><span style="color:#B5CEA8;"> 50</span><span style="color:#D4D4D4;">}, </span><span style="color:#B5CEA8;">2000</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">start</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 渲染循环</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">function</span><span style="color:#DCDCAA;"> render</span><span style="color:#D4D4D4;">() {</span></span></span>
<span class="line"><span class="line"><span style="color:#4FC1FF;">    TWEEN</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">update</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">    requestAnimationFrame</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">render</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="tweenjs相机运动动画" tabindex="-1"><a class="header-anchor" href="#tweenjs相机运动动画"><span><strong>tweenjs相机运动动画</strong></span></a></h3><p><strong>相机飞行动画：从一个点飞到另一个点</strong></p><p>只改变相机位置，相机默认视线方向保持不变，如果你想重新计算相机视线方向，可以在相机位置改变的过程中不停地执行<code>lookAt()</code>即可。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#9CDCFE;"> TWEEN</span><span style="color:#C586C0;"> from</span><span style="color:#CE9178;"> &#39;@tweenjs/tween.js&#39;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">...</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">202</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">123</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">125</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lookAt</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> TWEEN</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Tween</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">to</span><span style="color:#D4D4D4;">({</span><span style="color:#9CDCFE;">x:</span><span style="color:#B5CEA8;"> 202</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">y:</span><span style="color:#B5CEA8;"> 123</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">z:</span><span style="color:#D4D4D4;"> -</span><span style="color:#B5CEA8;">350</span><span style="color:#D4D4D4;">}, </span><span style="color:#B5CEA8;">3000</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// tweenjs改变参数对象的过程中，.onUpdate方法会被重复调用执行</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">onUpdate</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">(){</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    camera</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lookAt</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">start</span><span style="color:#D4D4D4;">()</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 渲染循环</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">function</span><span style="color:#DCDCAA;"> render</span><span style="color:#D4D4D4;">() {</span></span></span>
<span class="line"><span class="line"><span style="color:#4FC1FF;">    TWEEN</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">update</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    renderer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">scene</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">    requestAnimationFrame</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">render</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">render</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Tweenjs回调函数</strong></p><p>twwenjs库提供了<code>onStart</code>、<code>onUpdate</code>、<code>onComplete</code>等用于控制动画执行的回调函数。</p><ul><li><code>onStart</code>：动画开始执行触发</li><li><code>onUpdate</code>：动画执行过程中，一直被调用执行</li><li><code>onComplete</code>：动画正常执行完触发</li></ul><p><code>.onUpdate(function(obj){})</code>结构中，obj对应的是<code>new TWEEN.Tween(pos)</code>的参数对象pos。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> tween</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> TWEEN</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Tween</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">pos</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">to</span><span style="color:#D4D4D4;">({</span><span style="color:#9CDCFE;">x:</span><span style="color:#B5CEA8;"> 0</span><span style="color:#D4D4D4;">}, </span><span style="color:#B5CEA8;">4000</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 开始执行：动画片段tween开始执行的时候触发onStart</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">onStart</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">){</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  ...</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>相机圆周运动，且保持相机镜头对准坐标原点</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> R</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">//相机圆周运动的半径</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> TWEEN</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Tween</span><span style="color:#D4D4D4;">({</span><span style="color:#9CDCFE;">angle:</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">})</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">to</span><span style="color:#D4D4D4;">({</span><span style="color:#9CDCFE;">angle:</span><span style="color:#9CDCFE;"> Math</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">PI</span><span style="color:#D4D4D4;">*</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">}, </span><span style="color:#B5CEA8;">16000</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">onUpdate</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">){</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">R</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">cos</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">angle</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">z</span><span style="color:#D4D4D4;"> = </span><span style="color:#4FC1FF;">R</span><span style="color:#D4D4D4;"> * </span><span style="color:#9CDCFE;">Math</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">sin</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">angle</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    camera</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lookAt</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">start</span><span style="color:#D4D4D4;">()</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="点按钮-相机飞行靠近观察设备" tabindex="-1"><a class="header-anchor" href="#点按钮-相机飞行靠近观察设备"><span>点按钮,相机飞行靠近观察设备</span></a></h3><p>实际开发的的时候，一个较大的三维场景，有很多不同的设备或物品，你可能希望通过UI按钮点击切换到不同视角，观察某个区域，或者说放大观察某个特定的物品或设备。</p><div class="language-html line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-html;"><code><span class="line"><span class="line"><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">div</span><span style="color:#9CDCFE;"> class</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;pos&quot;</span><span style="color:#808080;">&gt;</span></span></span>
<span class="line"><span class="line"><span style="color:#808080;">    &lt;</span><span style="color:#569CD6;">div</span><span style="color:#9CDCFE;"> id</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;A&quot;</span><span style="color:#9CDCFE;"> class</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;bu&quot;</span><span style="color:#808080;">&gt;</span><span style="color:#D4D4D4;">设备A</span><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">div</span><span style="color:#808080;">&gt;</span></span></span>
<span class="line"><span class="line"><span style="color:#808080;">    &lt;</span><span style="color:#569CD6;">div</span><span style="color:#9CDCFE;"> id</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;B&quot;</span><span style="color:#9CDCFE;"> class</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;bu&quot;</span><span style="color:#9CDCFE;"> style</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;margin-left: 10px;&quot;</span><span style="color:#808080;">&gt;</span><span style="color:#D4D4D4;">设备B</span><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">div</span><span style="color:#808080;">&gt;</span></span></span>
<span class="line"><span class="line"><span style="color:#808080;">    &lt;</span><span style="color:#569CD6;">div</span><span style="color:#9CDCFE;"> id</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;car&quot;</span><span style="color:#9CDCFE;"> class</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;bu&quot;</span><span style="color:#9CDCFE;"> style</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;margin-left: 10px;&quot;</span><span style="color:#808080;">&gt;</span><span style="color:#D4D4D4;">停车场</span><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">div</span><span style="color:#808080;">&gt;</span></span></span>
<span class="line"><span class="line"><span style="color:#808080;">    &lt;</span><span style="color:#569CD6;">div</span><span style="color:#9CDCFE;"> id</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;all&quot;</span><span style="color:#9CDCFE;"> class</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;bu&quot;</span><span style="color:#9CDCFE;"> style</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;margin-left: 10px;&quot;</span><span style="color:#808080;">&gt;</span><span style="color:#D4D4D4;">整体</span><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">div</span><span style="color:#808080;">&gt;</span></span></span>
<span class="line"><span class="line"><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">div</span><span style="color:#808080;">&gt;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 切换到设备A预览状态</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getElementById</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;A&#39;</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">addEventListener</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;click&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> () {</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> A</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">model</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getObjectByName</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;设备A标注&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> pos</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> THREE</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Vector3</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#4FC1FF;">    A</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getWorldPosition</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">pos</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">//获取三维场景中某个对象世界坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 相机飞行到的位置和观察目标拉开一定的距离</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> pos2</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">pos</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">clone</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">addScalar</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">30</span><span style="color:#D4D4D4;">);</span><span style="color:#6A9955;">//向量的x、y、z坐标分别在pos基础上增加30</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 相机从当前位置camera.position飞行三维场景中某个世界坐标附近</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#4FC1FF;"> TWEEN</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Tween</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // 相机开始坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            x:</span><span style="color:#9CDCFE;"> camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            y:</span><span style="color:#9CDCFE;"> camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            z:</span><span style="color:#9CDCFE;"> camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">z</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // 相机开始指向的目标观察点</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            tx:</span><span style="color:#B5CEA8;"> 0</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            ty:</span><span style="color:#B5CEA8;"> 0</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            tz:</span><span style="color:#B5CEA8;"> 0</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        })</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        .</span><span style="color:#DCDCAA;">to</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // 相机结束坐标</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            x:</span><span style="color:#9CDCFE;"> pos2</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            y:</span><span style="color:#9CDCFE;"> pos2</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            z:</span><span style="color:#9CDCFE;"> pos2</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">z</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // 相机结束指向的目标观察点</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            tx:</span><span style="color:#9CDCFE;"> pos</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            ty:</span><span style="color:#9CDCFE;"> pos</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            tz:</span><span style="color:#9CDCFE;"> pos</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">z</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        }, </span><span style="color:#B5CEA8;">2000</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        .</span><span style="color:#DCDCAA;">onUpdate</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // 动态改变相机位置</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">x</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">y</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">z</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // 动态计算相机视线</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            camera</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lookAt</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">tx</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">ty</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">tz</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        })</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        .</span><span style="color:#DCDCAA;">start</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>考虑OrbitControls的影响</strong></p><p>如果你在项目中使用了相机控件<code>OrbitControls</code>，希望相机<code>looAt()</code>指向的目标改变以后，该相机控件让然可以正常使用。需要在动画结束<code>.onComplete()</code>的时候重新设置<code>controls.target</code>，或者<code>.onUpdate()</code>更新<code>controls.target</code>。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">onUpdate</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ...</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    camera</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lookAt</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">tx</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">ty</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">tz</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">onComplete</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">){</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    controls</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">target</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">tx</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">ty</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">tz</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    controls</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">update</span><span style="color:#D4D4D4;">();</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="缓动算法-easing-地球渐入相机动画" tabindex="-1"><a class="header-anchor" href="#缓动算法-easing-地球渐入相机动画"><span>缓动算法.easing(地球渐入相机动画)</span></a></h3><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// easing函数：缓动算法(运动效果)</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// easing类型：定义缓动算法起作用地方</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">tween</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">easing</span><span style="color:#D4D4D4;">(</span><span style="color:#4FC1FF;">TWEEN</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">Easing</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">easing函数</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">easing类型</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 动画开始缓动方式(类比加速启动)</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">tween</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">easing</span><span style="color:#D4D4D4;">(</span><span style="color:#4FC1FF;">TWEEN</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">Easing</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">Sinusoidal</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">In</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 动画结束缓动方式(类比减速刹车)</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">tween</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">easing</span><span style="color:#D4D4D4;">(</span><span style="color:#4FC1FF;">TWEEN</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">Easing</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">Sinusoidal</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">Out</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 同时设置In和Out</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">tween</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">easing</span><span style="color:#D4D4D4;">(</span><span style="color:#4FC1FF;">TWEEN</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">Easing</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">Sinusoidal</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">InOut</span><span style="color:#D4D4D4;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>动画效果：地球从小到大出现</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">set</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">3000</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3000</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3000</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lookAt</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 视觉效果：地球从小到大出现(透视投影相机远小近大投影规律)</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> TWEEN</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Tween</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">camera</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">position</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">to</span><span style="color:#D4D4D4;">({</span><span style="color:#9CDCFE;">x:</span><span style="color:#B5CEA8;"> 300</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">y:</span><span style="color:#B5CEA8;"> 300</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">z:</span><span style="color:#B5CEA8;"> 300</span><span style="color:#D4D4D4;">}, </span><span style="color:#B5CEA8;">3000</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">start</span><span style="color:#D4D4D4;">()</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">easing</span><span style="color:#D4D4D4;">(</span><span style="color:#4FC1FF;">TWEEN</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">Easing</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">Sinusoidal</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">InOut</span><span style="color:#D4D4D4;">)</span><span style="color:#6A9955;">//进入和结束都设置缓动</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="淡入淡出" tabindex="-1"><a class="header-anchor" href="#淡入淡出"><span>淡入淡出</span></a></h3><p><strong>淡入</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 模型淡入</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">transparent</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//开启透明计算</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">opacity</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0.0</span><span style="color:#D4D4D4;">;</span><span style="color:#6A9955;">//完全透明</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// new TWEEN.Tween(material)</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> TWEEN</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Tween</span><span style="color:#D4D4D4;">({</span><span style="color:#9CDCFE;">opacity:material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">opacity</span><span style="color:#D4D4D4;">})</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">to</span><span style="color:#D4D4D4;">({</span><span style="color:#9CDCFE;">opacity:</span><span style="color:#B5CEA8;">1.0</span><span style="color:#D4D4D4;">}, </span><span style="color:#B5CEA8;">3000</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">onUpdate</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">){</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">opacity</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">opacity</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">onComplete</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">(){</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    //动画结束：关闭允许透明，恢复到模型原来状态</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">transparent</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">start</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>淡出</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 模型淡出</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// new TWEEN.Tween(material)</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> TWEEN</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Tween</span><span style="color:#D4D4D4;">({</span><span style="color:#9CDCFE;">opacity:material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">opacity</span><span style="color:#D4D4D4;">})</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">to</span><span style="color:#D4D4D4;">({</span><span style="color:#9CDCFE;">opacity:</span><span style="color:#B5CEA8;">0.0</span><span style="color:#D4D4D4;">}, </span><span style="color:#B5CEA8;">3000</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">onStart</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">(){</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    //动画开始：允许透明opacity属性才能生效</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">transparent</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">onUpdate</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">){</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    material</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">opacity</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">obj</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">opacity</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">start</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="循环触发" tabindex="-1"><a class="header-anchor" href="#循环触发"><span>循环触发</span></a></h3><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> tween</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#4FC1FF;"> TWEEN</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Tween</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">object</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  .</span><span style="color:#DCDCAA;">to</span><span style="color:#D4D4D4;">({ </span><span style="color:#9CDCFE;">x:</span><span style="color:#B5CEA8;"> 100</span><span style="color:#D4D4D4;"> }, </span><span style="color:#B5CEA8;">1000</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  .</span><span style="color:#DCDCAA;">onRepeat</span><span style="color:#D4D4D4;">(() </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;一次循环完成，触发执行&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  })</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  .</span><span style="color:#DCDCAA;">onComplete</span><span style="color:#D4D4D4;">(() </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;整个动画最终循环完成触发&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  })</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  .</span><span style="color:#DCDCAA;">repeat</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">800</span><span style="color:#D4D4D4;">) </span><span style="color:#6A9955;">// 循环次数</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  .</span><span style="color:#DCDCAA;">start</span><span style="color:#D4D4D4;">();</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最近更新: </span><time class="meta-item-info" datetime="2025-04-04T06:05:07.000Z" data-allow-mismatch>2025/4/4 06:05</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 980715844@qq.com">csmSimona</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-5eYbtFQ0.js" defer></script>
  </body>
</html>
