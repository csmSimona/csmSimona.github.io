import{_ as n,c as a,a as l,o as e}from"./app-BxCCnlYD.js";const p="/assets/webpack-BJ48ndWK.png",i={};function c(r,s){return e(),a("div",null,s[0]||(s[0]=[l('<h1 id="前端工程化" tabindex="-1"><a class="header-anchor" href="#前端工程化"><span>前端工程化</span></a></h1><p><strong>前端为什么要进行打包构建</strong></p><ul><li>体积更小（tree-shaking、压缩、合并），加载更快</li><li>编译高级语言或语法（TS、ES5+、模块化、scss）</li><li>兼容性和错误提示（polyfill、postcss、eslint）</li><li>统一高效的开发环境</li><li>统一的构建流程和产出标准</li><li>集成公司构建规范（提测、上线等）</li></ul><h2 id="一、webpack" tabindex="-1"><a class="header-anchor" href="#一、webpack"><span>一、Webpack</span></a></h2><h3 id="基础" tabindex="-1"><a class="header-anchor" href="#基础"><span>基础</span></a></h3><h4 id="概念" tabindex="-1"><a class="header-anchor" href="#概念"><span>概念</span></a></h4><h5 id="什么是webpack" tabindex="-1"><a class="header-anchor" href="#什么是webpack"><span>什么是webpack</span></a></h5><p>本质上，<em>webpack</em> 是一个现代 JavaScript 应用程序的<strong>静态模块打包器(module bundler)</strong>。它做的事情是，分析你的项目结构，找到JavaScript模块以及其它的一些浏览器不能直接运行的拓展语言（Scss，TypeScript等），并将其转换和打包为合适的格式供浏览器使用。</p><p>webpack可以将工程中的静态资源根据我们声明的依赖关系，打包出最后的正常运行的输出文件。官网显示的这幅图很形象地描述了这个过程：</p><p><img src="'+p+`" alt="webpack"></p><p>在webpack中，所有的静态资源都可以被处理为一个模块，包括js、图片、css、字体。</p><h5 id="模块化的好处" tabindex="-1"><a class="header-anchor" href="#模块化的好处"><span>模块化的好处</span></a></h5><ul><li>更轻松地拆分代码逻辑，对于大型工程尤其重要</li><li>更容易地去管理变量，模块会自动生成一个局部变量环境，减少全局变量的污染</li><li>显式地声明依赖关系，想想之前在head中引入很多script标签，由于script顺序错误而引起的bug</li></ul><h5 id="webpack和grunt以及gulp相比有什么特性" tabindex="-1"><a class="header-anchor" href="#webpack和grunt以及gulp相比有什么特性"><span>Webpack和Grunt以及Gulp相比有什么特性</span></a></h5><p>其实Webpack和另外两个并没有太多的可比性，Gulp/Grunt是一种能够优化前端的开发流程的工具，而WebPack是一种模块化的解决方案，不过Webpack的优点使得Webpack在很多场景下可以替代Gulp/Grunt类的工具。</p><p><strong>Grunt和Gulp的工作方式是：在一个配置文件中，指明对某些文件进行类似编译，组合，压缩等任务的具体步骤，工具之后可以自动替你完成这些任务</strong>。</p><h4 id="入口-entry" tabindex="-1"><a class="header-anchor" href="#入口-entry"><span>入口(entry)</span></a></h4><p>入口是指依赖关系图的开始，从入口开始寻找依赖，打包构建。</p><p>webpack 允许一个或多个入口配置。</p><ul><li><p>工程的入口文件配置，在这里的js文件以及在里面被引用的文件会被webpack找到打包。</p></li><li><p>进入入口起点后，webpack 会找出有哪些模块和库是入口起点（直接和间接）依赖的。</p></li><li><p>每个依赖项随即被处理，最后输出到称之为 <em>bundles</em> 的文件中。默认值为 <code>./src</code>。</p></li></ul><p>配置写法有三种：</p><ul><li>对象，可配置多入口，可配置chunk名，灵活可扩展，最常用,一个属性就是一个entry chunk</li></ul><div class="language-JavaScript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="JavaScript"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-JavaScript;"><code><span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  entry:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    app:</span><span style="color:#CE9178;"> &#39;./src/app.js&#39;</span><span style="color:#D4D4D4;">,        </span><span style="color:#6A9955;">//应用程序(app)入口</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    vendors:</span><span style="color:#CE9178;"> &#39;./src/vendors.js&#39;</span><span style="color:#6A9955;"> //第三方库(vendor)入口</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">};</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>字符串, 最简单直接方式，单入口，chunk名默认为main</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  entry:</span><span style="color:#CE9178;"> &#39;./path/to/my/entry/file.js&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">};</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 是下面的简写</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> config</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  entry:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    main:</span><span style="color:#CE9178;"> &#39;./path/to/my/entry/file.js&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">};</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>数组, 多入口，将多个入口文件打包为一个chunk，chunk名默认为main</li></ul><div class="language-text line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-text;"><code><span class="line"><span class="line"><span>module.exports = {</span></span></span>
<span class="line"><span class="line"><span>  entry: [&#39;./path/to/my/entry/file.js&#39;, &#39;./path/to/my/entry/file1.js&#39;]</span></span></span>
<span class="line"><span class="line"><span>};</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>入口一般用对象写法即可，其他两种写法的可忽略。</p><h5 id="多页面应用程序" tabindex="-1"><a class="header-anchor" href="#多页面应用程序"><span>多页面应用程序</span></a></h5><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//webpack.config.js</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> config</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  entry:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    pageOne:</span><span style="color:#CE9178;"> &#39;./src/pageOne/index.js&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    pageTwo:</span><span style="color:#CE9178;"> &#39;./src/pageTwo/index.js&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    pageThree:</span><span style="color:#CE9178;"> &#39;./src/pageThree/index.js&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">};</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="输出-output" tabindex="-1"><a class="header-anchor" href="#输出-output"><span>输出(output)</span></a></h4><p>打包的输出的文件配置，告诉 webpack 在哪里输出它所创建的 <em>bundles</em>，以及如何命名这些文件，默认值为 <code>./dist</code>。</p><p>Output用于配置打包输出的文件，包括输出文件的文件名、输出路径、静态资源地址，这里列出最常用的4种：</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  entry:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    app:</span><span style="color:#CE9178;"> &#39;./src/app.js&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    search:</span><span style="color:#CE9178;"> &#39;./src/search.js&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  },</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  output:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    filename:</span><span style="color:#CE9178;"> &#39;js/[name].js&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    chunkFilename:</span><span style="color:#CE9178;"> &#39;js/[name].js&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    path:</span><span style="color:#9CDCFE;"> __dirname</span><span style="color:#D4D4D4;"> + </span><span style="color:#CE9178;">&#39;/dist&#39;</span><span style="color:#D4D4D4;">,  </span><span style="color:#6A9955;">//必须是绝对地址</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    publicPath:</span><span style="color:#CE9178;"> &#39;http://cdn.example.com/assets/[hash]/&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">};</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="加载器-loader" tabindex="-1"><a class="header-anchor" href="#加载器-loader"><span>加载器(loader)</span></a></h4><p>Loader可以理解为不同类型模块的处理器，<strong>将这些不同类型的模块处理为浏览器可运行和识别的代码，用于加载某些资源文件</strong>。</p><p>因为 webpack 只能理解 JavaScript 和 JSON 文件，对于其他资源例如 css，图片，或者其他的语法集，比如 jsx， coffee，是没有办法加载的。 这就需要对应的loader将资源转化，加载进来。从字面意思也能看出，loader是用于加载的，它作用于一个个文件上。</p><p>比如babel-loader将es6以上代码转换为es5代码；sass-loader将sass代码解析为css代码；url-loader和file-loader可以将图片、字体等静态文件解析为base64码或者静态文件地址。Loaders给我们提供了处理模块的入口，在里面可以使用全部的js功能，从而使webpack具有了强大而灵活的能力。</p><blockquote><p>注意，loader 能够 <code>import</code> <em>导入任何类型的模块（例如</em> <code>.css</code> 文件），这是 webpack 特有的功能，其他打包程序或任务执行器的可能并不支持。我们认为这种语言扩展是有很必要的，因为这可以使开发人员创建出更准确的依赖关系图。</p></blockquote><ol><li><p><code>test</code> 属性，用于标识出应该被对应的 loader 进行转换的某个或某些文件。</p></li><li><p><code>use</code> 属性，表示进行转换时，应该使用哪个 loader。</p><p>loader配置：</p></li></ol><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C8C8C8;">modlue</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">    rules</span><span style="color:#D4D4D4;">: [</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">          //js Loaders</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">             test:</span><span style="color:#D16969;"> /</span><span style="color:#D7BA7D;">\\.</span><span style="color:#D16969;">js</span><span style="color:#DCDCAA;">$</span><span style="color:#D16969;">/</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">             exclude:</span><span style="color:#D16969;"> /</span><span style="color:#CE9178;">(</span><span style="color:#D16969;">node_modules</span><span style="color:#DCDCAA;">|</span><span style="color:#D16969;">bower_components</span><span style="color:#CE9178;">)</span><span style="color:#D16969;">/</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">             use:</span><span style="color:#CE9178;"> &#39;babel-loader&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        },</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">          //css Loaders</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            test:</span><span style="color:#D16969;"> /</span><span style="color:#D7BA7D;">\\.</span><span style="color:#D16969;">sass</span><span style="color:#DCDCAA;">$</span><span style="color:#D16969;">/</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            use:</span><span style="color:#D4D4D4;"> [ </span><span style="color:#CE9178;">&#39;style-loader&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;css-loader&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;postcss-loader&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;sass-loader&#39;</span><span style="color:#D4D4D4;"> ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="插件-plugins" tabindex="-1"><a class="header-anchor" href="#插件-plugins"><span>插件(plugins)</span></a></h4><ul><li><p>plugin 用于<strong>扩展webpack的功能</strong>。它直接作用于 webpack，扩展了它的功能。</p></li><li><p>当然loader也是变相的扩展了 webpack ，但是它只专注于转化文件（transform）这一个领域。</p></li><li><p>而plugin的功能更加的丰富，而不仅局限于资源的加载。<strong>比如代码分割、静态资源处理、环境变量的注入、将所有css的module抽取为单个文件等。</strong></p></li><li><p>webpack自身也是用插件系统构建起来的。<strong>插件的目的是做任何loaders做不了的事情。</strong></p></li><li><p>插件的范围包括，从打包优化和压缩，一直到重新定义环境中的变量。</p></li><li><p><code>webpack</code>基于发布订阅模式，在运行的生命周期中会广播出许多事件，插件通过监听这些事件，就可以在特定的阶段执行自己的插件任务，从而实现自己想要的功能</p></li></ul><p>想要使用一个插件，你只需要 <code>require()</code> 它，然后把它添加到 <code>plugins</code> 数组中。多数插件可以通过选项(option)自定义。</p><p>你也可以在一个配置文件中因为不同目的而多次使用同一个插件，这时需要通过使用 <code>new</code> 操作符来创建它的一个实例。</p><p>plugins配置：</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//webpack.config.js</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> HtmlWebpackPlugin</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">require</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;html-webpack-plugin&#39;</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">// 通过 npm 安装</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> webpack</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">require</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;webpack&#39;</span><span style="color:#D4D4D4;">); </span><span style="color:#6A9955;">// 用于访问内置插件</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> config</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  module:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    rules:</span><span style="color:#D4D4D4;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">      { </span><span style="color:#9CDCFE;">test:</span><span style="color:#D16969;"> /</span><span style="color:#D7BA7D;">\\.</span><span style="color:#D16969;">txt</span><span style="color:#DCDCAA;">$</span><span style="color:#D16969;">/</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">use:</span><span style="color:#CE9178;"> &#39;raw-loader&#39;</span><span style="color:#D4D4D4;"> }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  },</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  plugins:</span><span style="color:#D4D4D4;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#DCDCAA;"> HtmlWebpackPlugin</span><span style="color:#D4D4D4;">({</span><span style="color:#9CDCFE;">template:</span><span style="color:#CE9178;"> &#39;./src/index.html&#39;</span><span style="color:#D4D4D4;">})</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">};</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">config</span><span style="color:#D4D4D4;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="模式-mode" tabindex="-1"><a class="header-anchor" href="#模式-mode"><span>模式(mode)</span></a></h4><p>通过选择 <code>none</code> 、<code>development</code> 或 <code>production</code> 之中的一个，来设置 <code>mode</code> 参数，你可以启用相应模式下的 webpack 内置的优化</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  mode:</span><span style="color:#CE9178;"> &#39;production&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">};</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="resolve-解析" tabindex="-1"><a class="header-anchor" href="#resolve-解析"><span>resolve（解析）</span></a></h4><p>resolve 用于设置模块如何解析，常用配置如下：</p><ul><li>alias：配置别名，简化模块引入；</li><li>extensions：在引入模块时可不带后缀；</li><li>symlinks：用于配置 npm link 是否生效，禁用可提升编译速度。</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    resolve:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        extensions:</span><span style="color:#D4D4D4;"> [</span><span style="color:#CE9178;">&#39;.js&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;.jsx&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;.ts&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;.tsx&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;.json&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;.d.ts&#39;</span><span style="color:#D4D4D4;">],</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        alias:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">          &#39;@&#39;</span><span style="color:#9CDCFE;">:</span><span style="color:#9CDCFE;"> paths</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">appSrc</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        },</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        symlinks:</span><span style="color:#569CD6;"> false</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="optimization-优化" tabindex="-1"><a class="header-anchor" href="#optimization-优化"><span>optimization（优化）</span></a></h4><p>optimization 用于自定义 webpack 的内置优化配置，一般用于生产模式提升性能，常用配置项如下：</p><ul><li>minimize：是否需要压缩 bundle；</li><li>minimizer：配置压缩工具，如 TerserPlugin、OptimizeCSSAssetsPlugin；</li><li>splitChunks：拆分 bundle；</li><li>runtimeChunk：是否需要将所有生成 chunk 之间共享的运行时文件拆分出来。</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  optimization:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    minimizer:</span><span style="color:#D4D4D4;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">      // 在 webpack@5 中，你可以使用 \`...\` 语法来扩展现有的 minimizer（即 \`terser-webpack-plugin\`），将下一行取消注释</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">      // \`...\`,</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">      new</span><span style="color:#DCDCAA;"> CssMinimizerPlugin</span><span style="color:#D4D4D4;">(),</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ],</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    splitChunks:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">      // include all types of chunks</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">      chunks:</span><span style="color:#CE9178;"> &#39;all&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">      // 重复打包问题</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">      cacheGroups:</span><span style="color:#D4D4D4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        vendors:</span><span style="color:#D4D4D4;">{ </span><span style="color:#6A9955;">//node_modules里的代码</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">          test:</span><span style="color:#D16969;"> /</span><span style="color:#CE9178;">[</span><span style="color:#D7BA7D;">\\\\</span><span style="color:#D16969;">/</span><span style="color:#CE9178;">]</span><span style="color:#D16969;">node_modules</span><span style="color:#CE9178;">[</span><span style="color:#D7BA7D;">\\\\</span><span style="color:#D16969;">/</span><span style="color:#CE9178;">]</span><span style="color:#D16969;">/</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">          chunks:</span><span style="color:#CE9178;"> &quot;all&quot;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">          name:</span><span style="color:#CE9178;"> &#39;vendors&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//chunks name</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">          priority:</span><span style="color:#B5CEA8;"> 10</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">//优先级</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">          enforce:</span><span style="color:#569CD6;"> true</span><span style="color:#D4D4D4;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实践" tabindex="-1"><a class="header-anchor" href="#实践"><span>实践</span></a></h3><p><a href="https://github.com/csmSimona/webpacktest/blob/master/webpack.config.js" target="_blank" rel="noopener noreferrer">一个完整的webpack配置文件</a></p><p><a href="https://juejin.cn/post/6991774994552324133" target="_blank" rel="noopener noreferrer">学习 Webpack5 之路（实践篇）</a></p><h4 id="基本配置" tabindex="-1"><a class="header-anchor" href="#基本配置"><span>基本配置</span></a></h4><h5 id="拆分配置和merge" tabindex="-1"><a class="header-anchor" href="#拆分配置和merge"><span>拆分配置和merge</span></a></h5><p>使用 webpack-merge 合并通用配置和特定环境配置</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-bash;"><code><span class="line"><span class="line"><span style="color:#DCDCAA;">npm</span><span style="color:#CE9178;"> i</span><span style="color:#CE9178;"> webpack-merge</span><span style="color:#569CD6;"> -D</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>通用环境配置</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// webpack.common.js</span></span></span>
<span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = {} </span><span style="color:#6A9955;">// 暂不添加配置</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>开发环境配置</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// webpack.dev.js</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> { </span><span style="color:#4FC1FF;">merge</span><span style="color:#D4D4D4;"> } = </span><span style="color:#DCDCAA;">require</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;webpack-merge&#39;</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> common</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">require</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;./webpack.common&#39;</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">merge</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">common</span><span style="color:#D4D4D4;">, {}) </span><span style="color:#6A9955;">// 暂不添加配置</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>生产环境配置</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// webpack.prod.js</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> { </span><span style="color:#4FC1FF;">merge</span><span style="color:#D4D4D4;"> } = </span><span style="color:#DCDCAA;">require</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;webpack-merge&#39;</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> common</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">require</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;./webpack.common&#39;</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">merge</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">common</span><span style="color:#D4D4D4;">, {}) </span><span style="color:#6A9955;">// 暂不添加配置</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="启动本地服务" tabindex="-1"><a class="header-anchor" href="#启动本地服务"><span>启动本地服务</span></a></h5><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C8C8C8;">devServer</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">    port</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">8080</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">    progress</span><span style="color:#D4D4D4;">: </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">,  </span><span style="color:#6A9955;">// 显示打包的进度条</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">    contentBase</span><span style="color:#D4D4D4;">: </span><span style="color:#9CDCFE;">distPath</span><span style="color:#D4D4D4;">,  </span><span style="color:#6A9955;">// 根目录（本地服务器所加载的页面所在的目录）</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">    open</span><span style="color:#D4D4D4;">: </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">,  </span><span style="color:#6A9955;">// 自动打开浏览器</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">    compress</span><span style="color:#D4D4D4;">: </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">,  </span><span style="color:#6A9955;">// 启动 gzip 压缩</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 设置代理</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">    proxy</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 将本地 /api/xxx 代理到 localhost:3000/api/xxx</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">        &#39;/api&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&#39;http://localhost:3000&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 将本地 /api2/xxx 代理到 localhost:3000/xxx</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">        &#39;/api2&#39;</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            target:</span><span style="color:#CE9178;"> &#39;http://localhost:3000&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            pathRewrite:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">                &#39;/api2&#39;</span><span style="color:#9CDCFE;">:</span><span style="color:#CE9178;"> &#39;&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="处理es6" tabindex="-1"><a class="header-anchor" href="#处理es6"><span>处理ES6</span></a></h5><p>babel-loader</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C8C8C8;">modlue</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">    rules</span><span style="color:#D4D4D4;">: [</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // js Loaders</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">             test:</span><span style="color:#D16969;"> /</span><span style="color:#D7BA7D;">\\.</span><span style="color:#D16969;">js</span><span style="color:#DCDCAA;">$</span><span style="color:#D16969;">/</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">             exclude:</span><span style="color:#D16969;"> /</span><span style="color:#CE9178;">(</span><span style="color:#D16969;">node_modules</span><span style="color:#DCDCAA;">|</span><span style="color:#D16969;">bower_components</span><span style="color:#CE9178;">)</span><span style="color:#D16969;">/</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">             use:</span><span style="color:#CE9178;"> &#39;babel-loader&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="处理样式" tabindex="-1"><a class="header-anchor" href="#处理样式"><span>处理样式</span></a></h5><ul><li>loader执行顺序：从后往前</li><li>style-loader：用于将 CSS 插入到 DOM 中，通过使用多个 <code>&lt;style&gt;&lt;/style&gt;</code> 自动把 styles 插入到 DOM 中</li><li>css-loader：对 <code>@import</code> 和 <code>url()</code> 进行处理，就像 js 解析 <code>import/require()</code> 一样，让 CSS 也能模块化开发。</li><li>postcss-loader：浏览器兼容css</li><li>sass-loader：加载 Sass/SCSS 文件并将他们编译为 CSS</li></ul><blockquote><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fpostcss%2Fpostcss" target="_blank" rel="noopener noreferrer">PostCSS</a> 是一个用 JavaScript 工具和插件转换 CSS 代码的工具。</p><ul><li>可以自动为 CSS 规则添加前缀；</li><li>将最新的 CSS 语法转换成大多数浏览器都能理解的语法；</li><li>css-modules 解决全局命名冲突问题。</li></ul></blockquote><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C8C8C8;">modlue</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">    rules</span><span style="color:#D4D4D4;">: [</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">      	// css Loaders</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            test:</span><span style="color:#D16969;"> /</span><span style="color:#D7BA7D;">\\.</span><span style="color:#D16969;">sass</span><span style="color:#DCDCAA;">$</span><span style="color:#D16969;">/</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            use:</span><span style="color:#D4D4D4;"> [ </span><span style="color:#CE9178;">&#39;style-loader&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;css-loader&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;postcss-loader&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;sass-loader&#39;</span><span style="color:#D4D4D4;"> ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="处理图片" tabindex="-1"><a class="header-anchor" href="#处理图片"><span>处理图片</span></a></h5><ul><li><p>生产模式</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C8C8C8;">module</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">    rules</span><span style="color:#D4D4D4;">: [</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 图片 - 考虑 base64 编码的情况</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            test:</span><span style="color:#D16969;"> /</span><span style="color:#D7BA7D;">\\.</span><span style="color:#CE9178;">(</span><span style="color:#D16969;">png</span><span style="color:#DCDCAA;">|</span><span style="color:#D16969;">jpg</span><span style="color:#DCDCAA;">|</span><span style="color:#D16969;">jpeg</span><span style="color:#DCDCAA;">|</span><span style="color:#D16969;">gif</span><span style="color:#CE9178;">)</span><span style="color:#DCDCAA;">$</span><span style="color:#D16969;">/</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            use:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                loader:</span><span style="color:#CE9178;"> &#39;url-loader&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                options:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                    name:</span><span style="color:#CE9178;">&#39;[name]_[hash].[ext]&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">                    // 小于 5kb 的图片用 base64 格式产出</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">                    // 否则，依然延用 file-loader 的形式，产出 url 格式</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                    limit:</span><span style="color:#B5CEA8;"> 5</span><span style="color:#D4D4D4;"> * </span><span style="color:#B5CEA8;">1024</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                    outputPath:</span><span style="color:#CE9178;">&#39;image/&#39;</span><span style="color:#6A9955;">		//打包图片的位置</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">                    </span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">                    // 设置图片的 cdn 地址（也可以统一在外面的 output 中设置，那将作用于所有静态资源）</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">                    // publicPath: &#39;http://cdn.abc.com&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">                }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">},</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>开发模式</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C8C8C8;">module</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">    rules</span><span style="color:#D4D4D4;">: [</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 直接引入图片 url</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            test:</span><span style="color:#D16969;"> /</span><span style="color:#D7BA7D;">\\.</span><span style="color:#CE9178;">(</span><span style="color:#D16969;">png</span><span style="color:#DCDCAA;">|</span><span style="color:#D16969;">jpg</span><span style="color:#DCDCAA;">|</span><span style="color:#D16969;">jpeg</span><span style="color:#DCDCAA;">|</span><span style="color:#D16969;">gif</span><span style="color:#CE9178;">)</span><span style="color:#DCDCAA;">$</span><span style="color:#D16969;">/</span><span style="color:#D4D4D4;">,	</span><span style="color:#6A9955;">//打包以png|jpg|jpeg|gif结尾的所有图片文件</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            use:</span><span style="color:#D4D4D4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                loader:</span><span style="color:#CE9178;">&#39;file-loader&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                options:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                    name:</span><span style="color:#CE9178;">&#39;[name]_[hash].[ext]&#39;</span><span style="color:#D4D4D4;">,</span><span style="color:#6A9955;">//保持原图片的名字+hash值和后缀,主要单引号</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                    outputPath:</span><span style="color:#CE9178;">&#39;image/&#39;</span><span style="color:#6A9955;">//打包图片的位置</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">                }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">},</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>在 webpack 5 中，可以使用内置的 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwebpack.docschina.org%2Fguides%2Fasset-modules%2F" target="_blank" rel="noopener noreferrer">Asset Modules</a>，将 images 图像混入我们的系统中。</p><p>在 webpack 5 之前，通常使用：</p><ul><li><a href="https://v4.webpack.js.org/loaders/raw-loader/" target="_blank" rel="noopener noreferrer"><code>raw-loader</code></a> 将文件导入为字符串</li><li><a href="https://v4.webpack.js.org/loaders/url-loader/" target="_blank" rel="noopener noreferrer"><code>url-loader</code></a> 将文件作为 data URI 内联到 bundle 中</li><li><a href="https://v4.webpack.js.org/loaders/file-loader/" target="_blank" rel="noopener noreferrer"><code>file-loader</code></a> 将文件发送到输出目录</li></ul><p>资源模块类型(asset module type)，通过添加 4 种新的模块类型，来替换所有这些 loader：</p><ul><li><code>asset/resource</code> 发送一个单独的文件并导出 URL。之前通过使用 <code>file-loader</code> 实现。</li><li><code>asset/inline</code> 导出一个资源的 data URI。之前通过使用 <code>url-loader</code> 实现。</li><li><code>asset/source</code> 导出资源的源代码。之前通过使用 <code>raw-loader</code> 实现。</li><li><code>asset</code> 在导出一个 data URI 和发送一个单独的文件之间自动选择。之前通过使用 <code>url-loader</code>，并且配置资源体积限制实现。</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> paths</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">require</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;./paths&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    module:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        rules:</span><span style="color:#D4D4D4;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">          {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            test:</span><span style="color:#D16969;"> /</span><span style="color:#D7BA7D;">\\.</span><span style="color:#CE9178;">(</span><span style="color:#D16969;">png</span><span style="color:#DCDCAA;">|</span><span style="color:#D16969;">svg</span><span style="color:#DCDCAA;">|</span><span style="color:#D16969;">jpg</span><span style="color:#DCDCAA;">|</span><span style="color:#D16969;">jpeg</span><span style="color:#DCDCAA;">|</span><span style="color:#D16969;">gif</span><span style="color:#CE9178;">)</span><span style="color:#DCDCAA;">$</span><span style="color:#D16969;">/</span><span style="color:#569CD6;">i</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            include:</span><span style="color:#9CDCFE;"> paths</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">appSrc</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            type:</span><span style="color:#CE9178;"> &#39;asset/resource&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">          },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        ],</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">      },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="source-map" tabindex="-1"><a class="header-anchor" href="#source-map"><span>Source Map</span></a></h5><p><code>sourceMap</code>是一项<strong>将编译、打包、压缩后的代码映射回源代码的技术</strong>，由于打包压缩后的代码并没有阅读性可言，一旦在开发中报错或者遇到问题，直接在混淆代码中<code>debug</code>问题会带来非常糟糕的体验，<code>sourceMap</code><strong>可以帮助我们快速定位到源代码的位置，提高我们的开发效率</strong>。<code>sourceMap</code>其实并不是<code>Webpack</code>特有的功能，而是<code>Webpack</code>支持<code>sourceMap</code>，像<code>JQuery</code>也支持<code>souceMap</code>。</p><p><strong>配置：</strong></p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> =  </span><span style="color:#DCDCAA;">merge</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">common</span><span style="color:#D4D4D4;">, {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">  // 开发工具，开启 source map，编译调试</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  devtool:</span><span style="color:#CE9178;"> &#39;eval-cheap-module-source-map&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">})</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>source map 有许多 <a href="https://webpack.docschina.org/configuration/devtool/" target="_blank" rel="noopener noreferrer">可用选项</a>。本例选择的是 <code>eval-cheap-module-source-map</code></p><blockquote><p>注：为加快生产环境打包速度，不为生产环境配置 devtool。</p></blockquote><p>既然是一种源码的映射，那必然就需要有一份映射的文件，来标记混淆代码里对应的源码的位置，通常这份映射文件以<code>.map</code>结尾，里边的数据结构大概长这样：</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#D4D4D4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">  &quot;version&quot;</span><span style="color:#D4D4D4;"> : </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">,                          </span><span style="color:#6A9955;">// Source Map版本</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">  &quot;file&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;out.js&quot;</span><span style="color:#D4D4D4;">,                       </span><span style="color:#6A9955;">// 输出文件（可选）</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">  &quot;sourceRoot&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;">,                       </span><span style="color:#6A9955;">// 源文件根目录（可选）</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">  &quot;sources&quot;</span><span style="color:#D4D4D4;">: [</span><span style="color:#CE9178;">&quot;foo.js&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;bar.js&quot;</span><span style="color:#D4D4D4;">],        </span><span style="color:#6A9955;">// 源文件列表</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">  &quot;sourcesContent&quot;</span><span style="color:#D4D4D4;">: [</span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">],         </span><span style="color:#6A9955;">// 源内容列表（可选，和源文件列表顺序一致）</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">  &quot;names&quot;</span><span style="color:#D4D4D4;">: [</span><span style="color:#CE9178;">&quot;src&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;maps&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;are&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;fun&quot;</span><span style="color:#D4D4D4;">], </span><span style="color:#6A9955;">// mappings使用的符号名称列表</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">  &quot;mappings&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;A,AAAB;;ABCDE;&quot;</span><span style="color:#6A9955;">            // 带有编码映射数据的字符串</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中<code>mappings</code>数据有如下规则：</p><ul><li>生成文件中的一行的每个组用“;”分隔；</li><li>每一段用“,”分隔；</li><li>每个段由1、4或5个可变长度字段组成；</li></ul><p>有了这份映射文件，我们只需要在我们的压缩代码的最末端加上这句注释，即可让sourceMap生效：</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">//# sourceURL=/path/to/file.js.map</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>有了这段注释后，浏览器就会通过<code>sourceURL</code>去获取这份映射文件，通过解释器解析后，实现源码和混淆代码之间的映射。因此sourceMap其实也是一项需要浏览器支持的技术。</p><p>如果我们仔细查看webpack打包出来的bundle文件，就可以发现在默认的<code>development</code>开发模式下，每个<code>_webpack_modules__</code>文件模块的代码最末端，都会加上<code>//# sourceURL=webpack://file-path?</code>，从而实现对sourceMap的支持。</p><h5 id="htmlwebpackplugin" tabindex="-1"><a class="header-anchor" href="#htmlwebpackplugin"><span>HtmlWebpackPlugin</span></a></h5><p><code>npx webpack --config config/webpack.prod.js</code> 后仅生成了 bundle.js，我们还需要一个 HTML5 文件，用来动态引入打包生成的 bundle 文件。</p><p>引入 <code>HtmlWebpackPlugin</code> 插件，生成一个 HTML5 文件， 其中包括使用 <code>script</code> 标签的 body 中的所有 webpack 包。</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-bash;"><code><span class="line"><span class="line"><span style="color:#DCDCAA;">npm</span><span style="color:#CE9178;"> install</span><span style="color:#569CD6;"> --save-dev</span><span style="color:#CE9178;"> html-webpack-plugin</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>配置</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  plugins:</span><span style="color:#D4D4D4;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 生成html，自动引入所有bundle</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#DCDCAA;"> HtmlWebpackPlugin</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">      title:</span><span style="color:#CE9178;"> &#39;index.html&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    }),</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  ],</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="执行命令" tabindex="-1"><a class="header-anchor" href="#执行命令"><span>执行命令</span></a></h5><p>优化 webpack 的实时编译、打包编译指令。</p><p>通过 cross-env 配置环境变量，区分开发环境和生产环境。</p><p>安装：</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-bash;"><code><span class="line"><span class="line"><span style="color:#DCDCAA;">npm</span><span style="color:#CE9178;"> install</span><span style="color:#569CD6;"> --save-dev</span><span style="color:#CE9178;"> cross-env</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>修改 package.json：</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#D4D4D4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">    &quot;scripts&quot;</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">        &quot;dev&quot;</span><span style="color:#9CDCFE;">:</span><span style="color:#CE9178;"> &quot;cross-env NODE_ENV=development webpack serve --open --config config/webpack.dev.js&quot;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">        &quot;build&quot;</span><span style="color:#9CDCFE;">:</span><span style="color:#CE9178;"> &quot;cross-env NODE_ENV=production webpack --config config/webpack.prod.js&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">      },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在可以运行 webpack 指令：</p><ul><li>npm run dev：本地构建；</li><li>npm run build：生产打包。</li></ul><h4 id="高级配置" tabindex="-1"><a class="header-anchor" href="#高级配置"><span>高级配置</span></a></h4><h5 id="多入口" tabindex="-1"><a class="header-anchor" href="#多入口"><span>多入口</span></a></h5><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C8C8C8;">    entry</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">        index</span><span style="color:#D4D4D4;">: </span><span style="color:#9CDCFE;">path</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">join</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">srcPath</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;index.js&#39;</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">        other</span><span style="color:#D4D4D4;">: </span><span style="color:#9CDCFE;">path</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">join</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">srcPath</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;other.js&#39;</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    },</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">	output</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // filename: &#39;bundle.[contentHash:8].js&#39;,  // 打包代码时，加上 hash 戳</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">        filename</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&#39;[name].[contentHash:8].js&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// name 即多入口时 entry 的 key</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">        path</span><span style="color:#D4D4D4;">: </span><span style="color:#9CDCFE;">distPath</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // publicPath: &#39;http://cdn.abc.com&#39;  // 修改所有静态文件 url 的前缀（如 cdn 域名），这里暂时用不到</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    },</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">    plugins</span><span style="color:#D4D4D4;">: [</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // new HtmlWebpackPlugin({</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        //     template: path.join(srcPath, &#39;index.html&#39;),</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        //     filename: &#39;index.html&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // })</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 多入口 - 生成 index.html</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">        new</span><span style="color:#DCDCAA;"> HtmlWebpackPlugin</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            template:</span><span style="color:#9CDCFE;"> path</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">join</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">srcPath</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;index.html&#39;</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            filename:</span><span style="color:#CE9178;"> &#39;index.html&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // chunks 表示该页面要引用哪些 chunk （即上面的 index 和 other），默认全部引用</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            chunks:</span><span style="color:#D4D4D4;"> [</span><span style="color:#CE9178;">&#39;index&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;vendor&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;common&#39;</span><span style="color:#D4D4D4;">]  </span><span style="color:#6A9955;">// 要考虑代码分割</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        }),</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 多入口 - 生成 other.html</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">        new</span><span style="color:#DCDCAA;"> HtmlWebpackPlugin</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            template:</span><span style="color:#9CDCFE;"> path</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">join</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">srcPath</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;other.html&#39;</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            filename:</span><span style="color:#CE9178;"> &#39;other.html&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            chunks:</span><span style="color:#D4D4D4;"> [</span><span style="color:#CE9178;">&#39;other&#39;</span><span style="color:#D4D4D4;">]  </span><span style="color:#6A9955;">// 只引用 other.js</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        })</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ]</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="懒加载" tabindex="-1"><a class="header-anchor" href="#懒加载"><span>懒加载</span></a></h5><p>在一个js中异步加载的js，构建打包后生成另外的js</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 引用动态数据 - 懒加载</span></span></span>
<span class="line"><span class="line"><span style="color:#DCDCAA;">setTimeout</span><span style="color:#D4D4D4;">(() </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 回顾vue react异步组件</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 定义一个chunk</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    import</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;./dynamic-data.js&#39;</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">then</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">res</span><span style="color:#569CD6;"> =&gt;</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">res</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">default</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">message</span><span style="color:#D4D4D4;">);   </span><span style="color:#6A9955;">// 注意这里的default</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    })</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}, </span><span style="color:#B5CEA8;">1500</span><span style="color:#D4D4D4;">)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="处理jsx" tabindex="-1"><a class="header-anchor" href="#处理jsx"><span>处理JSX</span></a></h5><p>配置.babellrc，babel解析</p><div class="language-text line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-text;"><code><span class="line"><span class="line"><span>{</span></span></span>
<span class="line"><span class="line"><span>    &quot;presets&quot;: [&quot;@babel/preset-react&quot;],</span></span></span>
<span class="line"><span class="line"><span>    &quot;plugins&quot;: []</span></span></span>
<span class="line"><span class="line"><span>}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="处理vue" tabindex="-1"><a class="header-anchor" href="#处理vue"><span>处理Vue</span></a></h5><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C8C8C8;">rules</span><span style="color:#D4D4D4;">: [</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        test:</span><span style="color:#D16969;"> /</span><span style="color:#D7BA7D;">\\.</span><span style="color:#D16969;">vue</span><span style="color:#DCDCAA;">$</span><span style="color:#D16969;">/</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        loader:</span><span style="color:#D4D4D4;"> [</span><span style="color:#CE9178;">&#39;vue-loader&#39;</span><span style="color:#D4D4D4;">],</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        include:</span><span style="color:#9CDCFE;"> srcPath</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">]</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="module、chunk、bundle的区别" tabindex="-1"><a class="header-anchor" href="#module、chunk、bundle的区别"><span>module、chunk、bundle的区别</span></a></h5><ul><li>module：各个源码文件，webpack中一切皆模块</li><li>chunk：多模块合并成的，如<code>entry</code>、<code>import()</code>、<code>splitChunk</code></li><li>bundle：最终的输出文件</li></ul><h5 id="热更新" tabindex="-1"><a class="header-anchor" href="#热更新"><span>热更新</span></a></h5><p><a href="https://webpack.docschina.org/guides/hot-module-replacement/" target="_blank" rel="noopener noreferrer">热更新</a> 指的是，在开发过程中，修改代码后，仅更新修改部分的内容，无需刷新整个页面。</p><p>使用 webpack 内置的 HMR 插件，更新 webpack-dev-server 配置。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// webpack.dev.js</span></span></span>
<span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">export</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    devServer:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        contentBase:</span><span style="color:#CE9178;"> &#39;./dist&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        hot:</span><span style="color:#569CD6;"> true</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// 热更新</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">      },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>自动刷新：整个网页全部刷新，速度较慢，状态会丢失</li><li>热更新：新代码生效，网页不刷新，状态不丢失，但是成本更高</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">    const</span><span style="color:#4FC1FF;"> HotModuleReplacementPlugin</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">require</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;webpack/lib/HotModuleReplacementPlugin&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">    entry</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // index: path.join(srcPath, &#39;index.js&#39;),</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">        index</span><span style="color:#D4D4D4;">: [</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">            &#39;webpack-dev-server/client?http://localhost:8080/&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">            &#39;webpack/hot/dev-server&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            path</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">join</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">srcPath</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;index.js&#39;</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        ],</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">        other</span><span style="color:#D4D4D4;">: </span><span style="color:#9CDCFE;">path</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">join</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">srcPath</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;other.js&#39;</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    },</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">    plugins</span><span style="color:#D4D4D4;">: [</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">        new</span><span style="color:#9CDCFE;"> webpack</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">DefinePlugin</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // window.ENV = &#39;production&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            ENV:</span><span style="color:#4FC1FF;"> JSON</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">stringify</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;development&#39;</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        }),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">        new</span><span style="color:#DCDCAA;"> HotModuleReplacementPlugin</span><span style="color:#D4D4D4;">()</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ],</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">	devserver</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">        hot</span><span style="color:#D4D4D4;">: </span><span style="color:#569CD6;">true</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    }</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// index.js</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">// 增加，开启热更新之后的代码逻辑</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">hot</span><span style="color:#D4D4D4;">) {</span></span></span>
<span class="line"><span class="line"><span style="color:#4EC9B0;">    module</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">hot</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">accept</span><span style="color:#D4D4D4;">([</span><span style="color:#CE9178;">&#39;./math&#39;</span><span style="color:#D4D4D4;">], () </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">        const</span><span style="color:#4FC1FF;"> sumRes</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">sum</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;sumRes in hot&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">sumRes</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    })</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="优化" tabindex="-1"><a class="header-anchor" href="#优化"><span>优化</span></a></h3><p><a href="https://juejin.cn/post/6996816316875161637?searchId=202409161748330E857FD24E94D6369813" target="_blank" rel="noopener noreferrer">学习 Webpack5 之路（优化篇）</a></p><h4 id="优化效率工具" tabindex="-1"><a class="header-anchor" href="#优化效率工具"><span>优化效率工具</span></a></h4><p>安装以下 webpack 插件，帮助我们分析优化效率：</p><ul><li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fprogress-bar-webpack-plugin" target="_blank" rel="noopener noreferrer">progress-bar-webpack-plugin</a>：查看编译进度；</li><li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fspeed-measure-webpack-plugin" target="_blank" rel="noopener noreferrer">speed-measure-webpack-plugin</a>：查看编译速度；</li><li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fwebpack-bundle-analyzer" target="_blank" rel="noopener noreferrer">webpack-bundle-analyzer</a>：打包体积分析。</li></ul><h4 id="加快构建速度" tabindex="-1"><a class="header-anchor" href="#加快构建速度"><span>加快构建速度</span></a></h4><h5 id="cache缓存" tabindex="-1"><a class="header-anchor" href="#cache缓存"><span>cache缓存</span></a></h5><p>通过 <code>cache: filesystem</code> 可以将构建过程的 webpack 模板进行缓存，大幅提升二次构建速度、打包速度，当构建突然中断，二次进行构建时，可以直接从缓存中拉取，可提速 <strong>90%</strong> 左右。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    cache:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">      type:</span><span style="color:#CE9178;"> &#39;filesystem&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// 使用文件缓存</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="dllplugin-动态链接库插件❌" tabindex="-1"><a class="header-anchor" href="#dllplugin-动态链接库插件❌"><span>DLLPlugin 动态链接库插件❌</span></a></h5><p>已不推荐使用</p><blockquote><p>webpack5 开箱即用的持久缓存是比 dll 更优的解决方案</p></blockquote><p>将依赖单独打包，这样以后每次只构建业务代码</p><p>DllPlugin 配置流程大致分为三步：</p><p>1）创建 dll.config.js 配置文件</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">DllPlugin</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &quot;webpack&quot;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">export</span><span style="color:#C586C0;"> default</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 需要抽离的依赖</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    entry:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        vendor:</span><span style="color:#D4D4D4;"> [</span><span style="color:#CE9178;">&quot;vue&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;vue-router&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;axios&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;echarts&quot;</span><span style="color:#D4D4D4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    },</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    mode:</span><span style="color:#CE9178;"> &quot;production&quot;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    optimization:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        splitChunks:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            cacheGroups:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                vendor:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                    chunks:</span><span style="color:#CE9178;"> &quot;all&quot;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                    name:</span><span style="color:#CE9178;"> &quot;vendor&quot;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                    test:</span><span style="color:#D16969;"> /node_modules/</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">                }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    },</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    output:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        filename:</span><span style="color:#CE9178;"> &quot;[name].dll.js&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// 输出路径和文件名称</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        library:</span><span style="color:#CE9178;"> &quot;[name]&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// 全局变量名称：其他模块会从此变量上获取里面模块</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        path:</span><span style="color:#DCDCAA;"> AbsPath</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;dist/static&quot;</span><span style="color:#D4D4D4;">) </span><span style="color:#6A9955;">// 输出目录路径</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    },</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    plugins:</span><span style="color:#D4D4D4;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">        new</span><span style="color:#DCDCAA;"> DllPlugin</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            name:</span><span style="color:#CE9178;"> &quot;[name]&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// 全局变量名称：减小搜索范围，与output.library结合使用</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            path:</span><span style="color:#DCDCAA;"> AbsPath</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;dist/static/[name]-manifest.json&quot;</span><span style="color:#D4D4D4;">) </span><span style="color:#6A9955;">// 输出目录路径</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        })</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">};</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2）package.json 配置脚本</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#CE9178;">&quot;build:dll&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;webpack --config ./dll.config.js&quot;</span><span style="color:#D4D4D4;">,</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>3）使用 <code>DllReferencePlugin</code> 将打包生成的dll文件，引用到需要的预编译的依赖上来，并通过 <code>html-webpack-tags-plugin</code> 在打包时自动插入dll文件</p><p>vue.config.js 配置如下:</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">DllReferencePlugin</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#CE9178;"> &quot;webpack&quot;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#9CDCFE;"> HtmlTagsPlugin</span><span style="color:#C586C0;"> from</span><span style="color:#CE9178;"> &quot;html-webpack-tags-plugin&quot;</span><span style="color:#D4D4D4;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#C586C0;">export</span><span style="color:#C586C0;"> default</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  configureWebpack:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    plugins:</span><span style="color:#D4D4D4;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">      new</span><span style="color:#DCDCAA;"> DllReferencePlugin</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        manifest:</span><span style="color:#DCDCAA;"> AbsPath</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;dist/static/vendor-manifest.json&quot;</span><span style="color:#D4D4D4;">) </span><span style="color:#6A9955;">// manifest文件路径</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">      }),</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">      new</span><span style="color:#DCDCAA;"> HtmlTagsPlugin</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        append:</span><span style="color:#569CD6;"> false</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// 在生成资源后插入</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        publicPath:</span><span style="color:#CE9178;"> &quot;/&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// 使用公共路径</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        tags:</span><span style="color:#D4D4D4;"> [</span><span style="color:#CE9178;">&quot;static/vendor.dll.js&quot;</span><span style="color:#D4D4D4;">] </span><span style="color:#6A9955;">// 资源路径</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">      })</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">};</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="优化babel-loader" tabindex="-1"><a class="header-anchor" href="#优化babel-loader"><span>优化babel-loader</span></a></h5><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#D4D4D4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">    test</span><span style="color:#D4D4D4;">:</span><span style="color:#D16969;"> /</span><span style="color:#D7BA7D;">\\.</span><span style="color:#D16969;">js</span><span style="color:#DCDCAA;">$</span><span style="color:#D16969;">/</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">  	loader</span><span style="color:#D4D4D4;">: [</span><span style="color:#CE9178;">&#39;babel-loader?cacheDirectory&#39;</span><span style="color:#D4D4D4;">],	</span><span style="color:#6A9955;">// 开启缓存</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">    include</span><span style="color:#D4D4D4;">: </span><span style="color:#9CDCFE;">path</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">resolve</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">__dirname</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;src&#39;</span><span style="color:#D4D4D4;">),	</span><span style="color:#6A9955;">// 明确范围</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 排除范围，include和exclude两者选一个即可</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // exclude: path.resolve(__dirname, &#39;node_modules&#39;)</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="ignoreplugin-避免引用无用模块-直接不引入-代码中没有" tabindex="-1"><a class="header-anchor" href="#ignoreplugin-避免引用无用模块-直接不引入-代码中没有"><span>IgnorePlugin 避免引用无用模块（直接不引入，代码中没有）</span></a></h5><p>以moment.js为例，忽略语言包</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// 忽略 moment 下的 /locale 目录</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">new</span><span style="color:#9CDCFE;"> webpack</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">IgnorePlugin</span><span style="color:#D4D4D4;">(</span><span style="color:#D16969;">/</span><span style="color:#D7BA7D;">\\.\\/</span><span style="color:#D16969;">locale/</span><span style="color:#D4D4D4;">,</span><span style="color:#D16969;"> /moment/</span><span style="color:#D4D4D4;">),</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="noparse避免重复打包-引入-但不打包" tabindex="-1"><a class="header-anchor" href="#noparse避免重复打包-引入-但不打包"><span>noParse避免重复打包（引入，但不打包）</span></a></h5><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    module:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 独完整的 react.min.js 文件就没有采用模块化</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 忽略对 react.min.js 文件的递归解析处理</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        noParse:</span><span style="color:#D4D4D4;"> [</span><span style="color:#D16969;">/react</span><span style="color:#D7BA7D;">\\.</span><span style="color:#D16969;">min</span><span style="color:#D7BA7D;">\\.</span><span style="color:#D16969;">js</span><span style="color:#DCDCAA;">$</span><span style="color:#D16969;">/</span><span style="color:#D4D4D4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="thread-loader-多线程" tabindex="-1"><a class="header-anchor" href="#thread-loader-多线程"><span>thread-loader 多线程</span></a></h5><p>通过 <a href="https://webpack.docschina.org/loaders/thread-loader/#root" target="_blank" rel="noopener noreferrer">thread-loader</a> 将耗时的 loader 放在一个独立的 worker 池中运行，加快 loader 构建速度。</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-bash;"><code><span class="line"><span class="line"><span style="color:#DCDCAA;">npm</span><span style="color:#CE9178;"> i</span><span style="color:#569CD6;"> -D</span><span style="color:#CE9178;"> thread-loader</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>我们应该仅在非常耗时的 loader 前引入 thread-loader（例如sass-loader）</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    rules:</span><span style="color:#D4D4D4;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        test:</span><span style="color:#D16969;"> /</span><span style="color:#D7BA7D;">\\.</span><span style="color:#D16969;">module</span><span style="color:#D7BA7D;">\\.</span><span style="color:#CE9178;">(</span><span style="color:#D16969;">scss</span><span style="color:#DCDCAA;">|</span><span style="color:#D16969;">sass</span><span style="color:#CE9178;">)</span><span style="color:#DCDCAA;">$</span><span style="color:#D16969;">/</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        include:</span><span style="color:#9CDCFE;"> paths</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">appSrc</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        use:</span><span style="color:#D4D4D4;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">          &#39;style-loader&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">          {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            loader:</span><span style="color:#CE9178;"> &#39;css-loader&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            options:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">              modules:</span><span style="color:#569CD6;"> true</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">              importLoaders:</span><span style="color:#B5CEA8;"> 2</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">          },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">          {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            loader:</span><span style="color:#CE9178;"> &#39;postcss-loader&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            options:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">              postcssOptions:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                plugins:</span><span style="color:#D4D4D4;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">                  [</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">                    &#39;postcss-preset-env&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">                  ],</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">                ],</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">              },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">          },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">          {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            loader:</span><span style="color:#CE9178;"> &#39;thread-loader&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            options:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">              workerParallelJobs:</span><span style="color:#B5CEA8;"> 2</span><span style="color:#6A9955;"> // 一个 worker 进程中并行执行工作的数量</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">          },</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">          &#39;sass-loader&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        ].</span><span style="color:#DCDCAA;">filter</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">Boolean</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">      },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="happypack-多进程打包❌" tabindex="-1"><a class="header-anchor" href="#happypack-多进程打包❌"><span>happyPack 多进程打包❌</span></a></h5><p>提高构建速度，特别是多核CPU</p><p>已不推荐使用</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C8C8C8;">    module</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">        rules</span><span style="color:#D4D4D4;">: [</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // js</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                test:</span><span style="color:#D16969;"> /</span><span style="color:#D7BA7D;">\\.</span><span style="color:#D16969;">js</span><span style="color:#DCDCAA;">$</span><span style="color:#D16969;">/</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">                // 把对 .js 文件的处理转交给 id 为 babel 的 HappyPack 实例</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                use:</span><span style="color:#D4D4D4;"> [</span><span style="color:#CE9178;">&#39;happypack/loader?id=babel&#39;</span><span style="color:#D4D4D4;">],</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                include:</span><span style="color:#9CDCFE;"> srcPath</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">                // exclude: /node_modules/</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    },</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">    plugins</span><span style="color:#D4D4D4;">: [</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // happyPack 开启多进程打包</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">        new</span><span style="color:#DCDCAA;"> HappyPack</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // 用唯一的标识符 id 来代表当前的 HappyPack 是用来处理一类特定的文件</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            id:</span><span style="color:#CE9178;"> &#39;babel&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // 如何处理 .js 文件，用法和 Loader 配置中一样</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            loaders:</span><span style="color:#D4D4D4;"> [</span><span style="color:#CE9178;">&#39;babel-loader?cacheDirectory&#39;</span><span style="color:#D4D4D4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        }),</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ]</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="自动刷新" tabindex="-1"><a class="header-anchor" href="#自动刷新"><span>自动刷新</span></a></h5><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C8C8C8;">    watch</span><span style="color:#D4D4D4;">: </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// 开启监听，默认为 false</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">    watchOptions</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">        ignored</span><span style="color:#D4D4D4;">:</span><span style="color:#D16969;"> /node_modules/</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// 忽略哪些</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 监听到变化发生后会等300ms再去执行动作，防止文件更新太快导致重新编译频率太高</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 默认为 300ms</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">        aggregateTimeout</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">300</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 判断文件是否发生变化是通过不停的去询问系统指定文件有没有变化实现的</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 默认每隔1000毫秒询问一次</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">        poll</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">1000</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    }</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h5><p>用于生产环境</p><ul><li>优化babel-loader</li><li>IgnorePlugin</li><li>noParse</li><li>thread-loader</li><li>happyPack❌</li></ul><p>开发环境</p><ul><li>cache缓存</li><li>DLLPlugin❌</li><li>自动刷新</li></ul><h4 id="减小打包体积" tabindex="-1"><a class="header-anchor" href="#减小打包体积"><span>减小打包体积</span></a></h4><h5 id="paralleluglifyplugin-多进程代码压缩❌" tabindex="-1"><a class="header-anchor" href="#paralleluglifyplugin-多进程代码压缩❌"><span>ParallelUglifyPlugin 多进程代码压缩❌</span></a></h5><blockquote><p>webpack5 的 TerserWebpackPlugin 默认就开启了多进程和缓存，无需再引入 ParallelUglifyPlugin</p></blockquote><ul><li>项目较大，打包较慢，开启多进程能提高速度</li><li>项目较小，打包很快，开启多进程会减低速度（进程开销）</li><li>按需使用</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C8C8C8;">plugins</span><span style="color:#D4D4D4;">: [</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 使用 ParallelUglifyPlugin 并行压缩输出的 JS 代码</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#DCDCAA;"> ParallelUglifyPlugin</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 传递给 UglifyJS 的参数</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // （还是使用 UglifyJS 压缩，只不过帮助开启了多进程）</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        uglifyJS:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            output:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                beautify:</span><span style="color:#569CD6;"> false</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// 最紧凑的输出</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                comments:</span><span style="color:#569CD6;"> false</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// 删除所有的注释</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            compress:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">                // 删除所有的 \`console\` 语句，可以兼容ie浏览器</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                drop_console:</span><span style="color:#569CD6;"> true</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">                // 内嵌定义了但是只用到一次的变量</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                collapse_vars:</span><span style="color:#569CD6;"> true</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">                // 提取出出现多次但是没有定义成变量去引用的静态值</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                reduce_vars:</span><span style="color:#569CD6;"> true</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    })</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">]</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="js压缩-terserwebpackplugin" tabindex="-1"><a class="header-anchor" href="#js压缩-terserwebpackplugin"><span>JS压缩（TerserWebpackPlugin）</span></a></h5><p>使用 <a href="https://webpack.docschina.org/plugins/terser-webpack-plugin" target="_blank" rel="noopener noreferrer">TerserWebpackPlugin</a> 来压缩 JavaScript。</p><p>webpack5 自带最新的 <code>terser-webpack-plugin</code>，无需手动安装。</p><p><code>terser-webpack-plugin</code> 默认开启了 <code>parallel: true</code> 配置，并发运行的默认数量： <code>os.cpus().length - 1</code> ，本文配置的 parallel 数量为 4，使用多进程并发运行压缩以提高构建速度。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> TerserPlugin</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">require</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;terser-webpack-plugin&#39;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    optimization:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        minimizer:</span><span style="color:#D4D4D4;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">            new</span><span style="color:#DCDCAA;"> TerserPlugin</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">              parallel:</span><span style="color:#B5CEA8;"> 4</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">              terserOptions:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                parse:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                  ecma:</span><span style="color:#B5CEA8;"> 8</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">                },</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                compress:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                  ecma:</span><span style="color:#B5CEA8;"> 5</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                  warnings:</span><span style="color:#569CD6;"> false</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                  comparisons:</span><span style="color:#569CD6;"> false</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                  inline:</span><span style="color:#B5CEA8;"> 2</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">                },</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                mangle:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                  safari10:</span><span style="color:#569CD6;"> true</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">                },</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                output:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                  ecma:</span><span style="color:#B5CEA8;"> 5</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                  comments:</span><span style="color:#569CD6;"> false</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                  ascii_only:</span><span style="color:#569CD6;"> true</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">                },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">              },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            }),</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="css压缩-cssminimizerwebpackplugin" tabindex="-1"><a class="header-anchor" href="#css压缩-cssminimizerwebpackplugin"><span>css压缩（CssMinimizerWebpackPlugin）</span></a></h5><p>使用 <a href="https://webpack.docschina.org/plugins/css-minimizer-webpack-plugin/#root" target="_blank" rel="noopener noreferrer">CssMinimizerWebpackPlugin</a> 压缩 CSS 文件。</p><p><code>CssMinimizerWebpackPlugin</code> 将在 Webpack 构建期间搜索 CSS 文件，优化、压缩 CSS。</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-bash;"><code><span class="line"><span class="line"><span style="color:#DCDCAA;">npm</span><span style="color:#CE9178;"> install</span><span style="color:#569CD6;"> -D</span><span style="color:#CE9178;"> css-minimizer-webpack-plugin</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> CssMinimizerPlugin</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">require</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;css-minimizer-webpack-plugin&quot;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  optimization:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    minimizer:</span><span style="color:#D4D4D4;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">      new</span><span style="color:#DCDCAA;"> CssMinimizerPlugin</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">          parallel:</span><span style="color:#B5CEA8;"> 4</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        }),</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ],</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这将仅在生产环境开启 CSS 优化。</p><p>如果还想在开发环境下启用 CSS 优化，请将 <code>optimization.minimize</code> 设置为 <code>true</code></p><h5 id="抽离公共代码-splitchunks" tabindex="-1"><a class="header-anchor" href="#抽离公共代码-splitchunks"><span>抽离公共代码（splitChunks）</span></a></h5><p><a href="https://webpack.docschina.org/plugins/split-chunks-plugin/" target="_blank" rel="noopener noreferrer">SplitChunksPlugin</a> 插件开箱即用，可以将公共的依赖模块提取到已有的入口 chunk 中，或者提取到一个新生成的 chunk。</p><p>webpack 将根据以下条件自动拆分 chunks：</p><ul><li>新的 chunk 可以被共享，或者模块来自于 <code>node_modules</code> 文件夹；</li><li>新的 chunk 体积大于 20kb（在进行 min+gz 之前的体积）；</li><li>当按需加载 chunks 时，并行请求的最大数量小于或等于 30；</li><li>当加载初始化页面时，并发请求的最大数量小于或等于 30； 通过 splitChunks 把 react 等公共库抽离出来，不重复引入占用体积。</li></ul><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#C8C8C8;">    optimization</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">        // 分割代码块</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">        splitChunks</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">            chunks</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&#39;all&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            /**</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">             * initial 入口 chunk，对于异步导入的文件不处理</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">                async 异步 chunk，只对异步导入的文件处理</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">                all 全部 chunk</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">             */</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">            // 缓存分组</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">            cacheGroups</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">                // 第三方模块</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">                vendor</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">                    name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&#39;vendor&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// chunk 名称</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">                    priority</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// 权限更高，优先抽离，重要！！！</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">                    test</span><span style="color:#D4D4D4;">:</span><span style="color:#D16969;"> /node_modules/</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">                    minSize</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,  </span><span style="color:#6A9955;">// 大小限制</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">                    minChunks</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">1</span><span style="color:#6A9955;">  // 最少复用过几次</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">                },</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">                // 公共的模块</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">                common</span><span style="color:#D4D4D4;">: {</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">                    name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&#39;common&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// chunk 名称</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">                    priority</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// 优先级</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">                    minSize</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,  </span><span style="color:#6A9955;">// 公共模块的大小限制</span></span></span>
<span class="line"><span class="line"><span style="color:#C8C8C8;">                    minChunks</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">2</span><span style="color:#6A9955;">  // 公共模块最少复用过几次</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">                }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    }</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="抽离css文件-minicssextractplugin" tabindex="-1"><a class="header-anchor" href="#抽离css文件-minicssextractplugin"><span>抽离CSS文件（MiniCssExtractPlugin）</span></a></h5><p><a href="https://webpack.docschina.org/plugins/mini-css-extract-plugin/" target="_blank" rel="noopener noreferrer">MiniCssExtractPlugin</a> 插件将 CSS 提取到单独的文件中，为每个包含 CSS 的 JS 文件创建一个 CSS 文件，并且支持 CSS 和 SourceMaps 的按需加载。</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-bash;"><code><span class="line"><span class="line"><span style="color:#DCDCAA;">npm</span><span style="color:#CE9178;"> install</span><span style="color:#569CD6;"> -D</span><span style="color:#CE9178;"> mini-css-extract-plugin</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>配置：</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> MiniCssExtractPlugin</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">require</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;mini-css-extract-plugin&quot;</span><span style="color:#D4D4D4;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  plugins:</span><span style="color:#D4D4D4;"> [</span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> MiniCssExtractPlugin</span><span style="color:#D4D4D4;">()],</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  module:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    rules:</span><span style="color:#D4D4D4;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        test:</span><span style="color:#D16969;"> /</span><span style="color:#D7BA7D;">\\.</span><span style="color:#D16969;">module</span><span style="color:#D7BA7D;">\\.</span><span style="color:#CE9178;">(</span><span style="color:#D16969;">scss</span><span style="color:#DCDCAA;">|</span><span style="color:#D16969;">sass</span><span style="color:#CE9178;">)</span><span style="color:#DCDCAA;">$</span><span style="color:#D16969;">/</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        include:</span><span style="color:#9CDCFE;"> paths</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">appSrc</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        use:</span><span style="color:#D4D4D4;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">          &#39;style-loader&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">          isEnvProduction</span><span style="color:#D4D4D4;"> &amp;&amp; </span><span style="color:#9CDCFE;">MiniCssExtractPlugin</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">loader</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// 仅生产环境</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">          {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            loader:</span><span style="color:#CE9178;"> &#39;css-loader&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            options:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">              modules:</span><span style="color:#569CD6;"> true</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">              importLoaders:</span><span style="color:#B5CEA8;"> 2</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">          },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">          {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            loader:</span><span style="color:#CE9178;"> &#39;postcss-loader&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            options:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">              postcssOptions:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">                plugins:</span><span style="color:#D4D4D4;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">                  [</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">                    &#39;postcss-preset-env&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">                  ],</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">                ],</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">              },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">          },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">          {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            loader:</span><span style="color:#CE9178;"> &#39;thread-loader&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">            options:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">              workerParallelJobs:</span><span style="color:#B5CEA8;"> 2</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">          },</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">          &#39;sass-loader&#39;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        ].</span><span style="color:#DCDCAA;">filter</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">Boolean</span><span style="color:#D4D4D4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">      },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">};</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>注意：MiniCssExtractPlugin.loader 要放在 style-loader 后面。</p></blockquote><h5 id="最小化-entry-chunk" tabindex="-1"><a class="header-anchor" href="#最小化-entry-chunk"><span>最小化 entry chunk</span></a></h5><p>通过配置 <code>optimization.runtimeChunk = true</code>，为运行时代码创建一个额外的 chunk，减少 entry chunk 体积，提高性能。</p><p><code>webpack.prod.js</code> 配置方式如下：</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#9CDCFE;">javascript</span><span style="color:#9CDCFE;"> 代码解读复制代码module</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">exports</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">    optimization:</span><span style="color:#D4D4D4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">        runtimeChunk:</span><span style="color:#569CD6;"> true</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">      },</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    };</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="tree-shaking-移除未使用的代码" tabindex="-1"><a class="header-anchor" href="#tree-shaking-移除未使用的代码"><span>Tree Shaking 移除未使用的代码</span></a></h5><p>Webpack 中的 Tree Shaking 是一种优化技术，用于消除未使用的代码，从而减小程序包的大小。Tree Shaking 的主要目的是通过静态分析来识别和去除那些不会被执行的代码，从而提高应用的加载速度和性能。</p><p>通过 <code>mode: &#39;production&#39;</code> 或配置 <code>optimization.usedExports: true</code>，自动删除未使用的代码，减少打包体积。</p><h5 id="使用-purgecss-webpack-plugin-对-css-tree-shaking" tabindex="-1"><a class="header-anchor" href="#使用-purgecss-webpack-plugin-对-css-tree-shaking"><span>使用 <a href="https://github.com/FullHuman/purgecss/tree/main/packages/purgecss-webpack-plugin" target="_blank" rel="noopener noreferrer">purgecss-webpack-plugin</a> 对 CSS Tree Shaking</span></a></h5><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-bash;"><code><span class="line"><span class="line"><span style="color:#DCDCAA;">npm</span><span style="color:#CE9178;"> i</span><span style="color:#CE9178;"> purgecss-webpack-plugin</span><span style="color:#569CD6;"> -D</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>因为打包时 CSS 默认放在 JS 文件内，因此要结合 webpack 分离 CSS 文件插件 <code>mini-css-extract-plugin</code> 一起使用，先将 CSS 文件分离，再进行 CSS Tree Shaking。</p><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// webpack.prod.js</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> glob</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">require</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;glob&#39;</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> MiniCssExtractPlugin</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">require</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;mini-css-extract-plugin&#39;</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> PurgeCSSPlugin</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">require</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;purgecss-webpack-plugin&#39;</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> paths</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">require</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;paths&#39;</span><span style="color:#D4D4D4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = {</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">  plugins:</span><span style="color:#D4D4D4;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 打包体积分析</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#DCDCAA;"> BundleAnalyzerPlugin</span><span style="color:#D4D4D4;">(),</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // 提取 CSS</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#DCDCAA;"> MiniCssExtractPlugin</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">      filename:</span><span style="color:#CE9178;"> &quot;[name].css&quot;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    }),</span></span></span>
<span class="line"><span class="line"><span style="color:#6A9955;">    // CSS Tree Shaking</span></span></span>
<span class="line"><span class="line"><span style="color:#569CD6;">    new</span><span style="color:#DCDCAA;"> PurgeCSSPlugin</span><span style="color:#D4D4D4;">({</span></span></span>
<span class="line"><span class="line"><span style="color:#9CDCFE;">      paths:</span><span style="color:#9CDCFE;"> glob</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">sync</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">\`</span><span style="color:#569CD6;">\${</span><span style="color:#9CDCFE;">paths</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">appSrc</span><span style="color:#569CD6;">}</span><span style="color:#CE9178;">/**/*\`</span><span style="color:#D4D4D4;">,  { </span><span style="color:#9CDCFE;">nodir:</span><span style="color:#569CD6;"> true</span><span style="color:#D4D4D4;"> }),</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    }),</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">  ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="webpack构建流程概述" tabindex="-1"><a class="header-anchor" href="#webpack构建流程概述"><span>Webpack构建流程概述⭐</span></a></h3><p>1、读取<code>webpack</code>的配置参数；</p><p>2、启动<code>webpack</code>，创建<code>Compiler</code>对象并开始解析项目；</p><p>3、从入口文件（<code>entry</code>）开始解析，并且找到其导入的依赖模块（<code>module</code>），递归遍历分析，形成依赖关系树；</p><p>4、对不同文件类型的依赖模块文件使用对应的<code>Loader</code>进行编译，最终转为<code>Javascript</code>文件；</p><p>5、整个过程中<code>webpack</code>会通过发布订阅模式，向外抛出一些<code>hooks</code>，而<code>webpack</code>的插件（<code>plugin</code>）即可通过监听这些关键的事件节点，执行插件任务进而达到干预输出结果的目的。</p><p>6、Webpack 将编译后的模块输出为最终的捆绑文件（bundle），将编译后的代码写入到指定的输出路径。如果配置了源映射（Source Maps），Webpack 会生成源映射文件，帮助调试。</p><p>7、构建完成后，Webpack 会输出一些统计信息，如构建时间、文件大小等。</p><h2 id="二、babel" tabindex="-1"><a class="header-anchor" href="#二、babel"><span>二、Babel</span></a></h2><h3 id="babel-polyfill" tabindex="-1"><a class="header-anchor" href="#babel-polyfill"><span>babel-polyfill</span></a></h3><p>已过时</p><blockquote><p>替代方案：<code>core-js</code> 和 <code>regenerator-runtime</code></p></blockquote><ul><li>什么是polyfill ：补丁 兼容语法</li><li>corejs和regenerator</li><li>babel-polyfill是两者的集合</li><li>babel7.4之后弃用babel-polyfill</li><li>推荐直接使用corejs和regenerator</li><li>问题：会污染全局环境</li></ul><h4 id="babel-polyfill-配置按需引入" tabindex="-1"><a class="header-anchor" href="#babel-polyfill-配置按需引入"><span>babel-polyfill 配置按需引入</span></a></h4><div class="language-javascript line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre class="shiki dark-plus vp-code" style="background-color:#1E1E1E;color:#D4D4D4 language-javascript;"><code><span class="line"><span class="line"><span style="color:#6A9955;">// .babelrc</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">&quot;presets&quot;</span><span style="color:#D4D4D4;">: [</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        [</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">            &quot;@babel/preset-env&quot;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            {</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">                &quot;useBuiltIns&quot;</span><span style="color:#9CDCFE;">:</span><span style="color:#CE9178;"> &quot;usage&quot;</span><span style="color:#D4D4D4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#CE9178;">                &quot;corejs&quot;</span><span style="color:#9CDCFE;">:</span><span style="color:#B5CEA8;"> 3</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">            }</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">        ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D4D4D4;">    ]</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="babel-runtime" tabindex="-1"><a class="header-anchor" href="#babel-runtime"><span>babel-runtime</span></a></h3><ul><li><p>不会污染全局环境（会重新取变量名）</p></li><li><p>适用于开发第三方库</p></li></ul><h3 id="babel和webpack的区别" tabindex="-1"><a class="header-anchor" href="#babel和webpack的区别"><span>babel和webpack的区别</span></a></h3><ul><li>babel：js语法编译工具，被用来处理 <code>.js</code> 文件，并将它们转换为兼容的代码。</li><li>webpack：打包构建工具，则负责整个打包过程，包括依赖解析、代码转换、优化和输出。</li></ul><h2 id="三、vite" tabindex="-1"><a class="header-anchor" href="#三、vite"><span>三、Vite</span></a></h2><p>Vite 是一个现代化的前端构建工具，由 Evan You（Vue.js 的作者）创建。</p><h3 id="特点" tabindex="-1"><a class="header-anchor" href="#特点"><span>特点</span></a></h3><ol><li><strong>快速启动</strong>：Vite 使用浏览器原生的 ES 模块导入机制来快速启动开发服务器，无需长时间的编译和打包过程。</li><li><strong>热模块替换（HMR）</strong>：Vite 支持热模块替换，可以在开发过程中实时更新模块而不刷新整个页面，从而提供更快的反馈循环。</li><li><strong>增量构建</strong>：Vite 在构建时只重新构建有变化的部分，而不是整个应用，这样可以大幅提高构建速度。</li><li><strong>插件系统</strong>：类似于 Webpack，Vite 也有丰富的插件生态系统，支持多种语言和预处理器，如 TypeScript、Sass 等。</li><li><strong>生产优化</strong>：Vite 在生产环境中提供代码分割、压缩、树摇（tree shaking）等优化手段，以生成体积更小、加载更快的构建产物。</li></ol><h3 id="工作原理" tabindex="-1"><a class="header-anchor" href="#工作原理"><span>工作原理</span></a></h3><ol><li><strong>开发模式</strong>：在开发模式下，Vite <strong>利用浏览器的 ES 模块加载功能（<code>&lt;script type=&quot;module&quot;&gt;</code>）来即时加载模块</strong>，不需要预先编译整个应用。这样可以实现几乎瞬时的启动速度。</li><li><strong>构建模式</strong>：在构建模式下使用rollup，Vite 会对应用进行优化，包括代码分割、压缩、树摇等，生成适合生产环境的静态资源。</li></ol><h3 id="vite为什么比webpack快" tabindex="-1"><a class="header-anchor" href="#vite为什么比webpack快"><span>vite为什么比webpack快</span></a></h3><p><a href="https://juejin.cn/post/7283682738497765413?searchId=202409171645329C70DB852CD241B7CC4A" target="_blank" rel="noopener noreferrer">搞懂vite为什么比webpack快！运行原理、构建方式等有什么不同！</a></p><ul><li><p>绝大多数现代浏览器都已经支持<code>ES module</code>了， 我们只需要在<code>&lt;script&gt;</code>标签中添加<code>type=&quot;module&quot;</code>，就可以使用<code>ES module</code>了</p></li><li><p>在<code>&lt;script type=&quot;module&quot;&gt;</code>中，浏览器遇到内部的import引用时，会自动发起http请求，去加载对应的模块。</p></li><li><p>vite也正是利用了<code>ES module</code>这个特性，使用vite运行项目时，首先会用<code>esbuild</code>进行预构建，将所有模块转换为<code>es module</code>，不需要对我们整个项目进行编译打包，而是在浏览器需要加载某个模块时，拦截浏览器发出的请求，根据请求进行<code>按需编译</code>，然后返回给浏览器。</p></li><li><p>这样一来，首次启动项目（冷启动）时，自然也就比webpack快很多了，并且项目大小对vite启动速度的影响也很小。</p></li></ul><h4 id="构建方式" tabindex="-1"><a class="header-anchor" href="#构建方式"><span>构建方式</span></a></h4><p><strong>webpack</strong></p><p>webpack是基于<code>nodejs</code>运行的，但<code>js</code>只能单线程运行，无法利用多核CPU的优势，当项目越来越大时，构建速度也就越来越慢了。</p><p><strong>vite</strong></p><p>vite<code>预构建</code>与<code>按需编译</code>的过程，都是使用<code>esbuild</code>完成的。</p><p><code>esbuild</code>是用<code>go</code>语言编写的，可以充分利用多核CPU的优势，所以vite开发环境下的<code>预构建</code>与<code>按需编译</code>速度，都是非常快的。</p><h4 id="http2" tabindex="-1"><a class="header-anchor" href="#http2"><span>http2</span></a></h4><p>vite充分利用了http2可以并发请求的优势，这也是速度快的一个主要原因。</p><p>在之前http1的时候，浏览器对同一个域名的请求，是有并发限制的，一般为6个，如果并发请求6个以上，就会造成阻塞问题，所以在http1的时代，我们要减少打包产物的文件数量，减少并发请求，来提高项目的加载速度。</p><p>2015年以后，http2出现了，他可以并发发送多个请求，不会出现http1的并发限制。这时候，将打包产物分成多个小模块，并行去加载，反而会更快。</p><p>vite也充分利用了这一优势，对项目资源进行了合理的拆分，访问项目时，同时加载多个模块，来提升项目访问速度。</p><h4 id="热更新-1" tabindex="-1"><a class="header-anchor" href="#热更新-1"><span>热更新</span></a></h4><p>模块热替换(hot module replacement - HMR)，该功能可以实现应用程序运行过程中，替换、添加或删除模块，而无需重新加载整个页面，也就是我们常说的<code>热更新</code>。</p><p>vite与webpack虽然都支持HMR,但两个工具的实现原理是不一样的。</p><p><strong>webpack</strong></p><p>webpack项目中，每次修改文件，都会对整个项目重新进行打包，这对大项目来说，是非常不友好的。</p><p>虽然webpack现在有了缓存机制，但还是无法从根本上解决这个问题。</p><p><strong>vite</strong></p><p>vite项目中，监听到文件变更后，会用<code>websocket</code>通知浏览器，重新发起新的请求，只对该模块进行重新编译，然后进行替换。</p><p>并且基于<code>es module</code>的特性，vite利用浏览器的缓存策略，针对源码模块（我们自己写的代码）做了<code>协商缓存</code>处理，针对依赖模块（第三方库）做了<code>强缓存</code>处理，这样我们项目的访问的速度也就更快了。</p><h4 id="生产环境" tabindex="-1"><a class="header-anchor" href="#生产环境"><span>生产环境</span></a></h4><p><strong>vite生产环境下，为什么使用rollup打包呢？</strong></p><p>Rollup 是一款 <code>ES Module</code> 打包器， 从作用上来看，<code>Rollup</code> 与 <code>Webpack</code> 非常类似。不过相比于 <code>Webpack</code>，<code>Rollup</code>要小巧的多，打包生成的文件更小。 因为小巧，自然在这种特定的打包环境下，<code>Rollup</code>的打包速度也要比 <code>Webpack</code> 快很多。</p><p>vite正是基于<code>es module</code>的特性实现的，所以使用rollup要更合适一些。</p><p><strong>vite生产环境下，为什么不用esbuild打包呢？</strong></p><p>尽管esbuild的打包速度比rollup更快，但 Vite 目前的插件 API 与使用 esbuild 作为打包器并不兼容，rollup插件api与基础建设更加完善，所以在生产环境vite使用rollup打包会更稳定一些。</p><p>如果后面esbuild基础建设与生态更加完善后，esbuild还是更有优势的。</p><p>所以使用vite可能会带来开发环境与生产环境打包结果不一致的问题。</p><h3 id="webpack和vite的区别" tabindex="-1"><a class="header-anchor" href="#webpack和vite的区别"><span>webpack和vite的区别</span></a></h3><h4 id="区别总结" tabindex="-1"><a class="header-anchor" href="#区别总结"><span>区别总结</span></a></h4><ol><li><strong>启动速度</strong>： <ul><li><strong>Vite</strong>：利用浏览器原生 ES 模块导入机制，启动速度非常快。</li><li><strong>Webpack</strong>：需要先编译整个应用，启动速度相对较慢。</li></ul></li><li><strong>热模块替换（HMR）</strong>： <ul><li><strong>Vite</strong>：支持高效的 HMR，可以在开发过程中实时更新模块。</li><li><strong>Webpack</strong>：也支持 HMR，但相对于 Vite 可能稍逊一筹。</li></ul></li><li><strong>构建速度</strong>： <ul><li><strong>Vite</strong>：利用增量构建技术，构建速度较快。</li><li><strong>Webpack</strong>：构建速度较慢，尤其是在处理大型项目时。</li></ul></li><li><strong>配置复杂性</strong>： <ul><li><strong>Vite</strong>：配置相对简单，适合快速搭建项目。</li><li><strong>Webpack</strong>：配置较为复杂，但提供了更多定制化的选项。</li></ul></li><li><strong>插件系统</strong>： <ul><li><strong>Vite</strong>：插件系统相对简单，但足够强大。</li><li><strong>Webpack</strong>：插件系统更为强大，可以执行更复杂的构建任务。</li></ul></li></ol><h4 id="适用场景" tabindex="-1"><a class="header-anchor" href="#适用场景"><span>适用场景</span></a></h4><ul><li><strong>Vite</strong> 更适合用于构建追求快速开发体验的现代前端项目，特别是那些对启动速度和开发效率有较高要求的项目。</li><li><strong>Webpack</strong> 更适合用于构建大型、复杂的项目，特别是那些包含多种模块格式和资源的项目。</li></ul><h3 id="webpack和rollup的区别" tabindex="-1"><a class="header-anchor" href="#webpack和rollup的区别"><span>webpack和Rollup的区别</span></a></h3><h4 id="区别总结-1" tabindex="-1"><a class="header-anchor" href="#区别总结-1"><span>区别总结</span></a></h4><ol><li><strong>模块支持</strong>： <ul><li><strong>Rollup</strong> 主要针对 ES 模块，更适合处理纯 ES 模块的项目。</li><li><strong>Webpack</strong> 支持多种模块格式，更适合处理混合模块格式的项目。</li></ul></li><li><strong>Tree Shaking</strong>： <ul><li><strong>Rollup</strong> 对 Tree Shaking 的支持更为彻底，能够更有效地移除未使用的代码。</li><li><strong>Webpack</strong> 也支持 Tree Shaking，但可能不如 Rollup 那么彻底。</li></ul></li><li><strong>构建速度</strong>： <ul><li><strong>Rollup</strong> 的构建速度通常更快，特别是在处理较小的项目时。</li><li><strong>Webpack</strong> 在处理大型项目时可能会稍慢一些，但提供了更多的优化选项。</li></ul></li><li><strong>配置复杂性</strong>： <ul><li><strong>Rollup</strong> 的配置相对简单，适合快速搭建项目。</li><li><strong>Webpack</strong> 的配置更为复杂，但提供了更多定制化的选项。</li></ul></li><li><strong>插件系统</strong>： <ul><li><strong>Rollup</strong> 的插件系统相对简单，但足够强大。</li><li><strong>Webpack</strong> 的插件系统更为强大，可以执行更复杂的构建任务。</li></ul></li></ol><h4 id="适用场景-1" tabindex="-1"><a class="header-anchor" href="#适用场景-1"><span>适用场景</span></a></h4><ul><li><strong>Rollup</strong> 更适合用于构建纯 ES 模块的项目，特别是那些对 Tree Shaking 和构建速度有较高要求的项目。</li><li><strong>Webpack</strong> 更适合用于构建大型、复杂的项目，特别是那些包含多种模块格式和资源的项目</li></ul>`,286)]))}const d=n(i,[["render",c],["__file","前端工程化.html.vue"]]),t=JSON.parse('{"path":"/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96.html","title":"前端工程化","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"一、Webpack","slug":"一、webpack","link":"#一、webpack","children":[{"level":3,"title":"基础","slug":"基础","link":"#基础","children":[]},{"level":3,"title":"实践","slug":"实践","link":"#实践","children":[]},{"level":3,"title":"优化","slug":"优化","link":"#优化","children":[]},{"level":3,"title":"Webpack构建流程概述⭐","slug":"webpack构建流程概述","link":"#webpack构建流程概述","children":[]}]},{"level":2,"title":"二、Babel","slug":"二、babel","link":"#二、babel","children":[{"level":3,"title":"babel-polyfill","slug":"babel-polyfill","link":"#babel-polyfill","children":[]},{"level":3,"title":"babel-runtime","slug":"babel-runtime","link":"#babel-runtime","children":[]},{"level":3,"title":"babel和webpack的区别","slug":"babel和webpack的区别","link":"#babel和webpack的区别","children":[]}]},{"level":2,"title":"三、Vite","slug":"三、vite","link":"#三、vite","children":[{"level":3,"title":"特点","slug":"特点","link":"#特点","children":[]},{"level":3,"title":"工作原理","slug":"工作原理","link":"#工作原理","children":[]},{"level":3,"title":"vite为什么比webpack快","slug":"vite为什么比webpack快","link":"#vite为什么比webpack快","children":[]},{"level":3,"title":"webpack和vite的区别","slug":"webpack和vite的区别","link":"#webpack和vite的区别","children":[]},{"level":3,"title":"webpack和Rollup的区别","slug":"webpack和rollup的区别","link":"#webpack和rollup的区别","children":[]}]}],"git":{"updatedTime":1726590005000,"contributors":[{"name":"csmSimona","username":"csmSimona","email":"980715844@qq.com","commits":1,"url":"https://github.com/csmSimona"}],"changelog":[{"hash":"b838a67df4a86387934479ec6107a377ae7d89fa","time":1726590005000,"email":"980715844@qq.com","author":"csmSimona","message":"update docs"}]},"filePathRelative":"前端基础汇总/前端工程化.md","readingTime":{"minutes":29.32,"words":8797}}');export{d as comp,t as data};
